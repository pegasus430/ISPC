<?
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/data_tables/datatables.min.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/data_tables/jquery.dataTables.js');
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/data_tables/fixedColumns.dataTables.min.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/data_tables/dataTables.fixedColumns.min.js');
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/medicationnew.css');

$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/dateUtil.js');


// ISPC-2346 Added by Ancuta  18.06.2019 START:
if($this->ModulePrivileges[189] == true){
    $this->headScript()->appendFile(RES_FILE_PATH.'/javascript/dynamsoft-javascript-barcode/dist/dbr-6.5.2.min.js');
    $this->headScript()->appendFile(RES_FILE_PATH.'/javascript/pms/datamatriximportReader.js');
}else{
    $this->headScript()->appendFile(RES_FILE_PATH.'/javascript/pms/datamatriximport.js');
}
// --
/*
if ($this->show_new_fileds == "1"){
	$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/medicationnew_extrafields.css?' . date('Ymd'));
}
*/
// allowed medication types
$allowed_medication_types = $this->medication_blocks;
$timed_scheduled_medications = $this->timed_scheduled_medications; 
$allow_normal_scheduled = $this->allow_normal_scheduled;

// for ISPC-2247 changes were made to this page (Ancuta 06.11.2018)  
?>

<script type="text/javascript">
var allow_reader = 0;
<?php if($this->ModulePrivileges[189] == true):?> 
var allow_reader = 1;
<?php endif;?>

var med_sort = "";
var saved_sorting_ls = '<?php echo $this->js_saved_order; ?>';
var saved_sorting = jQuery.parseJSON (saved_sorting_ls) || {};
// console.log(saved_sorting);
var pat = "<?php echo $_REQUEST['id']; ?>";
var Barcodereader_LicenseKey = "<?php echo $this->barcodereaderKey; ?>"; 
var datamatrixurl = "patientnew/datamatriximport";

var dosage_intervals_json = <?php if ( ! empty($this->dosage_intervals) && is_array($this->dosage_intervals)) { echo json_encode($this->dosage_intervals);} else echo'{}' ?>;

var content_toggler_row = '<div class="medi_child_toggle_td_arrow">' 
	<?php if ($this->show_new_fileds == "1"):?>
		+ '<?php echo $this->translate('medication_type'); ?>,'
		+ '<?php echo $this->translate('medication_dosageform'); ?>,'
		+ '<?php echo $this->translate('medication_unit'); ?>,'
		+ 'etc'
	<?php else : ?>
		+ '<?php echo $this->translate("medication_days_interval")?>,'
		+ '<?php echo $this->translate('medication_administration_date'); ?>'
	<?php endif ;?>

 + '</div>';
 var reset_comment = "";
 
function togglebutton(vals)
{
	if(vals>0 || vals!="")
	{
		$('#MedicButton').removeAttr('disabled','disabled');
	}
	else
	{
		$('#MedicButton').attr('disabled','disabled');
	}
}


function getmedicationdeleted() {
	var url = '<?php echo APP_BASE; ?>patientnew/medicationdeleted?id=<?php echo $_REQUEST["id"]; ?>';
	xhr = $.ajax({
		url : url,
		success : function(response) {
			$('#deleted_medication_list').html(response);
		}
	});
}
  
function save_sorting(medication_type, order , extra_info){
	var pat = "<?php echo $_REQUEST['id']; ?>";
	
	$.ajax({
		url: appbase+'user/savemedicationsorting',		
		type: "POST",					
		dataType: "json",
		data: { "page": medication_type,"patient":pat, "order": order, "extra_info" : extra_info,  "save_sorting": "yes" }
	});
	
} 

	
function save_sorting_v2(_this){

	var pat = "<?php echo $_REQUEST['id']; ?>";

	var medication_type = "medication-" + ($(_this).attr("id") || "");
	var dataTable = $(_this).DataTable();
	
	var order = dataTable.order();
	var actual_columnheader = dataTable.column( order[0][0] ).header();
	var extrainfo = {};
		extrainfo.actual_sorted_column = $(actual_columnheader).data('sortname') || '';
		extrainfo.columnDef_name = dataTable.settings()[0].aoColumns[order[0][0]].sName || '';
		extrainfo.columnDef_data = dataTable.settings()[0].aoColumns[order[0][0]].mData || '';
	
	$.ajax({
		url: appbase+'user/savemedicationsorting',		
		type: "POST",					
		dataType: "json",
		data: { "page": medication_type,"patient":pat, "order": order, "extra_info" : extrainfo,  "save_sorting": "yes" }
	});
	
} 


$(document).ready(function() { /*------ Start $(document).ready --------------------*/

	getmedicationdeleted();

			//     ISPC-2127 deleted medis :: show hide 21.02.2018
			$('.deleted_meds_state').live('click',function(){
				
				$('#deleted_med_table').toggle();
				if ($(this).hasClass('hidden')){
					$(this).removeClass('hidden')
					$(this).addClass('shown')
				} else if ($(this).hasClass('shown')){
					$(this).removeClass('shown')
					$(this).addClass('hidden')
				}
			});

	$("[id^=ack_information_]").hide();

	$("#print_button").prop('disabled', true);
	
	$('#select_pdf').live('change',function(){
		if($(this).val() != 0 ) {
			$('#print_button').removeAttr('disabled','disabled');
		} else {
			$("#print_button").prop('disabled', true);
		}
		
	});
	
	$('#print_button').live('click',function(e){
		e.preventDefault();
		if($('#select_pdf').val() !=0){
			$("#print_medications").submit();	
		}
		
	});
	
	//ISPC - 2305 - reset scheduled medication comment
	$(document).on('change', '#reset_comment', function(){
		reset_comment = $('#reset_comment').val();
	});
	
	// scheduled medication interval start / restart 
	$(".interval_start").live('click',function(){
	 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
	 	var current_date = '<?php echo date("d.m.Y",time()); ?>';
		var drug_id = $(this).data("drug_id");
		var medication_type = $(this).data("medication_type");
		//ISPC - 2305 - scheduled medication reset comment
		var medi_comment = $('#'+drug_id+'_medi_comment').html();
		
		if(medication_type != 'scheduled')
		{
			reset_comment_dialog = '<?php echo $this->translate("confirm_give_medication"); ?>';
		}
		else
		{
			reset_comment_dialog = '<span style="width: 100%;display: block;"><?php echo $this->translate("confirm_give_medication"); ?></span><label style="display: block; width: 100%; padding-top: 10px;"><?php echo $this->translate("medication_comments");?>:</label>';				
			reset_comment_dialog += '<textarea name="reset_comment"  id="reset_comment" rows="" cols=""></textarea>';	
		}
		
		jConfirm(reset_comment_dialog, '<?php echo $this->translate('confirm_give_medication_title'); ?>', function(r) {
		    if(r) {
				
				$.ajax({
					type: 'POST',
					url: 'ajax/givescheduledmed',
					data: {
						id: patient_id,
						drug_id: drug_id,
						reset_comment: reset_comment
					},
					success:function(response){
						

						$('#'+medication_type+'_'+drug_id+'_interval_start').remove(); // remove button
						$('#'+drug_id+'_administration_date').html(current_date);// change date
						$('#'+drug_id+'_medi_comment').html(medi_comment+'<br/>'+reset_comment);// change comment
						
						setTimeout(function () {
							$('#sch_'+drug_id).remove();
						}, 800);
						//console.log(response);
						var response_obj = jQuery.parseJSON(response);
						if (response_obj['remove_icon'] == '1') {
							$('#sys_icon-52').remove();
							$('#content_sys_icon-52').remove();
						}
					}
				});
		    }  
		});
	});
	
	$(".interval_restart").live('click',function(){
	 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
	 	var current_date = '<?php echo date("d.m.Y",time()); ?>';
		var drug_id = $(this).data("drug_id");
		var medication_type = $(this).data("medication_type");
		//ISPC - 2305 - scheduled medication reset comment
		var medi_comment = $('#'+drug_id+'_medi_comment').html();
		//console.log("dddd");
		
		if(medication_type != 'scheduled')
		{
			reset_comment_dialog = '<?php echo $this->translate("confirm_give_medication"); ?>';
		}
		else
		{
			reset_comment_dialog = '<span style="width: 100%;display: block;"><?php echo $this->translate("confirm_give_medication"); ?></span><label style="display: block; width: 100%; padding-top: 10px;"><?php echo $this->translate("medication_comments");?>:</label>';				
			reset_comment_dialog += '<textarea name="reset_comment"  id="reset_comment" rows="" cols=""></textarea>';	
		}
		
		jConfirm(reset_comment_dialog, '<?php echo $this->translate('confirm_give_medication_title'); ?>', function(r) {
		    if(r) {
// 				ajaxCallserver({url: appbase + 'ajax/givescheduledmed', method:'POST', data: {id: patient_id, drug_id: drug_id}, callLoading: readmisionCallback});
// 				$('#'+medication_type+'_'+drug_id+'_interval_restart').remove(); //  remove button
// 				$('#'+drug_id+'_administration_date').html(current_date);// change date
// 				window.location.reload(true);
				
				$.ajax({
					type: 'POST',
					url: 'ajax/givescheduledmed',
					data: {
						id: patient_id,
						drug_id: drug_id,
						reset_comment: reset_comment
					},
					success:function(response){
						

						$('#'+medication_type+'_'+drug_id+'_interval_restart').remove(); // remove button
						$('#'+drug_id+'_administration_date').html(current_date);// change date
						$('#'+drug_id+'_medi_comment').html(medi_comment+'<br/>'+reset_comment);// change comment
						
						setTimeout(function () {
							$('#sch_'+drug_id).remove();
						}, 800);
						
						//console.log(response);
						var response_obj = jQuery.parseJSON(response);
						if (response_obj['remove_icon'] == '1') {
							$('#sys_icon-52').remove();
							$('#content_sys_icon-52').remove();
						}
					}
				});
		    }  
		});
	});
	
	
	
	
	$('.med_approve_rights').removeAttr('disabled','disabled');
	$('.med_approve_rights').live('click',function(e){
		e.preventDefault();
		
		var action = $(this).data('action');
		var recordid = $(this).data('recordid');
		var alt_id = $(this).data('alt_id');
		$('.med_approve_rights').attr('disabled','disabled');
		
		if(action && recordid){
			$.ajax({
				type: 'POST',
				url: 'ajax/applymedicationchanges?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					action: action,
					recordid: recordid,
					alt_id: alt_id
				},
				success:function(data){
					location.href = "<?php echo APP_BASE ?>patientnew/medication?flg=suc&id=<?php echo $_REQUEST['id']; ?>";
				},
				error:function(){
					ajax_done = 1;
					// failed request; give feedback to user
				}
			});
		}
	});
	
	
	$('.pump_med_approve_rights').removeAttr('disabled','disabled');
	$('.pump_med_approve_rights').live('click',function(e){
		e.preventDefault();
		
		var action = $(this).data('action');
		var recordid = $(this).data('recordid');
		var alt_id = $(this).data('alt_id');
		$('.pump_med_approve_rights').attr('disabled','disabled');
		
		if(action && recordid){
			$.ajax({
				type: 'POST',
				url: 'ajax/applypumpmedicationchanges?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					action: action,
					recordid: recordid,
					alt_id: alt_id
				},
				success:function(data){
					location.href = "<?php echo APP_BASE ?>patientnew/medication?flg=suc&id=<?php echo $_REQUEST['id']; ?>";
				},
				error:function(){
					ajax_done = 1;
					// failed request; give feedback to user
				}
			});
		}
	});
	
	
	
// DATATABLE ACTUAL
/*###################################################################################################################################################*/
var actual_sorting = saved_sorting['actual'];
table_actual = $('.medication_table_actual').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"stateSave": false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" , "data": "medication"}, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
			       	<?php $column = 3;?>
								
					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_concentration" , "bVisible": false , "data": "concentration"}, // medication_concentration
					    { "targets": 4, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false  , "data": "type"}, // medication_type  -HIDDEN
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_unit"  , "bVisible": false, "data": "unit"}, // medication_unit
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false  , "data": "dosage_form"}, // medication_dosage_form  -HIDDEN			
					<?php $column = 7;?>
					<?php endif;?>

					<?php if(in_array("actual",$timed_scheduled_medications )):?>
						<?php foreach($this->dosage_intervals['actual'] as $k => $di):?>
						{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
					<?php $column++; endforeach; ?>
					<?php else: ?>
					   	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
					   	<?php $column++;?>
				    <?php endif;?>
			       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication"  , "data": "indication" }, // medication_indication
			       	<?php $new_cloumn_number++;?>
			       	
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": false, "name":"comment_hidden"  , "data": "comments" }, // medication_commets -HIDDEN
			       	<?php $new_cloumn_number++;?>
				    
			       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_last_update", "data": "medication_change" }, // medication_last_update
			       	<?php $new_cloumn_number++;?>
				       	
				     <?php if($allow_normal_scheduled == "1"):?>
				       	{ "targets":  <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_days_interval", "data": "days_interval" , "bVisible": false }, // medication_importance
			      	     <?php $new_cloumn_number++;?>
			       	<?php endif; ?>
			       	
				       	{ "targets":  <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_importance"  , "data": "importance" } // medication_importance
				],				
 		order: [[actual_sorting.col,actual_sorting.ord]],
 		
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();

            api.rows( {page:'current'} ).every(function(){
				
            	var classnow="odd";
            	if ($(this.node()).hasClass('even')){
            		classnow = 'even';
            	}
            	
        	   if( $(this.node()).data('medid') != undefined) {
        		   var medid = $(this.node()).data('medid');
        		   var ack_moderate = '';
        		   if ($( "#ack_information_"+medid ).length) {
        			   ack_moderate += $( "#ack_information_"+medid ).html();
        		   }
        		   if ($( ".ack_information_offline_"+medid ).length) {
        			   $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
        		   }
        		   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
           	   } else {
           			
           		   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
           	   }
        	   
           });
 
        }, 		
		initComplete: function()
		{ 
			
			if(actual_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
				$('#drug_actual').removeClass('sorting');
				$('#drug_actual').removeClass('sorting_asc');
				$('#drug_actual').removeClass('sorting_desc');
				$('#drug_actual').addClass('sorting_'+actual_sorting.ord);
			} 
			else
			{
				$('#drug_actual').removeClass('sorting_asc');
				$('#drug_actual').removeClass('sorting_desc');
				$('#drug_actual').addClass('sorting');
			}
			/*
			if(actual_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
				$('#med_type_actual').removeClass('sorting');
				$('#med_type_actual').removeClass('sorting_asc');
				$('#med_type_actual').removeClass('sorting_desc');
				$('#med_type_actual').addClass('sorting_'+actual_sorting.ord);
			} 
			else
			{
				$('#med_type_actual').removeClass('sorting_asc');
				$('#med_type_actual').removeClass('sorting_desc');
				$('#med_type_actual').addClass('sorting');
				
			}
			*/
			/*
			if(actual_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
				$('#concentration_actual').removeClass('sorting');
				$('#concentration_actual').removeClass('sorting_asc');
				$('#concentration_actual').removeClass('sorting_desc');
				$('#concentration_actual').addClass('sorting_'+actual_sorting.ord);
			} 
			else
			{
				$('#concentration_actual').removeClass('sorting_asc');
				$('#concentration_actual').removeClass('sorting_desc');
				$('#concentration_actual').addClass('sorting');
				
			}
			*/
			/*
		 	if(actual_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
				$('#dosage_form_actual')
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+actual_sorting.ord);
			} 
			else
			{
				$('#dosage_form_actual')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');
				
			}
		 */
		 
		 	/*
			if(actual_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
				$('#comments_actual').removeClass('sorting');
				$('#comments_actual').removeClass('sorting_asc');
				$('#comments_actual').removeClass('sorting_desc');
				$('#comments_actual').addClass('sorting_'+actual_sorting.ord);
			} 
			else
			{
				$('#comments_actual').removeClass('sorting_asc');
				$('#comments_actual').removeClass('sorting_desc');
				$('#comments_actual').addClass('sorting');
				
			}
		 	*/
		}
	});
	/* -------------- SORTING actual ------------------------------*/
	var actual_order = table_actual.order();
	var actual_columnheader = table_actual.column( actual_order[0][0] ).header();
	var actual_sorted_column = $(actual_columnheader).data('sortname');
	var actual_sorted_dir = actual_order[0][1];
	
	$('#actual_sort_by').val(actual_sorted_column);
	$('#actual_sort_dir').val(actual_sorted_dir);

	table_actual.order.listener( $('#drug_actual'), table_actual.column('medication_drug_hidden:name').index() );
	//table_actual.order.listener( $('#med_type_actual'), table_actual.column('medication_type_hidden:name').index() );
	//table_actual.order.listener( $('#concentration_actual'), table_actual.column('medication_concentration_hidden:name').index() );
	//table_actual.order.listener( $('#dosage_form_actual'), table_actual.column('medication_dosage_form_hidden:name').index() );
	//table_actual.order.listener( $('#comments_actual'), table_actual.column('comment_hidden:name').index() );
	
	
	$('.medication_table_actual').on("order.dt",function(){

		var order = table_actual.order();
		var actual_columnheader = table_actual.column( order[0][0] ).header();
		var column_name = $(actual_columnheader).data('sortname');
		
		save_sorting("medication-actual",order);
 
		if(order[0][0] == table_actual.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_actual').removeClass('sorting');
			$('#drug_actual').removeClass('sorting_asc');
			$('#drug_actual').removeClass('sorting_desc');
			$('#drug_actual').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_actual').removeClass('sorting_asc');
			$('#drug_actual').removeClass('sorting_desc');
			$('#drug_actual').addClass('sorting');
		}
		/*
		if(order[0][0] == table_actual.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_actual').removeClass('sorting');
			$('#med_type_actual').removeClass('sorting_asc');
			$('#med_type_actual').removeClass('sorting_desc');
			$('#med_type_actual').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_actual').removeClass('sorting_asc');
			$('#med_type_actual').removeClass('sorting_desc');
			$('#med_type_actual').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_actual.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_actual')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_actual')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		
		
		/*
		if(order[0][0] ==  table_actual.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_actual').removeClass('sorting');
			$('#concentration_actual').removeClass('sorting_asc');
			$('#concentration_actual').removeClass('sorting_desc');
			$('#concentration_actual').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_actual').removeClass('sorting_asc');
			$('#concentration_actual').removeClass('sorting_desc');
			$('#concentration_actual').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_actual.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_actual').removeClass('sorting');
			$('#comments_actual').removeClass('sorting_asc');
			$('#comments_actual').removeClass('sorting_desc');
			$('#comments_actual').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_actual').removeClass('sorting_asc');
			$('#comments_actual').removeClass('sorting_desc');
			$('#comments_actual').addClass('sorting');
			
		}
		*/
		
		var actual_order = table_actual.order();
		var actual_columnheader = table_actual.column( actual_order[0][0] ).header();
		var actual_sorted_column = $(actual_columnheader).data('sortname');
		var actual_sorted_dir = actual_order[0][1];

		$('#actual_sort_by').val(actual_sorted_column);
		$('#actual_sort_dir').val(actual_sorted_dir);
	});

	
	
// DATATABLE BEDARF
/*###################################################################################################################################################*/
var isbedarfs_sorting = saved_sorting['isbedarfs'];	
table_isbedarfs = 	$('.medication_table_isbedarfs').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
			       	<?php $column = 3;?>
					
					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_concentration" , "bVisible": false , "data": "concentration"}, // medication_concentration
					    { "targets": 4, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false }, // medication_type  -HIDDEN
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_unit" , "bVisible": false}, // medication_unit
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false }, // medication_dosage_form  -HIDDEN
					<?php $column = 7;?>
					<?php endif;?>
			
		       	<?php if(in_array("isbedarfs",$timed_scheduled_medications )):?>
			      	<?php foreach($this->dosage_intervals['isbedarfs'] as $k => $di):?>
			       		{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
			       	<?php $column++; endforeach; ?>
			    <?php else: ?>
				    	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
				    	<?php $column++;?>
		       	<?php endif;?>
				       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number + 3;?>, "searchable": true, "orderable": true, "name":"medication_importance" }, // medication_importance
				       	{ "bVisible": false,"targets": <?php echo $new_cloumn_number + 4;?>, "searchable": true, "orderable": true, "name":"medication_escalation_hidden"} // escalation_hidden
				],			
				
 		order: [[isbedarfs_sorting.col,isbedarfs_sorting.ord]],
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            
           api.rows( {page:'current'} ).every(function(){

	        	var classnow="odd";
	           	if ($(this.node()).hasClass('even')){
	           		classnow = 'even';
	           	}
	           	
        	   if( $(this.node()).data('medid') != undefined) {
                   var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
                   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }                   
                   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
               } else { 
                   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
               }
        	   
           });
 
        },

		initComplete: function()
		{
// 			console.log(this.api().order());
			
			if(isbedarfs_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isbedarfs').removeClass('sorting');
			$('#drug_isbedarfs').removeClass('sorting_asc');
			$('#drug_isbedarfs').removeClass('sorting_desc');
			$('#drug_isbedarfs').addClass('sorting_'+isbedarfs_sorting.ord);
		} 
		else
		{
			$('#drug_isbedarfs').removeClass('sorting_asc');
			$('#drug_isbedarfs').removeClass('sorting_desc');
			$('#drug_isbedarfs').addClass('sorting');
			
		}
			if(isbedarfs_sorting.col == this.api().column('medication_escalation_hidden:name').index() ) { // escalation
				$('#escalation_isbedarfs').removeClass('sorting');
				$('#escalation_isbedarfs').removeClass('sorting_asc');
				$('#escalation_isbedarfs').removeClass('sorting_desc');
				$('#escalation_isbedarfs').addClass('sorting_'+isbedarfs_sorting.ord);
			} 
			else
			{
				$('#escalation_isbedarfs').removeClass('sorting_asc');
				$('#escalation_isbedarfs').removeClass('sorting_desc');
				$('#escalation_isbedarfs').addClass('sorting');
				
			}
		
		/*
		if(isbedarfs_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isbedarfs').removeClass('sorting');
			$('#med_type_isbedarfs').removeClass('sorting_asc');
			$('#med_type_isbedarfs').removeClass('sorting_desc');
			$('#med_type_isbedarfs').addClass('sorting_'+isbedarfs_sorting.ord);
		} 
		else
		{
			$('#med_type_isbedarfs').removeClass('sorting_asc');
			$('#med_type_isbedarfs').removeClass('sorting_desc');
			$('#med_type_isbedarfs').addClass('sorting');
			
		}
		*/
		/*
		if(isbedarfs_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isbedarfs').removeClass('sorting');
			$('#concentration_isbedarfs').removeClass('sorting_asc');
			$('#concentration_isbedarfs').removeClass('sorting_desc');
			$('#concentration_isbedarfs').addClass('sorting_'+isbedarfs_sorting.ord);
		} 
		else
		{
			$('#concentration_isbedarfs').removeClass('sorting_asc');
			$('#concentration_isbedarfs').removeClass('sorting_desc');
			$('#concentration_isbedarfs').addClass('sorting');
			
		}
		*/
		/*
		if(isbedarfs_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
			$('#dosage_form_isbedarfs')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+isbedarfs_sorting.ord);
		} 
		else
		{
			$('#dosage_form_isbedarfs')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');		
		}
		*/
		 
		/* 
		if(isbedarfs_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isbedarfs').removeClass('sorting');
			$('#comments_isbedarfs').removeClass('sorting_asc');
			$('#comments_isbedarfs').removeClass('sorting_desc');
			$('#comments_isbedarfs').addClass('sorting_'+isbedarfs_sorting.ord);
		} 
		else
		{
			$('#comments_isbedarfs').removeClass('sorting_asc');
			$('#comments_isbedarfs').removeClass('sorting_desc');
			$('#comments_isbedarfs').addClass('sorting');
			
		}
		*/
			
		}
        
	});

	/*-------------- SORTING isbedarfs ------------------------------*/
	var isbedarfs_order = table_isbedarfs.order();
	
	if(isbedarfs_order){
// 		console.log(isbedarfs_order);
		var isbedarfs_columnheader = table_isbedarfs.column( isbedarfs_order[0][0] ).header();
		var isbedarfs_sorted_column = $(isbedarfs_columnheader).data('sortname');
		var isbedarfs_sorted_dir = isbedarfs_order[0][1];
		
		$('#isbedarfs_sort_by').val(isbedarfs_sorted_column);
		$('#isbedarfs_sort_dir').val(isbedarfs_sorted_dir);
	}
	
	table_isbedarfs.order.listener( $('#drug_isbedarfs'), table_isbedarfs.column('medication_drug_hidden:name').index() );
	table_isbedarfs.order.listener( $('#escalation_isbedarfs'), table_isbedarfs.column('medication_escalation_hidden:name').index() );
	//table_isbedarfs.order.listener( $('#med_type_isbedarfs'), table_isbedarfs.column('medication_type_hidden:name').index() );
	//table_isbedarfs.order.listener( $('#concentration_isbedarfs'), table_isbedarfs.column('medication_concentration_hidden:name').index() );
	//table_isbedarfs.order.listener( $('#dosage_form_isbedarfs'), table_isbedarfs.column('medication_dosage_form_hidden:name').index() );
	//table_isbedarfs.order.listener( $('#comments_isbedarfs'), table_isbedarfs.column('comment_hidden:name').index() );
	
	$('.medication_table_isbedarfs').on("order.dt",function(){
		var order = table_isbedarfs.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		var isbedarfs_columnheader = table_isbedarfs.column( order[0][0] ).header();
		var column_name = $(isbedarfs_columnheader).data('sortname');
		
		/* save sorting */
		save_sorting("medication-isbedarfs",order);
		
		
		if(order[0][0] == table_isbedarfs.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isbedarfs').removeClass('sorting');
			$('#drug_isbedarfs').removeClass('sorting_asc');
			$('#drug_isbedarfs').removeClass('sorting_desc');
			$('#drug_isbedarfs').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_isbedarfs').removeClass('sorting_asc');
			$('#drug_isbedarfs').removeClass('sorting_desc');
			$('#drug_isbedarfs').addClass('sorting');
			
		}
		if(order[0][0] == table_isbedarfs.column('medication_escalation_hidden:name').index() ) { // escalation
			$('#escalation_isbedarfs').removeClass('sorting');
			$('#escalation_isbedarfs').removeClass('sorting_asc');
			$('#escalation_isbedarfs').removeClass('sorting_desc');
			$('#escalation_isbedarfs').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#escalation_isbedarfs').removeClass('sorting_asc');
			$('#escalation_isbedarfs').removeClass('sorting_desc');
			$('#escalation_isbedarfs').addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_isbedarfs.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isbedarfs').removeClass('sorting');
			$('#med_type_isbedarfs').removeClass('sorting_asc');
			$('#med_type_isbedarfs').removeClass('sorting_desc');
			$('#med_type_isbedarfs').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_isbedarfs').removeClass('sorting_asc');
			$('#med_type_isbedarfs').removeClass('sorting_desc');
			$('#med_type_isbedarfs').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] ==  table_isbedarfs.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isbedarfs').removeClass('sorting');
			$('#concentration_isbedarfs').removeClass('sorting_asc');
			$('#concentration_isbedarfs').removeClass('sorting_desc');
			$('#concentration_isbedarfs').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_isbedarfs').removeClass('sorting_asc');
			$('#concentration_isbedarfs').removeClass('sorting_desc');
			$('#concentration_isbedarfs').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_isbedarfs.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_isbedarfs')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_isbedarfs')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_isbedarfs.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isbedarfs').removeClass('sorting');
			$('#comments_isbedarfs').removeClass('sorting_asc');
			$('#comments_isbedarfs').removeClass('sorting_desc');
			$('#comments_isbedarfs').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_isbedarfs').removeClass('sorting_asc');
			$('#comments_isbedarfs').removeClass('sorting_desc');
			$('#comments_isbedarfs').addClass('sorting');
			
		}
		*/
		var isbedarfs_order = table_isbedarfs.order();
		
		if(isbedarfs_order){
			var isbedarfs_columnheader = table_isbedarfs.column( isbedarfs_order[0][0] ).header();
			var isbedarfs_sorted_column = $(isbedarfs_columnheader).data('sortname');
			var isbedarfs_sorted_dir = isbedarfs_order[0][1];
			
			$('#isbedarfs_sort_by').val(isbedarfs_sorted_column);
			$('#isbedarfs_sort_dir').val(isbedarfs_sorted_dir);
		}
	});
	
<?php if(in_array('iscrisis',$allowed_medication_types)) : ?>
// DATATABLE iscrisis
/*###################################################################################################################################################*/
var iscrisis_sorting = saved_sorting['iscrisis'];	
table_iscrisis = 	$('.medication_table_iscrisis').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
			       	<?php $column = 3;?>
					
					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_concentration" ,"bVisible": false, "data": "concentration" }, // medication_concentration
					    { "targets": 4, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false }, // medication_type  -HIDDEN
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_unit" ,"bVisible": false}, // medication_unit
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false }, // medication_dosage_form  -HIDDEN
					<?php $column = 7;?>
					<?php endif;?>
			
		       	<?php if(in_array("iscrisis",$timed_scheduled_medications )):?>
			      	<?php foreach($this->dosage_intervals['iscrisis'] as $k => $di):?>
			       		{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
			       	<?php $column++; endforeach; ?>
			    <?php else: ?>
				    	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
				    	<?php $column++;?>
		       	<?php endif;?>
				       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number + 3;?>, "searchable": true, "orderable": true, "name":"medication_importance" }, // medication_importance
				       	{ "bVisible": false, "targets":  <?php echo $new_cloumn_number + 4;?>, "searchable": true, "orderable": true, "name":"medication_escalation_hidden" } // medication_escalation_hidden
				],			
				
 		order: [[iscrisis_sorting.col,iscrisis_sorting.ord]],
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            
            api.rows( {page:'current'} ).every(function(){
            	
            	var classnow="odd";
        	    
            	if ($(this.node()).hasClass('even')){
	           		classnow = 'even';
	           	}
        	   
                if( $(this.node()).data('medid') != undefined) {
                   var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
                   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }
                   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
                } else {
                   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
                }
        	   
           });
 
        },

		initComplete: function()
		{
// 			console.log(this.api().order());
			
			if(iscrisis_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_iscrisis').removeClass('sorting');
			$('#drug_iscrisis').removeClass('sorting_asc');
			$('#drug_iscrisis').removeClass('sorting_desc');
			$('#drug_iscrisis').addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#drug_iscrisis').removeClass('sorting_asc');
			$('#drug_iscrisis').removeClass('sorting_desc');
			$('#drug_iscrisis').addClass('sorting');
			
		}
			if(iscrisis_sorting.col == this.api().column('medication_escalation_hidden:name').index() ) { // DRUG
			$('#escalation_iscrisis').removeClass('sorting');
			$('#escalation_iscrisis').removeClass('sorting_asc');
			$('#escalation_iscrisis').removeClass('sorting_desc');
			$('#escalation_iscrisis').addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#escalation_iscrisis').removeClass('sorting_asc');
			$('#escalation_iscrisis').removeClass('sorting_desc');
			$('#escalation_iscrisis').addClass('sorting');
			
		}
		/*
		if(iscrisis_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_iscrisis').removeClass('sorting');
			$('#med_type_iscrisis').removeClass('sorting_asc');
			$('#med_type_iscrisis').removeClass('sorting_desc');
			$('#med_type_iscrisis').addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#med_type_iscrisis').removeClass('sorting_asc');
			$('#med_type_iscrisis').removeClass('sorting_desc');
			$('#med_type_iscrisis').addClass('sorting');
			
		}
		*/
		/*
		if(iscrisis_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_iscrisis').removeClass('sorting');
			$('#concentration_iscrisis').removeClass('sorting_asc');
			$('#concentration_iscrisis').removeClass('sorting_desc');
			$('#concentration_iscrisis').addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#concentration_iscrisis').removeClass('sorting_asc');
			$('#concentration_iscrisis').removeClass('sorting_desc');
			$('#concentration_iscrisis').addClass('sorting');
			
		}
		*/
		/*
		if(iscrisis_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
			$('#dosage_form_iscrisis')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#dosage_form_iscrisis')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');		
		}
		 */
		 /*
		if(iscrisis_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_iscrisis').removeClass('sorting');
			$('#comments_iscrisis').removeClass('sorting_asc');
			$('#comments_iscrisis').removeClass('sorting_desc');
			$('#comments_iscrisis').addClass('sorting_'+iscrisis_sorting.ord);
		} 
		else
		{
			$('#comments_iscrisis').removeClass('sorting_asc');
			$('#comments_iscrisis').removeClass('sorting_desc');
			$('#comments_iscrisis').addClass('sorting');
			
		}
		 */
			
		}
        
	});

	/*-------------- SORTING iscrisis ------------------------------*/
	var iscrisis_order = table_iscrisis.order();
	
	if(iscrisis_order){
// 		console.log(iscrisis_order);
		var iscrisis_columnheader = table_iscrisis.column( iscrisis_order[0][0] ).header();
		var iscrisis_sorted_column = $(iscrisis_columnheader).data('sortname');
		var iscrisis_sorted_dir = iscrisis_order[0][1];
		
		$('#iscrisis_sort_by').val(iscrisis_sorted_column);
		$('#iscrisis_sort_dir').val(iscrisis_sorted_dir);
	}
	
	table_iscrisis.order.listener( $('#drug_iscrisis'), table_iscrisis.column('medication_drug_hidden:name').index() );
	table_iscrisis.order.listener( $('#escalation_iscrisis'), table_iscrisis.column('medication_escalation_hidden:name').index() );
	//table_iscrisis.order.listener( $('#med_type_iscrisis'), table_iscrisis.column('medication_type_hidden:name').index() );
	//table_iscrisis.order.listener( $('#concentration_iscrisis'), table_iscrisis.column('medication_concentration_hidden:name').index() );
	//table_iscrisis.order.listener( $('#dosage_form_iscrisis'), table_iscrisis.column('medication_dosage_form_hidden:name').index() );
	//table_iscrisis.order.listener( $('#comments_iscrisis'), table_iscrisis.column('comment_hidden:name').index() );
	
	$('.medication_table_iscrisis').on("order.dt",function(){
		var order = table_iscrisis.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		var iscrisis_columnheader = table_iscrisis.column( order[0][0] ).header();
		var column_name = $(iscrisis_columnheader).data('sortname');
		
		/* save sorting */
		save_sorting("medication-iscrisis",order);
		
		
		if(order[0][0] == table_iscrisis.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_iscrisis').removeClass('sorting');
			$('#drug_iscrisis').removeClass('sorting_asc');
			$('#drug_iscrisis').removeClass('sorting_desc');
			$('#drug_iscrisis').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_iscrisis').removeClass('sorting_asc');
			$('#drug_iscrisis').removeClass('sorting_desc');
			$('#drug_iscrisis').addClass('sorting');
			
		}
		if(order[0][0] == table_iscrisis.column('medication_escalation_hidden:name').index() ) { // DRUG
			$('#escalation_iscrisis').removeClass('sorting');
			$('#escalation_iscrisis').removeClass('sorting_asc');
			$('#escalation_iscrisis').removeClass('sorting_desc');
			$('#escalation_iscrisis').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#escalation_iscrisis').removeClass('sorting_asc');
			$('#escalation_iscrisis').removeClass('sorting_desc');
			$('#escalation_iscrisis').addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_iscrisis.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_iscrisis').removeClass('sorting');
			$('#med_type_iscrisis').removeClass('sorting_asc');
			$('#med_type_iscrisis').removeClass('sorting_desc');
			$('#med_type_iscrisis').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_iscrisis').removeClass('sorting_asc');
			$('#med_type_iscrisis').removeClass('sorting_desc');
			$('#med_type_iscrisis').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] ==  table_iscrisis.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_iscrisis').removeClass('sorting');
			$('#concentration_iscrisis').removeClass('sorting_asc');
			$('#concentration_iscrisis').removeClass('sorting_desc');
			$('#concentration_iscrisis').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_iscrisis').removeClass('sorting_asc');
			$('#concentration_iscrisis').removeClass('sorting_desc');
			$('#concentration_iscrisis').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_iscrisis.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_iscrisis')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_iscrisis')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		
		/*
		if(order[0][0] == table_iscrisis.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_iscrisis').removeClass('sorting');
			$('#comments_iscrisis').removeClass('sorting_asc');
			$('#comments_iscrisis').removeClass('sorting_desc');
			$('#comments_iscrisis').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_iscrisis').removeClass('sorting_asc');
			$('#comments_iscrisis').removeClass('sorting_desc');
			$('#comments_iscrisis').addClass('sorting');
			
		}
		*/
		var iscrisis_order = table_iscrisis.order();
		
		if(iscrisis_order){
			var iscrisis_columnheader = table_iscrisis.column( iscrisis_order[0][0] ).header();
			var iscrisis_sorted_column = $(iscrisis_columnheader).data('sortname');
			var iscrisis_sorted_dir = iscrisis_order[0][1];
			
			$('#iscrisis_sort_by').val(iscrisis_sorted_column);
			$('#iscrisis_sort_dir').val(iscrisis_sorted_dir);
		}
	});
<?php endif; ?>	
<?php if(in_array('isivmed',$allowed_medication_types)) : ?>
// DATATABLE IV MED
/*###################################################################################################################################################*/
var isivmed_sorting = saved_sorting['isivmed'];	
table_isivmed = 	$('.medication_table_isivmed').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
			       	<?php $column = 3;?>
								
					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_concentration", "bVisible": false, "data": "concentration" }, // medication_concentration
					    { "targets": 4, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false }, // medication_type  -HIDDEN
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_unit" , "bVisible": false}, // medication_unit
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false }, // medication_dosage_form  -HIDDEN
					<?php $column = 7;?>
					<?php endif;?>
			
		       	<?php if(in_array("isivmed",$timed_scheduled_medications )):?>
			      	<?php foreach($this->dosage_intervals['isivmed'] as $k => $di):?>
			       		{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
			       	<?php $column++; endforeach; ?>
			    <?php else: ?>
				    	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
				    	<?php $column++;?>
		       	<?php endif;?>
		       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number+3;?>, "searchable": true, "orderable": true, "name":"medication_importance" } // medication_importance
				],
				
 		order: [[isivmed_sorting.col,isivmed_sorting.ord]],
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            
           api.rows( {page:'current'} ).every(function(){
        	   var classnow="odd";
	           	if ($(this.node()).hasClass('even')){
	           		classnow = 'even';
	           	}
	           	
        	   if( $(this.node()).data('medid') != undefined) {
                   var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
                   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }
                   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
                } else {
                   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
                }
        	   
        	   
           });
 
        }, 		

		initComplete: function()
		{
			if(isivmed_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
				$('#drug_isivmed').removeClass('sorting');
				$('#drug_isivmed').removeClass('sorting_asc');
				$('#drug_isivmed').removeClass('sorting_desc');
				$('#drug_isivmed').addClass('sorting_'+isivmed_sorting.ord);
			} 
			else
			{
				$('#drug_isivmed').removeClass('sorting_asc');
				$('#drug_isivmed').removeClass('sorting_desc');
				$('#drug_isivmed').addClass('sorting');
				
			}
			/*
			if(isivmed_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
				$('#med_type_isivmed').removeClass('sorting');
				$('#med_type_isivmed').removeClass('sorting_asc');
				$('#med_type_isivmed').removeClass('sorting_desc');
				$('#med_type_isivmed').addClass('sorting_'+isivmed_sorting.ord);
			} 
			else
			{
				$('#med_type_isivmed').removeClass('sorting_asc');
				$('#med_type_isivmed').removeClass('sorting_desc');
				$('#med_type_isivmed').addClass('sorting');
				
			}
			*/
			/*
			if(isivmed_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
				$('#concentration_isivmed').removeClass('sorting');
				$('#concentration_isivmed').removeClass('sorting_asc');
				$('#concentration_isivmed').removeClass('sorting_desc');
				$('#concentration_isivmed').addClass('sorting_'+isivmed_sorting.ord);
			} 
			else
			{
				$('#concentration_isivmed').removeClass('sorting_asc');
				$('#concentration_isivmed').removeClass('sorting_desc');
				$('#concentration_isivmed').addClass('sorting');
				
			}
			*/
			/*
		 	if(isivmed_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
				$('#dosage_form_isivmed')
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+isivmed_sorting.ord);
			} 
			else
			{
				$('#dosage_form_isivmed')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');		
			}
			*/

			/*
			if(isivmed_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
				$('#comments_isivmed').removeClass('sorting');
				$('#comments_isivmed').removeClass('sorting_asc');
				$('#comments_isivmed').removeClass('sorting_desc');
				$('#comments_isivmed').addClass('sorting_'+isivmed_sorting.ord);
			} 
			else
			{
				$('#comments_isivmed').removeClass('sorting_asc');
				$('#comments_isivmed').removeClass('sorting_desc');
				$('#comments_isivmed').addClass('sorting');
				
			}			
			*/
			
		}
        
	});
	
	/* -------------- SORTING isivmed ------------------------------*/
	var isivmed_order = table_isivmed.order();
	
	if(isivmed_order){
		var isivmed_columnheader = table_isivmed.column( isivmed_order[0][0] ).header();
		var isivmed_sorted_column = $(isivmed_columnheader).data('sortname');
		var isivmed_sorted_dir = isivmed_order[0][1];
		$('#isivmed_sort_by').val(isivmed_sorted_column);
		$('#isivmed_sort_dir').val(isivmed_sorted_dir);
	}

	table_isivmed.order.listener( $('#drug_isivmed'), table_isivmed.column('medication_drug_hidden:name').index() );
	//table_isivmed.order.listener( $('#med_type_isivmed'), table_isivmed.column('medication_type_hidden:name').index() );
	//table_isivmed.order.listener( $('#concentration_isivmed'), table_isivmed.column('medication_concentration_hidden:name').index() );
	//table_isivmed.order.listener( $('#dosage_form_isivmed'), table_isivmed.column('medication_dosage_form_hidden:name').index() );
	//table_isivmed.order.listener( $('#comments_isivmed'), table_isivmed.column('comment_hidden:name').index() );
	
	$('.medication_table_isivmed').on("order.dt",function(){
		var order = table_isivmed.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		/* save sorting */
		save_sorting("medication-isivmed",order);
		
		
		if(order[0][0] == table_isivmed.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isivmed').removeClass('sorting');
			$('#drug_isivmed').removeClass('sorting_asc');
			$('#drug_isivmed').removeClass('sorting_desc');
			$('#drug_isivmed').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_isivmed').removeClass('sorting_asc');
			$('#drug_isivmed').removeClass('sorting_desc');
			$('#drug_isivmed').addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_isivmed.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isivmed').removeClass('sorting');
			$('#med_type_isivmed').removeClass('sorting_asc');
			$('#med_type_isivmed').removeClass('sorting_desc');
			$('#med_type_isivmed').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_isivmed').removeClass('sorting_asc');
			$('#med_type_isivmed').removeClass('sorting_desc');
			$('#med_type_isivmed').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] ==  table_isivmed.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isivmed').removeClass('sorting');
			$('#concentration_isivmed').removeClass('sorting_asc');
			$('#concentration_isivmed').removeClass('sorting_desc');
			$('#concentration_isivmed').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_isivmed').removeClass('sorting_asc');
			$('#concentration_isivmed').removeClass('sorting_desc');
			$('#concentration_isivmed').addClass('sorting');
			
		}
		*/
		
		/*		
		if(order[0][0] == table_isivmed.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_isivmed')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_isivmed')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		
		/*
		if(order[0][0] == table_isivmed.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isivmed').removeClass('sorting');
			$('#comments_isivmed').removeClass('sorting_asc');
			$('#comments_isivmed').removeClass('sorting_desc');
			$('#comments_isivmed').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_isivmed').removeClass('sorting_asc');
			$('#comments_isivmed').removeClass('sorting_desc');
			$('#comments_isivmed').addClass('sorting');
			
		}
		*/
		
		var isivmed_order = table_isivmed.order();
		
		if(isivmed_order){
			var isivmed_columnheader = table_isivmed.column( isivmed_order[0][0] ).header();
			var isivmed_sorted_column = $(isivmed_columnheader).data('sortname');
			var isivmed_sorted_dir = isivmed_order[0][1];
			$('#isivmed_sort_by').val(isivmed_sorted_column);
			$('#isivmed_sort_dir').val(isivmed_sorted_dir);
		}
		
	});
<?php endif; ?>

<?php if(in_array('isnutrition',$allowed_medication_types)) : ?>
// DATATABLE NUTRITION
/*###################################################################################################################################################*/	
var isnutrition_sorting = saved_sorting['isnutrition'];	
table_isnutrition = $('.medication_table_isnutrition').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
				       	<?php $column = 3;?>

					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_concentration","bVisible": false, "data": "concentration" }, // medication_concentration
					    { "targets": 4, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false }, // medication_type  -HIDDEN
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_unit" , "bVisible": false}, // medication_unit
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false }, // medication_dosage_form  -HIDDEN
					<?php $column = 7;?>
					<?php endif;?>
			
			
		       	<?php if(in_array("isnutrition",$timed_scheduled_medications )):?>
			      	<?php foreach($this->dosage_intervals['isnutrition'] as $k => $di):?>
			       		{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
			       	<?php $column++; endforeach; ?>
			    <?php else: ?>
			    	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
			    		<?php $column++;?>
		       	<?php endif;?>
			       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number+3;?>, "searchable": true, "orderable": true, "name":"medication_importance" } // medication_importance
				],				
			order: [isnutrition_sorting.col,isnutrition_sorting.ord],
 		
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();

           api.rows( {page:'current'} ).every(function(){
        	   var classnow="odd";
	           	if ($(this.node()).hasClass('even')){
	           		classnow = 'even';
	           	}
	           	
        	   if( $(this.node()).data('medid') != undefined) {
                   var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
                   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }                   
                   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
               } else { 
                   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
               }
        	   
           });
 
        },
		initComplete: function()
		{
			// this.api().draw();
			var table_id = "isnutrition";
			if(isnutrition_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
				$('#drug_'+table_id)
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+isnutrition_sorting.ord);
			} 
			else
			{
				$('#drug_'+table_id)
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');
				
			}
			/*
			if(isnutrition_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
				$('#med_type_'+table_id)
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+isnutrition_sorting.ord);
			} 
			else
			{
				$('#med_type_'+table_id)
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');
				
			}
			*/

		 /*
		 	if(isnutrition_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
				$('#dosage_form_'+table_id)
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+isnutrition_sorting.ord);
			} 
			else
			{
				$('#dosage_form_'+table_id)
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');
				
			}
		 */
		 
		 /*
			if(isnutrition_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
				$('#comments_'+table_id)
					.removeClass('sorting')
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting_'+isnutrition_sorting.ord);
			} 
			else
			{
				$('#comments_'+table_id)
					.removeClass('sorting_asc')
					.removeClass('sorting_desc')
					.addClass('sorting');
				
			}
		 */
		 
		}
		
	});
	/* -------------- SORTING isnutrition ------------------------------ */
	var isnutrition_order = table_isnutrition.order();
	
	if(isnutrition_order){
		var isnutrition_columnheader = table_isnutrition.column( isnutrition_order[0][0] ).header();
		var isnutrition_sorted_column = $(isnutrition_columnheader).data('sortname');
		var isnutrition_sorted_dir = isnutrition_order[0][1];
		
		$('#isnutrition_sort_by').val(isnutrition_sorted_column);
		$('#isnutrition_sort_dir').val(isnutrition_sorted_dir);
	}
	
	table_isnutrition.order.listener( $('#drug_isnutrition'), table_isnutrition.column('medication_drug_hidden:name').index() );
	//table_isnutrition.order.listener( $('#med_type_isnutrition'), table_isnutrition.column('medication_type_hidden:name').index() );
	//table_isnutrition.order.listener( $('#concentration_isnutrition'), table_isnutrition.column('medication_concentration_hidden:name').index() );
	//table_isnutrition.order.listener( $('#dosage_form_isnutrition'), table_isnutrition.column('medication_dosage_form_hidden:name').index() );
	//table_isnutrition.order.listener( $('#comments_isnutrition'), table_isnutrition.column('comment_hidden:name').index() );
	
	$('.medication_table_isnutrition').on("order.dt",function(){
		var order = table_isnutrition.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		/* save sorting */
		save_sorting("medication-isnutrition",order);
		
		if(order[0][0] == table_isnutrition.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isnutrition').removeClass('sorting');
			$('#drug_isnutrition').removeClass('sorting_asc');
			$('#drug_isnutrition').removeClass('sorting_desc');
			$('#drug_isnutrition').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_isnutrition').removeClass('sorting_asc');
			$('#drug_isnutrition').removeClass('sorting_desc');
			$('#drug_isnutrition').addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_isnutrition.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isnutrition').removeClass('sorting');
			$('#med_type_isnutrition').removeClass('sorting_asc');
			$('#med_type_isnutrition').removeClass('sorting_desc');
			$('#med_type_isnutrition').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_isnutrition').removeClass('sorting_asc');
			$('#med_type_isnutrition').removeClass('sorting_desc');
			$('#med_type_isnutrition').addClass('sorting');
			
		}
		*/
		/*
		
		if(order[0][0] ==  table_isnutrition.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isnutrition').removeClass('sorting');
			$('#concentration_isnutrition').removeClass('sorting_asc');
			$('#concentration_isnutrition').removeClass('sorting_desc');
			$('#concentration_isnutrition').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_isnutrition').removeClass('sorting_asc');
			$('#concentration_isnutrition').removeClass('sorting_desc');
			$('#concentration_isnutrition').addClass('sorting');
			
		}
		*/
		/*
					
		if(order[0][0] == table_isnutrition.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_isnutrition')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_isnutrition')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_isnutrition.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isnutrition').removeClass('sorting');
			$('#comments_isnutrition').removeClass('sorting_asc');
			$('#comments_isnutrition').removeClass('sorting_desc');
			$('#comments_isnutrition').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_isnutrition').removeClass('sorting_asc');
			$('#comments_isnutrition').removeClass('sorting_desc');
			$('#comments_isnutrition').addClass('sorting');
			
		}
		*/
		
		var isnutrition_order = table_isnutrition.order();
		
		if(isnutrition_order){
			var isnutrition_columnheader = table_isnutrition.column( isnutrition_order[0][0] ).header();
			var isnutrition_sorted_column = $(isnutrition_columnheader).data('sortname');
			var isnutrition_sorted_dir = isnutrition_order[0][1];
			
			$('#isnutrition_sort_by').val(isnutrition_sorted_column);
			$('#isnutrition_sort_dir').val(isnutrition_sorted_dir);
		}
	});
<?php endif; ?>








<?php if(in_array('isintubated',$allowed_medication_types)) : ?>
//DATATABLE ISINTUBATED
/*###################################################################################################################################################*/	
	var isintubated_sorting = saved_sorting['isintubated'];
	table_isintubated = $('.medication_table_isintubated').DataTable({
	
	
 
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
     "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
				       	{ "bVisible": false, "targets": 3, "searchable": true, "orderable": true, "name":"medication_packaging_hidden" }, // medication_packaging -HIDDEN
			       	<?php $column = 4;?>
					
					<?php if ($this->show_new_fileds == "1"):?>
						{ "targets": 4, "searchable": true, "orderable": true, "name":"medication_concentration" , "bVisible": false , "data": "concentration"}, // medication_concentration
					    { "targets": 5, "searchable": true, "orderable": true, "name":"medication_type_hidden", "bVisible": false }, // medication_type  -HIDDEN
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_unit" , "bVisible": false}, // medication_unit
					    { "targets": 7, "searchable": true, "orderable": true, "name":"medication_dosage_form_hidden", "bVisible": false }, // medication_dosage_form  -HIDDEN
					<?php $column = 8;?>
					<?php endif;?>
			
		       	<?php if(in_array("isintubated",$timed_scheduled_medications )):?>
			      	<?php foreach($this->dosage_intervals['isintubated'] as $k => $di):?>
			       		{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
			       	<?php $column++; endforeach; ?>
			    <?php else: ?>
				    	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
				    	<?php $column++;?>
		       	<?php endif;?>
				       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"kcal_hidden" }, // medication_kcal -HIDDEN
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+2;?>, "searchable": true, "orderable": true, "name":"volume_hidden" }, // medication_volume -HIDDEN

				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+3;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 4;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number+5;?>, "searchable": true, "orderable": true, "name":"medication_importance" } // medication_importance
				],			
				
		order: [[isintubated_sorting.col,isintubated_sorting.ord]],
		
     "drawCallback": function ( settings ) {
         var api = this.api();
         var rows = api.rows( {page:'current'} ).nodes();
         
        api.rows( {page:'current'} ).every(function(){

	        	var classnow="odd";
	           	if ($(this.node()).hasClass('even')){
	           		classnow = 'even';
	           	}
	           	
     	   if( $(this.node()).data('medid') != undefined) {
                var medid = $(this.node()).data('medid');
                var ack_moderate = '';
                if ($( "#ack_information_"+medid ).length) {
                    ack_moderate += $( "#ack_information_"+medid ).html();
                }
                if ($( ".ack_information_offline_"+medid ).length) {
                    $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                }                   
                this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
            } else { 
                this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
            }
     	   
        });

     },

		initComplete: function()
		{
//			console.log(this.api().order());
			
			if(isintubated_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isintubated').removeClass('sorting');
			$('#drug_isintubated').removeClass('sorting_asc');
			$('#drug_isintubated').removeClass('sorting_desc');
			$('#drug_isintubated').addClass('sorting_'+isintubated_sorting.ord);
		} 
		else
		{
			$('#drug_isintubated').removeClass('sorting_asc');
			$('#drug_isintubated').removeClass('sorting_desc');
			$('#drug_isintubated').addClass('sorting');
			
		}
		
		/*
		if(isintubated_sorting.col == this.api().column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isintubated').removeClass('sorting');
			$('#med_type_isintubated').removeClass('sorting_asc');
			$('#med_type_isintubated').removeClass('sorting_desc');
			$('#med_type_isintubated').addClass('sorting_'+isintubated_sorting.ord);
		} 
		else
		{
			$('#med_type_isintubated').removeClass('sorting_asc');
			$('#med_type_isintubated').removeClass('sorting_desc');
			$('#med_type_isintubated').addClass('sorting');
			
		}
		*/
		/*
		if(isintubated_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isintubated').removeClass('sorting');
			$('#concentration_isintubated').removeClass('sorting_asc');
			$('#concentration_isintubated').removeClass('sorting_desc');
			$('#concentration_isintubated').addClass('sorting_'+isintubated_sorting.ord);
		} 
		else
		{
			$('#concentration_isintubated').removeClass('sorting_asc');
			$('#concentration_isintubated').removeClass('sorting_desc');
			$('#concentration_isintubated').addClass('sorting');
			
		}
		*/
		/*
		if(isintubated_sorting.col ==  this.api().column('medication_dosage_form_hidden:name').index()) { //Concentration
			$('#dosage_form_isintubated')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+isintubated_sorting.ord);
		} 
		else
		{
			$('#dosage_form_isintubated')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');		
		}
		*/
		 
		/* 
		if(isintubated_sorting.col == this.api().column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isintubated').removeClass('sorting');
			$('#comments_isintubated').removeClass('sorting_asc');
			$('#comments_isintubated').removeClass('sorting_desc');
			$('#comments_isintubated').addClass('sorting_'+isintubated_sorting.ord);
		} 
		else
		{
			$('#comments_isintubated').removeClass('sorting_asc');
			$('#comments_isintubated').removeClass('sorting_desc');
			$('#comments_isintubated').addClass('sorting');
			
		}
		*/
			
		}
     
	});

	/*-------------- SORTING isintubated ------------------------------*/
	var isintubated_order = table_isintubated.order();
	
	if(isintubated_order){
//		console.log(isintubated_order);
		var isintubated_columnheader = table_isintubated.column( isintubated_order[0][0] ).header();
		var isintubated_sorted_column = $(isintubated_columnheader).data('sortname');
		var isintubated_sorted_dir = isintubated_order[0][1];
		
		$('#isintubated_sort_by').val(isintubated_sorted_column);
		$('#isintubated_sort_dir').val(isintubated_sorted_dir);
	}
	
	table_isintubated.order.listener( $('#drug_isintubated'), table_isintubated.column('medication_drug_hidden:name').index() );
	//table_isintubated.order.listener( $('#med_type_isintubated'), table_isintubated.column('medication_type_hidden:name').index() );
	//table_isintubated.order.listener( $('#concentration_isintubated'), table_isintubated.column('medication_concentration_hidden:name').index() );
	//table_isintubated.order.listener( $('#dosage_form_isintubated'), table_isintubated.column('medication_dosage_form_hidden:name').index() );
	//table_isintubated.order.listener( $('#comments_isintubated'), table_isintubated.column('comment_hidden:name').index() );
	
	$('.medication_table_isintubated').on("order.dt",function(){
		var order = table_isintubated.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		var isintubated_columnheader = table_isintubated.column( order[0][0] ).header();
		var column_name = $(isintubated_columnheader).data('sortname');
		
		/* save sorting */
		save_sorting("medication-isintubated",order);
		
		
		if(order[0][0] == table_isintubated.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_isintubated').removeClass('sorting');
			$('#drug_isintubated').removeClass('sorting_asc');
			$('#drug_isintubated').removeClass('sorting_desc');
			$('#drug_isintubated').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_isintubated').removeClass('sorting_asc');
			$('#drug_isintubated').removeClass('sorting_desc');
			$('#drug_isintubated').addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_isintubated.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_isintubated').removeClass('sorting');
			$('#med_type_isintubated').removeClass('sorting_asc');
			$('#med_type_isintubated').removeClass('sorting_desc');
			$('#med_type_isintubated').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_isintubated').removeClass('sorting_asc');
			$('#med_type_isintubated').removeClass('sorting_desc');
			$('#med_type_isintubated').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] ==  table_isintubated.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_isintubated').removeClass('sorting');
			$('#concentration_isintubated').removeClass('sorting_asc');
			$('#concentration_isintubated').removeClass('sorting_desc');
			$('#concentration_isintubated').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_isintubated').removeClass('sorting_asc');
			$('#concentration_isintubated').removeClass('sorting_desc');
			$('#concentration_isintubated').addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_isintubated.column('medication_dosage_form_hidden:name').index()) { //dosage
			$('#dosage_form_isintubated')
				.removeClass('sorting')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_form_isintubated')
				.removeClass('sorting_asc')
				.removeClass('sorting_desc')
				.addClass('sorting');
			
		}
		*/
		/*
		if(order[0][0] == table_isintubated.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_isintubated').removeClass('sorting');
			$('#comments_isintubated').removeClass('sorting_asc');
			$('#comments_isintubated').removeClass('sorting_desc');
			$('#comments_isintubated').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_isintubated').removeClass('sorting_asc');
			$('#comments_isintubated').removeClass('sorting_desc');
			$('#comments_isintubated').addClass('sorting');
			
		}
		*/
		var isintubated_order = table_isintubated.order();
		
		if(isintubated_order){
			var isintubated_columnheader = table_isintubated.column( isintubated_order[0][0] ).header();
			var isintubated_sorted_column = $(isintubated_columnheader).data('sortname');
			var isintubated_sorted_dir = isintubated_order[0][1];
			
			$('#isintubated_sort_by').val(isintubated_sorted_column);
			$('#isintubated_sort_dir').val(isintubated_sorted_dir);
		}
	});
	
	
<?php endif; ?>	








	
	/* ######################## MEDICATION DELETED ######################## */
		$(document).off('click',".renew_ajx").on('click',".renew_ajx", function(){
			var trid = $(this).closest('tr').attr('id');
			var drug_id = $(this).attr('rel');
			var pid = "<?php echo $_GET['id']; ?>";
			renew_medication(drug_id,pid,trid);
		});
		
		
		
		
		function renew_medication(mid,pid,trid)
		{
			var allow_changes = "<?php echo $this->allow_changes;?>"
			var approval_rights = "<?php echo $this->approval_rights;?>"
			var acknowledge = "<?php echo $this->acknowledge;?>"
					
			if(mid>0){
				$.ajax({
					url:'patient/patientmedicationchange?mid='+mid+'&id='+pid+'&act=rnw&noredir=1',
					async: false						
				});
			}
			
			location.href = "<?php echo APP_BASE ?>patientnew/medication?flg=suc&id=<?php echo $_REQUEST['id']; ?>";
			
		}
	
	
	/* ######################## MEDICATION SHARED DATA ######################## */
		$('#shared_meds').live('click', function(e){
		e.preventDefault();
		  var drugplan_id = $(this).data("drugplan_id");
		  var medication_type = $(this).data("medication_type");
		  
		$('.medication_shared_meds').load('<?php  echo APP_BASE."patientnew/medicationshared?id=".$_REQUEST['id'].""; ?>', function() {
			$('.medication_shared_meds').dialog('open');
		});
	});
	
	
	$('#shared_meds_cron').live('click', function(e){
		e.preventDefault();
		var url = '<?php echo APP_BASE; ?>cron/runsharemedications';
		xhr = $.ajax({
			url : url,
			success : function(response) {
				//console.log("cron");
				alert("Completed!")
			}
		});

	});


	$( ".medication_shared_meds" ).dialog({
		autoOpen: false,
		resizable: false,
		title: "<?php echo $this->translate('medication_shared_meds')?>",
		height: 550,
		width: 900,
		modal: true,
		open: function() {
			$(this).dialog( "option", "buttons", 
					[ 
						{
							text: "<?php echo $this->translate('save')?>", 
							"class": 'cancelButtonClass',
							click: function() {
// 								$( this ).dialog( "close" );
								$('#share_medications').submit();
								//console.log("save changes");
							}
						},
						{
							text: "<?php echo $this->translate('cancel')?>", 
							"class": 'cancelButtonClass',
							click: function() {
								$( this ).dialog( "close" );
							}
						}
				]
			);
		},
		close: function() {
			
		}

	});
	
	/* ######################## MEDICATION HISTORY ######################## */
		$('.show_medication_info').live('click', function(e){
		e.preventDefault();
		  var drugplan_id = $(this).data("drugplan_id");
		  var medication_type = $(this).data("medication_type");
		  
		$('.medication_history').load('<?php  echo APP_BASE."patientnew/medicationhistory?id=".$_REQUEST['id']."&drugplan_id='+drugplan_id+'"; ?>', function() {
			$('.medication_history').dialog('open');
		});
	});


	$( ".medication_history" ).dialog({
		autoOpen: false,
		resizable: false,
		title: "<?php echo $this->translate('medication history')?>",
		height: 450,
		width: 850,
		modal: true,
		open: function() {
			$(this).dialog( "option", "buttons", 
					[ 
						{
							text: "<?php echo $this->translate('cancel')?>", 
							"class": 'cancelButtonClass',
							click: function() {
								$( this ).dialog( "close" );
							}
						},
				]
			);
		},
		close: function() {
			
		}

	});
	/* ######################## MEDICATION SETS  ######################## */
	$('.MedicSetButton').live('click', function(e){
		e.preventDefault();
		
		var pat = "<?php echo $_REQUEST['id'];?>";
		var set_type = $(this).data("med_block");
		var url = appbase+'patientnew/medicationsets?id='+pat+'&set_type='+set_type;
		xhr = $.ajax({
			url : url,
			success : function(response) {
				$('.medication_sets').html(response);
				$('.medication_sets').dialog('open');
			}
		});
	});
	$( ".medication_sets" ).dialog({
		autoOpen: false,
		resizable: false,
		title: "<?php echo $this->translate('2247 - Medication sets ')?>",
		height: 550,
		width: 900,
		modal: true,
		open: function() {
			$(this).dialog( "option", "buttons", 
					[ 
						{
							text: "<?php echo $this->translate('save')?>", 
							"class": 'cancelButtonClass',
							click: function() {
// 								$( this ).dialog( "close" );
								$('#add_set_medication').submit();
								//console.log("save changes");
							}
						},
						{
							text: "<?php echo $this->translate('cancel')?>", 
							"class": 'cancelButtonClass',
							click: function() {
								$( this ).dialog( "close" );
							}
						}
				]
			);
		},
		close: function() {
			
		}

	});
	
	
	
// 	$(document).on('click', '.MedicSetButton', function(){
// 		var med_block = $(this).data("med_block");
//     	$("#MedicSet").dialog("option","title", translate(med_block.trim())+translate('add_set_dialog')).data('med_block', med_block.trim()).dialog("open");
// 	     return false;
// 	});
		
	
	
	/* ######################## PATIENT TIME SCHEME ######################## */
	var max_fields      = 12; //maximum input boxes allowed
    var x = "<?php echo count($this->interval_array['interval']['all']); ?>"; //initlal text box count - get existing
    var interval_id = "";
    var new_int_id  = "";
    
    
	if(x > 4){
    	$('.delete_interval').each(function(i, obj) {
        	$(this).removeClass('hidden_delete');
    	});
	} 
    
    
	$('.int_time').mask("99:99"); //add hours and minute mask
	
    $('.int_time').timepicker({
		onSelect : function(time_value) {
			$(this).focus();
			return false;
		},
		minutes : {
			interval : 5
		},
		showPeriodLabels : false,
		rows : 4,
		hourText : 'Stunde',
		minuteText : 'Minute'
    	
    });
	
    function reset_ints(){
    	var interval_number = 1;        	
    	$('.time_table td a.add_before').each(function(i, obj) {
        	$(this).attr("rel", interval_number);
        	interval_number++;
    	});
    	
    	var interval_number_after = 100;        	
    	$('.time_table td a.add_after').each(function(i, obj) {
        	$(this).attr("rel", interval_number_after);
        	interval_number_after++;
    	});
    	
    	var interval_number_delete = 1;        	
    	$('.time_table td a.delete_interval').each(function(i, obj) {
        	$(this).attr("rel", interval_number_delete);
        	interval_number_delete++;
    	});
 
    	
    	// reset td id 
    	var interval_td = 1;
    	$('.time_table td.td_block').each(function(i, obj) {
	        $(this).attr("id", interval_td);
        	interval_td++;
    	});
    	
    	
    	// add 
    	$('.time_table td.td_block').each(function(i) {
    		var new_td_id = $(this).attr("id")
    		
    		$(this).find(":input").each(function(){
    			
    			if($(this).attr("rel") == "time"){
    		    	$(this).attr("name", "interval[all]["+new_td_id+"][time]");
    	    	}
    			
    			
    	    	if($(this).attr("rel") == "custom"){
    		    	$(this).attr("name", "interval[all]["+new_td_id+"][custom]");
    	    	}
    	    	
    	    	if($(this).attr("rel") == "interval_id"){
    		       	$(this).attr("name", "interval[all]["+new_td_id+"][interval_id]");
    	    	}
			});  
    	});
    	
    	
    	if(x > 4){
	    	$('.delete_interval').each(function(i, obj) {
	        	$(this).removeClass('hidden_delete');
	    	});
    	} 
    	else
    	{
	    	$('.delete_interval').each(function(i, obj) {
	        	$(this).removeClass('hidden_delete');
	        	$(this).addClass('hidden_delete');
	    	});
    	}
    	
    }    
	

    $('.add_before').live('click',function(e){ //on add input button click
        e.preventDefault();
    
		var interval_id  = $(this).attr("rel");
		var new_int_id = interval_id+1000;
		
		var new_td ='';
        if(x < max_fields){ //max input box allowed
            x++; //text box increment
            
            var  td_s ='<td class="td_block custom">';
            var  add_link ='<a href="javascript:void(0)" class="add_before" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
            var  input ='<input type="text" value=""  rel="time"  name="interval[all]['+new_int_id+'][time]"  class="time_interval gen_int_time" />';
            var  input_custom ='<input type="hidden" value="1" rel="custom"  name="interval[all]['+new_int_id+'][time]"  class="" />';
            var  add_after_link ='<a href="javascript:void(0)" class="add_after" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
            var  delete_link ='<br/><a href="javascript:void(0)" class="delete_interval "><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>';
            var  td_e ='</td>';
            
            new_td = td_s + add_link + input + input_custom + delete_link + td_e ;
            
            
            $(new_td).insertBefore($(this).parent());
            
        	$('.gen_int_time').mask("99:99"); //add hours and minute mask
        	$('.gen_int_time').timepicker({
        		onSelect : function(time_value) {
        			$(this).focus();
        			return false;
        		},
        		minutes : {
        			interval : 5
        		},
        		showPeriodLabels : false,
        		rows : 4,
        		hourText : 'Stunde',
        		minuteText : 'Minute'
            });
        	
        	reset_ints();
        }
    });
    
    
    $('.add_after').live('click',function(e){ //on add input button click
        e.preventDefault();
    
		var interval_id  = $(this).attr("rel");
		var new_int_id = interval_id+100;
		
		var new_td ='';
        if(x < max_fields){ //max input box allowed
            x++; //text box increment
            
            var  td_s ='<td class="td_block custom">';
            var  add_link ='<a href="javascript:void(0)" class="add_before" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
            var  input ='<input type="text" value=""  rel="time"   name="interval[all]['+new_int_id+'][time]"  class="time_interval gen_int_time" />';
            var  input_custom ='<input type="hidden" value="1" rel="custom"  name="interval[all]['+new_int_id+'][time]"  class="" />';
            var  add_after_link ='<a href="javascript:void(0)" class="add_after" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
            var  delete_link ='<br/><a href="javascript:void(0)" class="delete_interval"><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>';
            var  td_e ='</td>';
            
            new_td = td_s +  input + input_custom + add_after_link +delete_link + td_e ;
            
            
            $(new_td).insertAfter($(this).parent())
            
        	$('.gen_int_time').mask("99:99"); //add hours and minute mask
        	$('.gen_int_time').timepicker({
        		onSelect : function(time_value) {
        			$(this).focus();
        			return false;
        		},
        		minutes : {
        			interval : 5
        		},
        		showPeriodLabels : false,
        		rows : 4,
        		hourText : 'Stunde',
        		minuteText : 'Minute'
            });
        	
        	reset_ints();
        }
    });
 

	$('.delete_interval').live('click',function(e){
		e.preventDefault();
		var mt = "all";
		if(x > 4){
			
			var td_id = $(this).parent().attr('id');
			var new_del_id = $('input[name="interval[all]['+td_id+'][interval_id]"]').val();
			
			
			if($('input[name="interval[all]['+td_id+'][custom]"]').val() == "0"){ // this means that the interval is already in system
				jConfirm('<? echo $this->translate('confirmdeleterecord: Note that the time column will be deleted from all patient medication dosage'); ?>', '<? echo $this->translate('confirmdeletetitle'); ?>', function(r) {
					if(r)
					{
						var del_ids = $('#deleted_intervals_all').val();
						// ad interval id in - deleted intervals - to be deleted
						if(new_del_id)
						{
							$('#deleted_intervals_all').val(del_ids+','+new_del_id)
						}
						
						// remove curent td from table
						$("table.time_table td[id="+td_id+"]").remove(); 
						
				    	x--;
				    	reset_ints("all");
					}
				});
			}
			else
			{
		     	if(x > 4)
		     	{
	 	    		$(this).parent().remove();
	 	    		x--;
	 	    		reset_ints("all");	
		     	} 
		     	else
		     	{
		     		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
		     	}
		
				
			}
		}
		else
    	{
    		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
    	}
	});
    
    
    
/* 	$('.delete_interval').live('click',function(e){
		e.preventDefault();
		console.log()
		if(x > 4){
			
			var td_id = $(this).parent().attr('id');
			var new_del_id = $('input[name="interval['+td_id+'][interval_id]"]').val();
			
			if($('input[name="interval['+td_id+'][custom]"]').val() == "0"){ // this means that the interval is already in system
				jConfirm('<? echo $this->translate('confirmdeleterecord: Note that the time column will be deleted from all patient medication dosage'); ?>', '<? echo $this->translate('confirmdeletetitle'); ?>', function(r) {
					if(r)
					{
						var del_ids = $('#deleted_intervals').val();
						// ad interval id in - deleted intervals - to be deleted
						if(new_del_id)
						{
							$('#deleted_intervals').val(del_ids+','+new_del_id)
						}
						
						// remove curent td from table
						$("table.time_table td[id="+td_id+"]").remove(); 
						
				    	x--;
				    	reset_ints();
					}
				});
			}
			else
			{
		     	if(x > 4)
		     	{
	 	    		$(this).parent().remove();
	 	    		x--;
	 	    		reset_ints();	
		     	} 
		     	else
		     	{
		     		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
		     	}
				
				
			}
		}
		else
    	{
    		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
    	}
	}); */
	
	//localStorage.clear();


	 // Add event listener for opening and closing child details row
	$('.datatable tbody').on('click', 'div.medi_child_toggle_td_arrow', function () {
 	
		var table_id = $(this).closest('table.datatable').attr('id');

		var tr = $(this).closest('tr').prev();
	
		var tr_class = tr.attr("class") + " child_row_toggler";
		
		if (window['table_'+table_id] !== undefined) {

			var row = window['table_'+table_id] .row( tr );

			var medid = 0;
			var ack_moderate = '';
			
			
			if(tr != undefined && tr.data('medid') != undefined) {
                medid = tr.data('medid');
                              
                if ($( "#ack_information_"+medid ).length) {
                    ack_moderate += $( "#ack_information_"+medid ).html();
                }
                if ($( ".ack_information_offline_"+medid ).length) {
                    $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                }
			}
			
			
			if ( tr.hasClass('shown') ) {
				// This row is already open - close it
				
				row.child().remove();
				
				if(ack_moderate != '') {
					medid = tr.data('medid');
					row.child( [content_toggler_row, ack_moderate] , tr_class ).show();
				} else {
					tr_class += " toggler_closed";
					row.child( [content_toggler_row] , tr_class).show();
				}
				tr.removeClass('shown');
			}
			else {
				// Open this row
				if (ack_moderate != '') {
					row.child( [content_toggler_row, datatable_format_child_row(row.data() , tr), ack_moderate] , tr_class).show();
				} else {
					row.child( [content_toggler_row, datatable_format_child_row(row.data() , tr)] , tr_class).show();
				}
				tr.addClass('shown');
			}
		}
	});
	
 
	
	$('.all_print_medication').each(function(){
		if($(this).is(':checked')){
			$('#select_all').attr('checked', true)
		}
	});
	
	$('#select_all').live('click', function(){
		
		if($(this).is(':checked')){
			$('.all_print_medication').each(function(){
				$(this).attr('checked', true)
			});
		} else {
			$('.all_print_medication').each(function(){
				$(this).attr('checked', false)
			});
		}
	});
 
	
});/*-- END  $(document).ready ----------- --*/


	/* Formatting function for row details - modify as you need */
	function datatable_format_child_row ( d , tr ) {
	
		var background_color = tr.css("background-color");
	  
		var borde_bottom = '';
		if(tr != undefined && tr.data('medid') != undefined) {
			
		} else {
			borde_bottom = "style='border-bottom: 2px solid #000;'";
		}
		
		var concentration = '';	  
		<?php if ($this->show_new_fileds == "1") : ?>
		if (d != undefined && typeof( d.concentration ) !=='undefined') {
			concentration = d.concentration;
		}
		<?php endif; ?>
	  
		var days_interval = '';
		if (d != undefined && typeof( d.days_interval ) !=='undefined') {
			days_interval = d.days_interval;
		}
	
		
		var content_extra = '';
		if (days_interval != '' || concentration != '' ){
			content_extra = '<tr style="background-color:' + background_color + '">'+
			'<td '+borde_bottom+'>'+concentration+'</td>'+
			'<td '+borde_bottom+'>'+days_interval+'</td>'+
			'</tr>';
		}
	  
	
	   // `d` is the original data object for the row
	   return '<table cellpadding="0" cellspacing="0" width="100%" style=" background-color:' + background_color + '">'
	   		+ content_extra 
			+ '</table>';
	}
		
	
	var open_now_status = false;   
	
	function toggle_all_extra_info(_this, table_id) {
				
		var open_now = open_now_status;
		//var open_now = $(_this).data('is_open');
		
		if ( open_now ) {		
			open_now =  true;			
			open_now_status =  false;	
			
		} else {
			open_now = false;
			open_now_status = true;
		}
		
		//$(_this).data('is_open' , (open_now_status));
		
		$('div.medi_child_toggle_td_arrow').each(function(){
			$(this).trigger('click');
			return;
		
		//$('div.medi_child_toggle_td_arrow' , $("#"+table_id)).each(function(){
			 
			var table_id = $(this).closest('table.datatable').attr('id');
	
			var tr = $(this).closest('tr').prev();
			
			var tr_class = tr.attr("class") + " child_row_toggler";
			
			if (window['table_'+table_id] !== undefined) {
				
				var row = window['table_'+table_id].row( tr );
				
				var ack_moderate = '';
				var medid = 0;
				if(tr != undefined && tr.data('medid') != undefined) {
	                medid = tr.data('medid');
	                
	                if ($( "#ack_information_"+medid ).length) {
	                    ack_moderate += $( "#ack_information_"+medid ).html();
	                }
	                if ($( ".ack_information_offline_"+medid ).length) {
	                    $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
	                }
	            }
				
				
						
				if ( open_now ) {
					// This row is already open - close it
					row.child().remove();
					if (ack_moderate != '' ){
						row.child( [content_toggler_row, ack_moderate] , tr_class ).show();
					} else {
						tr_class += " toggler_closed";
						row.child( [content_toggler_row] , tr_class).show();
					}
					
					//row.child( [content_toggler_row, datatable_format_child_row({} , tr)] , tr_class).show();
					tr.removeClass('shown');
				}
				else {
					// Open this row
					if (ack_moderate != '' ){
						row.child( [content_toggler_row, datatable_format_child_row(row.data() , tr), ack_moderate] , tr_class).show();
					} else {
						row.child( [content_toggler_row, datatable_format_child_row(row.data() , tr)] , tr_class).show();
					}
					//row.child( [content_toggler_row, datatable_format_child_row(row.data() , tr)] , tr_class).show();
					tr.addClass('shown');
				}	
			}
		});
		
		return;	
		
}
</script>
<style>
 .outer{ 
 	width: 100%!important; 
}

 #Wrapper { 
     width: 98%!important; 
}
.mifo
{
	display: block;
	width: 100%;
	min-height:50px;
}
</style>

<?php //echo $this->patientinfo ?>
<?php //echo $this->tabmenus ?>
<?php $medication_array = $this->medication?>

<!-- ####################################### Take over buttons  ################################################# -->
<?php if($this->show_take_over == "1"):?>
<div class="patient_time_scheme">
	<button id="shared_meds"><?php echo $this->translate('take over button')?></button>
	<!--  
	
	<button id="shared_meds_cron"><?php echo $this->translate('DEV ONLY - get shared meds for modal -')?></button>
	 
	 -->
</div>
<?php endif;?>
<!-- ####################################### Time scheme  ################################################# -->
<div class="err"><?php echo $this->error_message ?></div>

<?php
/**
 **	Time scheme is disabled on this view !
**/
?>
<?php if (!1) : ?>
<div class="patient_time_scheme" style="display:none">

	<div class="time_title_master <?php if($this->individual_medication_time == '1'): ?> border_bottom <?php endif;?>"><h1><?php echo $this->translate('Patient time scheme for dosage')?></h1></div>
	
	<form action="" method="post" name="patient_time_scheme" id="patient_time_scheme" >
		<!--  LIST ERRORS -->
		<?php foreach ($this->errors as $key => $val):?>
			<div class="clearer"></div>
			<?php foreach ($val as  $value) :?>
				<span class="error"><?php echo $value ?></span>
			<?php endforeach?>
		<?php endforeach?>
		
		<!--  TIME INTERVAL TABLE -->
		<?php if($this->individual_medication_time == "0"): ?>
			<table cellpadding="0" cellspacing="0" class="time_table">
				<tr>
				<?php $rel = "1"; $int_id = "1";?> 
				<?php foreach($this->interval_array['interval']['all']  as $interval_id => $interval_details):?>
					<td class = "td_block" id="<?php echo $int_id;?>">
						<a href="javascript:void(0)" class="add_before change" rel="<?php echo $rel; ?>" > <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>
						<input type="text" rel="time" value="<?php echo $interval_details['time']; ?>"   class="time_interval int_time" name="interval[all][<?php echo $int_id;?>][time]" />
						<input type="hidden" rel="custom" value="<?php echo $interval_details['custom']; ?>"  class="" name="interval[all][<?php echo $int_id;?>][custom]" />
						<?php if( $interval_details['custom'] != "1"):?>
						<input type="hidden" rel="interval_id" value="<?php echo $interval_id; ?>"  class="" name="interval[all][<?php echo $int_id;?>][interval_id]" />
						<?php endif;?>
						<br/>
						<a href="javascript:void(0)" class="delete_interval hidden_delete "><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>
					</td>
				<?php $rel++; $int_id++; ?>
				<?php endforeach;?>
					<td>
						<a href="javascript:void(0)" class="add_after change" rel="104"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>
					</td>
				</tr>
			</table>
		
		<!-- 	INPUT FOR DELETED TIME INTERVALS-->
		<input type="hidden" id="deleted_intervals_all" name="deleted_intervals_ids[all]" value="<?php echo $this->deleted_intervals_ids?>" />
		
		<?php else: 
		
		?>
			<?php foreach($this->timed_scheduled_medications as $k=>$med_type):?>
			<script type="text/javascript">
			$(document).ready(function() { /*------ Start $(document).ready --------------------*/

			/* ######################## PATIENT TIME SCHEME ######################## */
			var mt = "<?php echo $med_type; ?>"; 
			var max_fields = 12; //maximum input boxes allowed
		    var x = "<?php echo count($this->interval_array['interval'][$med_type]); ?>"; //initlal text box count - get existing
		    var interval_id= "";
		    var new_int_id = "";
		    
		    
			if(x > 4){
		    	$('.delete_interval_'+mt).each(function(i, obj) {
		        	$(this).removeClass('hidden_delete');
		    	});
			} 
		    
		    
			$('.int_time_'+mt).mask("99:99"); //add hours and minute mask
			
		    $('.int_time_'+mt).timepicker({
				onSelect : function(time_value) {
					$(this).focus();
					return false;
				},
				minutes : {
					interval : 5
				},
				showPeriodLabels : false,
				rows : 4,
				hourText : 'Stunde',
				minuteText : 'Minute'
		    	
		    });
			
		    function reset_ints(mt){
		    	var interval_number = 1;        	
		    	$('.time_table_'+mt+' td a.add_before_'+mt).each(function(i, obj) {
		        	$(this).attr("rel", interval_number);
		        	interval_number++;
		    	});
		    	
		    	var interval_number_after = 100;        	
		    	$('.time_table_'+mt+' td a.add_after_'+mt).each(function(i, obj) {
		        	$(this).attr("rel", interval_number_after);
		        	interval_number_after++;
		    	});
		    	
		    	var interval_number_delete = 1;        	
		    	$('.time_table_'+mt+' td a.delete_interval_'+mt).each(function(i, obj) {
		        	$(this).attr("rel", interval_number_delete);
		        	interval_number_delete++;
		    	});
		 
		    	
		    	// reset td id 
		    	var interval_td = 1;
		    	$('.time_table_'+mt+' td.td_block').each(function(i, obj) {
			        $(this).attr("id", interval_td);
		        	interval_td++;
		    	});
		    	
		    	
		    	// add 
		    	$('.time_table_'+mt+' td.td_block').each(function(i) {
		    		var new_td_id = $(this).attr("id")
		    		
		    		$(this).find(":input").each(function(){
		    			
		    			if($(this).attr("rel") == "time"){
		    		    	$(this).attr("name", "interval["+mt+"]["+new_td_id+"][time]");
		    	    	}
		    			
		    			
		    	    	if($(this).attr("rel") == "custom"){
		    		    	$(this).attr("name", "interval["+mt+"]["+new_td_id+"][custom]");
		    	    	}
		    	    	
		    	    	if($(this).attr("rel") == "interval_id"){
		    		       	$(this).attr("name", "interval["+mt+"]["+new_td_id+"][interval_id]");
		    	    	}
					});  
		    	});
		    	
		    	
		    	if(x > 4){
			    	$('.delete_interval_'+mt).each(function(i, obj) {
			        	$(this).removeClass('hidden_delete');
			    	});
		    	} 
		    	else
		    	{
			    	$('.delete_interval_'+mt).each(function(i, obj) {
			        	$(this).removeClass('hidden_delete');
			        	$(this).addClass('hidden_delete');
			    	});
		    	}
		    	
		    }    
			

		    $('.add_before_'+mt).live('click',function(e){ //on add input button click
		        e.preventDefault();
		    
				var interval_id  = $(this).attr("rel");
				var new_int_id = interval_id+1000;
				
				var new_td ='';
		        if(x < max_fields){ //max input box allowed
		            x++; //text box increment
		            
		            var  td_s ='<td class="td_block custom">';
		            var  add_link ='<a href="javascript:void(0)" class="add_before_'+mt+'" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
		            var  input ='<input type="text" value=""  rel="time"  name="interval['+mt+']['+new_int_id+'][time]"  class="time_interval_'+mt+' gen_int_time_style gen_int_time_'+mt+'" />';
		            var  input_custom ='<input type="hidden" value="1" rel="custom"  name="interval['+mt+']['+new_int_id+'][time]"  class="" />';
		            var  add_after_link ='<a href="javascript:void(0)" class="add_after_'+mt+'" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
		            var  delete_link ='<br/><a href="javascript:void(0)" class="delete_interval_'+mt+'"><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>';
		            var  td_e ='</td>';
		            
		            new_td = td_s + add_link + input + input_custom + delete_link + td_e ;
		            
		            
		            $(new_td).insertBefore($(this).parent());
		            
		        	$('.gen_int_time_'+mt).mask("99:99"); //add hours and minute mask
		        	$('.gen_int_time_'+mt).timepicker({
		        		onSelect : function(time_value) {
		        			$(this).focus();
		        			return false;
		        		},
		        		minutes : {
		        			interval : 5
		        		},
		        		showPeriodLabels : false,
		        		rows : 4,
		        		hourText : 'Stunde',
		        		minuteText : 'Minute'
		            });
		        	
		        	reset_ints(mt);
		        }
		    });
		    
		    $('.add_after_'+mt).live('click',function(e){ //on add input button click
		        e.preventDefault();
				var interval_id  = $(this).attr("rel");
				var new_int_id = interval_id+100;
				
				var new_td ='';
		        if(x < max_fields){ //max input box allowed
		            x++; //text box increment
		            
		            var  td_s ='<td class="td_block custom">';
		            var  add_link ='<a href="javascript:void(0)" class="add_before_'+mt+'" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
		            var  input ='<input type="text" value=""  rel="time"   name="interval['+mt+']['+new_int_id+'][time]"  class="time_interval_'+mt+' gen_int_time_style gen_int_time_'+mt+'" />';
		            var  input_custom ='<input type="hidden" value="1" rel="custom"  name="interval['+mt+']['+new_int_id+'][time]"  class="" />';
		            var  add_after_link ='<a href="javascript:void(0)" class="add_after_'+mt+'" rel="'+new_int_id+'"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>';
		            var  delete_link ='<br/><a href="javascript:void(0)" class="delete_interval_'+mt+'"><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>';
		            var  td_e ='</td>';
		            
		            new_td = td_s +  input + input_custom + add_after_link +delete_link + td_e ;
		            
		            
		            $(new_td).insertAfter($(this).parent())
		            
		        	$('.gen_int_time_'+mt).mask("99:99"); //add hours and minute mask
		        	$('.gen_int_time_'+mt).timepicker({
		        		onSelect : function(time_value) {
		        			$(this).focus();
		        			return false;
		        		},
		        		minutes : {
		        			interval : 5
		        		},
		        		showPeriodLabels : false,
		        		rows : 4,
		        		hourText : 'Stunde',
		        		minuteText : 'Minute'
		            });
		        	
		        	reset_ints(mt);
		        }
		    });
		 

			$('.delete_interval_'+mt).live('click',function(e){
				e.preventDefault();

				if(x > 4){
					
					var td_id = $(this).parent().attr('id');
					var new_del_id = $('input[name="interval['+mt+']['+td_id+'][interval_id]"]').val();
					
					
					if($('input[name="interval['+mt+']['+td_id+'][custom]"]').val() == "0"){ // this means that the interval is already in system
						jConfirm('<? echo $this->translate('confirmdeleterecord: Note that the time column will be deleted from all patient medication dosage'); ?>', '<? echo $this->translate('confirmdeletetitle'); ?>', function(r) {
							if(r)
							{
								var del_ids = $('#deleted_intervals_'+mt).val();
								// ad interval id in - deleted intervals - to be deleted
								if(new_del_id)
								{
									$('#deleted_intervals_'+mt).val(del_ids+','+new_del_id)
								}
								
								// remove curent td from table
								$("table.time_table_"+mt+" td[id="+td_id+"]").remove(); 
								
						    	x--;
						    	reset_ints(mt);
							}
						});
					}
					else
					{
				     	if(x > 4)
				     	{
			 	    		$(this).parent().remove();
			 	    		x--;
			 	    		reset_ints(mt);	
				     	} 
				     	else
				     	{
				     		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
				     	}
						
						
					}
				}
				else
		    	{
		    		alert("<?php echo $this->translate('You shall not pass !!!!');?>")	
		    	}
			});
			
		});/*-- END  $(document).ready ----------- --*/


		</script>

			<div class="time_title"><?php echo $this->translate($med_type." medication title time")?></div>
			<div class="time_table_bl">
				<table cellpadding="0" cellspacing="0" class="time_table time_table_<?php echo $med_type; ?>">
					<tr>
					<?php $rel = "1"; $int_id = "1";?> 
					<?php foreach($this->interval_array['interval'][$med_type]  as $interval_id => $interval_details):?>
						<td class = "td_block" id="<?php echo $int_id;?>">
							<a href="javascript:void(0)" class="add_button add_before_<?php echo $med_type; ?> change" rel="<?php echo $rel; ?>" > <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>
							<input type="text" rel="time" value="<?php echo $interval_details['time']; ?>"   class="time_interval_style  int_time_style time_interval_<?php echo $med_type; ?> int_time_<?php echo $med_type; ?>" name="interval[<?php echo $med_type; ?>][<?php echo $int_id;?>][time]" />
							<input type="hidden" rel="custom" value="<?php echo $interval_details['custom']; ?>"  class="" name="interval[<?php echo $med_type; ?>][<?php echo $int_id;?>][custom]" />
							<?php if( $interval_details['custom'] != "1"):?>
							<input type="hidden" rel="interval_id" value="<?php echo $interval_id; ?>"  class="" name="interval[<?php echo $med_type; ?>][<?php echo $int_id;?>][interval_id]" />
							<?php endif;?>
							<br/>
							<a href="javascript:void(0)" class="delete_interval_<?php echo $med_type; ?> hidden_delete "><img src="<?php echo RES_FILE_PATH ?>/images/action_delete.png" alt="delete" width="13px" /></a>
						</td>
					<?php $rel++; $int_id++; ?>
					<?php endforeach;?>
						<td>
							<a href="javascript:void(0)" class="add_button add_after_<?php echo $med_type; ?> change" rel="104"> <img src="<?php echo RES_FILE_PATH ?>/images/edit_add.png" alt="add" width="15px"/></a>
						</td>
					</tr>
				</table>
			</div>
		<!-- 	INPUT FOR DELETED TIME INTERVALS-->
		<input type="hidden" id="deleted_intervals_<?php echo $med_type; ?>" name="deleted_intervals_ids[<?php echo $med_type; ?>]" value="<?php echo $this->deleted_intervals_ids?>" />
			
			<?php endforeach;?>
		
		<?php endif;?>
		
		<!-- 	SUBMIT BUTTON -->	
		<button type="submit" class="time_scheme_button"><?php echo $this->translate("save_time_scheme")?></button>	
	
	</form> 
	
</div>
<?php endif; ?>	
	
	
<!-- ####################################### Alergies  ################################################# -->
	<div class="allergies_comment_box" style="width: 100%!important; float: left;">
		<label><?php echo $this->translate('allergies_comment')?>:</label>
		<div id="allergies_container">
			<span class="editText" id="allergies_pat"><?php if(!empty($this->allergies_comment)):?><?php echo $this->allergies_comment?><?php else: ?><?php echo $this->translate('no alergies'); ?><?php endif;  ?></span>
		</div>
	</div>

<!-- ####################################### Select all  ################################################# -->
	<div class="select_all_box">
		<div id="select_all_container">
			<input type="checkbox" id="select_all"/>
			<label for="select_all"><?php echo $this->translate('Select all for printing')?></label>
		</div>
	</div>


<!-- ################################################################################################### -->
<!-- ####################################### MEDICATION BLOCKS ######################################### -->
<!-- ################################################################################################### -->

<form action="<?php  echo APP_BASE.'patientnew/medicationprint?id='.$_REQUEST['id'].''; ?>" method="post" name="print_medications" id="print_medications" >

<?php foreach($allowed_medication_types as $k=>$medication_type):?>

	<?php if(in_array($medication_type,$timed_scheduled_medications)):?>
	<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title")?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>
			
			<a class="medication_edit_button" onclick="toggle_all_extra_info(this, '<?php echo $medication_type; ?>'); return false;"><?php echo $this->translate('toggle_all_extra_info')?></a>
			
			
			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][allow]" checked="checked" id="print<?php echo $medication_type;?>" class="all_print_medication" />
				<label for="print<?php echo $medication_type;?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_sort_by" name="print[<?php echo $medication_type;?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_sort_dir" name="print[<?php echo $medication_type;?>][sortdir]" />			
		</div>

		<?php if($medication_type == "isbedarfs" && ( count($this->bedarfsdrop) > 0 || count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
				<label>Medikamenten Set hinzufgen</label>
				<?php if( count($this->bedarfsdrop) > '1') :?>					
					<?php echo $this->formSelect('bid', $this->bid, array('onChange'=>'togglebutton(this.value)'), $this->bedarfsdrop) ?>
					<input name="insert_bedarf" type="submit" id="MedicButton" value="<?php echo $this->translate('add'); ?>" disabled="disabled" />
				<?php endif;?>
				
			<!-- ISPC-2247 -->
			<?php if( count($this->new_medication_sets[$medication_type]) > '0') :?>					
				<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
			<?php endif;?>
		</div>
		<?php endif;?>


		<?php if( $medication_type == "iscrisis"  && ( count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
			<!-- ISPC-2247 -->
			<label>Medikamenten Set hinzufgen</label>
			<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
		</div>
		<?php endif;?>


		<table id="<?php echo $medication_type; ?>" class="medication_table_<?php echo $medication_type; ?> datatable">
		
		
		<?php if($medication_type=="isintubated"):?>
		 <thead>
		 		
		 		
		 		<tr>
		 			<th rowspan="4" ><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
		 			<th rowspan="4" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->		 			
		 			<th rowspan="4" data-sortname="packaging"><?php echo $this->translate('medication_packaging_hidden'); ?></th><!--  3 -->
		 			
		 			<?php if ($this->show_new_fileds == "1"):?>
						<!-- header 1 column-->
			 			<th rowspan="4" data-sortname="concentration"><?php echo $this->translate('medication_concentration'); ?></th><!--  3=>6 -->
			 			<th rowspan="1" data-sortname="type"><?php echo $this->translate('medication_type_hidden'); ?></th><!--  4 -->
			 			<th rowspan="4" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  5=>3 -->	
						<th rowspan="1" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th'); ?></th><!--  5 -->
		 			<?php endif;?>
		 			
		 					 			
		 			<th rowspan="1"  colspan="<?php echo count($this->dosage_intervals[$medication_type]);?>"><?php echo $this->translate('medication_dosage'); ?></th> <!--  4 -->
		 			<th rowspan="1"  data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  5 -->

		 			<th rowspan="4" data-sortname="kcal"><?php echo $this->translate('medication_kcal_hidden'); ?></th><!--  6 -->
		 			<th rowspan="4" data-sortname="volume"><?php echo $this->translate('medication_volume_hidden'); ?></th><!--  6 -->

		 			<th rowspan="4" data-sortname="comments"><?php echo $this->translate('medication_comments_hidden'); ?></th><!--  6 -->
		 			<th rowspan="4" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  7 -->
		 			<th rowspan="4" data-sortname="importance" ><?php echo $this->translate('medication_importance'); ?></th><!--  8 -->
		 		</tr>
		 		
		 		<tr>
					<!--empty --> <!-- 0 -->
		 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_drug'); ?></th><!--  1 -->
		 			
		 			
		 			
		 			<?php if ($this->show_new_fileds == "1"):?>
			 			<th rowspan="3" class="sorting" id="med_type_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_type'); ?></th>
						<th rowspan="3" class="sorting" id="dosage_form_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_dosage_form_th'); ?></th>
		 			<?php endif;?>
		 			 
					<!--empty --> <!-- 2 -->
					<!--empty --> <!-- 3 -->
		 			<?php foreach($this->dosage_intervals[$medication_type] as $k => $di):?>
			 			<th rowspan="3" ><?php echo $di;?></th> <!-- 4 -->
		 			<?php endforeach;?>
		 			<th rowspan="1" id="kcal_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_kcal'); ?></th><!--  5 -->
					<!--empty --> <!-- 6 -->
					<!--empty --> <!-- 7 -->
					<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 		<tr>
		 			<!--empty --> <!-- 0 -->
		 			<th rowspan="2" class="sorting" id="packaging_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_packaging'); ?></th><!-- 1 -->
		 			<!--empty --> <!-- 2 -->
		 			<!--empty --> <!-- 3 -->
		 			<!--empty --> <!-- 4 -->
		 			<th rowspan="1" id="volume_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_volume'); ?></th><!--  5 -->
		 			<!--empty --> <!-- 6 -->
		 			<!--empty --> <!-- 7 -->
		 			<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 		<tr>
		 			<!--empty --> <!-- 0 -->
		 			<!--empty --> <!-- 1 -->
		 			<!--empty --> <!-- 2 -->
		 			<!--empty --> <!-- 3 -->
		 			<!--empty --> <!-- 4 -->
		 			<th rowspan="1" id="comments_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_comments'); ?></th><!--  5 --> 
		 			<!--empty --> <!-- 6 -->
		 			<!--empty --> <!-- 7 -->
		 			<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 	</thead>
		
		
		
		<?php else:?>
			<thead>
		 		<tr>
		 			<th rowspan="2" ><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
		 			<th rowspan="2" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->		 			
					
					<?php if ($this->show_new_fileds == "1"):?>
						<!-- header 1 column-->
			 			<th rowspan="1" data-sortname="concentration"><?php echo $this->translate('medication_concentration'); ?></th><!--  3=>6 -->
			 			<th rowspan="2" data-sortname="type"><?php echo $this->translate('medication_type_hidden'); ?></th><!--  4 -->
			 			<th rowspan="1" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  5=>3 -->	
						<th rowspan="2" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th'); ?></th><!--  5 -->
		 			<?php endif;?>
					
		 			<!--  DOSAGE TABLE HEADER PARENT-->
		 			<th colspan="<?php echo count($this->dosage_intervals[$medication_type]);?>"><?php echo $this->translate('medication_dosage'); ?></th> <!--  5 -->
		 			<th rowspan="1"  data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="comments"><?php echo $this->translate('medication_comments_hidden'); ?></th><!--  0 -->
		 				<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis"):?>
		 					<th rowspan="1" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 				<?php else: ?>
		 					<th rowspan="2" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 				<?php endif;?>
		 			<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
		 				<th rowspan="1" data-sortname="days_interval"><?php echo $this->translate('medication_days_interval'); ?></th><!--  0 -->
		 			<?php endif;?>
		 			<th rowspan="2" data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
		 		</tr>
		 		
		 		<tr>
		 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_drug'); ?></th><!--  2 -->
					<?php if ($this->show_new_fileds == "1"):?>
			 			<th rowspan="1" class="sorting" id="med_type_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_type'); ?></th>
						<th rowspan="1" class="sorting" id="dosage_form_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_dosage_form_th'); ?></th>
		 			<?php endif;?>
		 			
					<!--  DOSAGE TABLE HEADER KIDS-->
		 			<?php foreach($this->dosage_intervals[$medication_type] as $k => $di):?>
			 			<th><?php echo $di;?></th>
		 			<?php endforeach;?>
		 			<th rowspan="1" id="comments_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_comments'); ?></th><!--  4 -->
		 			
		 			<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis"):?>
			 			<th rowspan="1" class="sorting" data-sortname="escalation"  id="escalation_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_escalation'); ?></th>
		 			<?php endif; ?>
		 			
		 			<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
		 			<th rowspan="1" class="sorting" id="administration_date_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_administration_date'); ?></th><!--  4 -->
		 			<?php endif; ?>
		 		</tr>
		 	</thead>
			<?php endif; ?>
	
	
			<!--  LIST MEDICATION -->
		 	<tbody>
		 		<?php foreach($medication_array[$medication_type] as $k =>$med):?>
					<tr <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']]))) :?> data-medid="<?php echo $med['id']; ?>"  class="has_ack" <?php endif; ?> >
						<!--  MEDICATION CHANGE IN FULL -->
						<td><?php echo $med['medication_change'];?></td>
						
						<!--  MEDICATION NAME -->
						<td id="<?php echo $med['id']; ?>" rel="<?php echo $med['id']; ?>" >
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><a href="javascript:void(0)" class="show_medication_info" data-medication_type="<?php echo $medication_type; ?>" data-drugplan_id="<?php echo $med['id']; ?>" ><img src="<?php echo RES_FILE_PATH ?>/images/info_med.png" alt="mediction_info" class="medication_info" /></a><?php echo $med['medication'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $med['drug'];?></span>
								
								<?php if($medication_type=="isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
									<span class="vl"><?php echo $med['packaging_name'];?></span>
								<?php endif;?>	
							</div>
						</td>
						
						<!--  MEDICATION DRUG HIDDEN-->
						<td><?php echo $med['drug'];?></td>
											
				
						
						<!--  MEDICATION PACKAGING HIDDEN-->
						<?php if($medication_type=="isintubated"):?>
							<td><?php echo $med['packaging'];?></td>
						<?php endif;?>					
				
				
						<?php if ($this->show_new_fileds == "1"):?>
						
						<!--  MEDICATION UNIT / TYPE -->
						<td>
							<div class="mifo" style="width:420px;">
							
							<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
								<span class="vl"><?php echo $med['concentration_full'];?></span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $med['unit'];?></span>
								</div>
								<div style="float:left; width:25px;padding:2px;">
								<span class="pro_word">pro:</span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $med['dosage_form'];?></span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_type'); ?></span>
								<span class="vl"><?php echo $med['type'];?></span>
							</div>
							</div>
						</td>
						
						<!--  MEDICATION TYPE HIDDEN-->
						<td><?php echo $med['type'];?></td> 

												
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $med['unit'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $med['dosage_form'];?></span>

							</div>
						</td>
						
						<!--  MEDICATION CONCENTRATION HIDDEN-->
						<td><?php echo $med['dosage_form'];?></td> 
						<?php endif;?>
				
				
						<!--  MEDICATION DOSAGE INPUTS-->
						
						<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $dosage_time; ?></span>
									<span class="vl"><?php echo $med['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($med['dosage'][$dosage_time]) > 0):?><?php echo $med['unit'];?><?php endif;?></span>
									<span class="vl second_time">
										<?php if ($this->show_new_fileds == "1" && strlen($med['dosage'][$dosage_time]) > 0):?>
											<?php echo $med['dosage_concentration'][$dosage_time];?>
										<?php endif;?>
									</span>
								</div>
							</td>
		 				<?php endforeach;?>
		 				
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['indication_color'];?>"><?php echo $med['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['indication'];?></span> 
								<?php endif;?>
								
								<?php if($medication_type=="isintubated"):?>		
					 				<span class="lb"><?php echo $this->translate('medication_kcal'); ?>:</span>
									<span class="vl"><?php echo $med['kcal'];?></span>
					 				<span class="lb"><?php echo $this->translate('medication_volume'); ?>:</span>
									<span class="vl"><?php echo $med['volume'];?></span>
								<?php endif; ?>
										
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl" id="<?php echo $med['id'];?>_medi_comment"><?php echo $med['comments'];?></span>
							</div>
						</td>
						
						<?php if($medication_type=="isintubated"):?>
							<!--  MEDICATION COMMENTS HIDDEN-->
							<td><?php echo $med['kcal'];?></td>
							<!--  MEDICATION COMMENTS HIDDEN-->
							<td><?php echo $med['volume'];?></td>
						<?php endif; ?>
						
						<!--  MEDICATION COMMENTS HIDDEN-->
						<td><?php echo $med['comments'];?></td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis"):?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_last_update'); ?></span>
									<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
									
									<span class="lb"><?php echo $this->translate('medication_escalation'); ?></span>
									<span class="vl"><?php echo $med['escalation'];?></span>
								</div>
							</td>
							
						<?php else:?>
							<td>
								<div class="mifo">
									<span class="lb">&nbsp;</span>
									<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
								</div>
							</td>
						<?php endif;?>
						
						<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
						<!--  MEDICATION DAYS INTERVAL / ADMINISTRATION DATE -->
						<td data-order="<?php echo $med['days_interval'];?>" >
							<div class="mifo">
								<?php if($med['has_interval'] == "1"):?>
									<span class="lb"><?php echo $this->translate('medication_days_interval')?>:</span>
									<span class="vl"><?php echo $med['days_interval'];?> </span>
	
									<span class="lb"><?php echo $this->translate('medication_administration_date')?>:</span>
									<?php  if( $med['administration_date'] != "0000-00-00 00:00:00"):?>
										<span class="vl" id="<?php echo $med['id'];?>_administration_date" ><?php echo date("d.m.Y",strtotime($med['administration_date']));?></span>
										<?php if($med['allow_restart'] == "1"):?>
											<button type="button" class="interval_restart interval_settings" data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>" id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_restart" ><?php echo $this->translate("give medication- Restart start interval")?></button>
										<?php endif; ?>
									<?php else: ?>
										
										<span class="vl"  id="<?php echo $med['id'];?>_administration_date" ></span>
										<button type="button" class="interval_start interval_settings"  data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>"  id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_start" ><?php echo $this->translate("give medication- start interval")?></button>
									<?php endif; ?>
								<?php endif; ?>
							</div>
						</td>
						
						<?php endif; ?>					
							
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td data-order="<?php echo $med['importance'];?>">
							<div class="mifo" style="padding-top:24px">
								<span class="vl" style=""><?php echo $med['importance'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION ESCALATION HIDDEN-->
						<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis"):?>
							<td  data-order="<?php echo $med['escalation'];?>" ><?php echo $med['escalation']; ?></td>
						<?php endif;?>	
					</tr>
		 	<?php endforeach;?>
		 	</tbody>
		 </table>
	</div>

	<?php elseif(!in_array($medication_type,$timed_scheduled_medications) && !in_array($medication_type,array('isschmerzpumpe','treatment_care','scheduled'))): ?>
	
	<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title")?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>
			<a class="medication_edit_button" onclick="toggle_all_extra_info(this, '<?php echo $medication_type; ?>'); return false;"><?php echo $this->translate('toggle_all_extra_info')?></a>

			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][allow]" checked="checked" id="print<?php echo $medication_type;?>" class="all_print_medication" />
				<label for="print<?php echo $medication_type;?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_sort_by" name="print[<?php echo $medication_type;?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_sort_dir" name="print[<?php echo $medication_type;?>][sortdir]" />			
		</div>


		<?php if($medication_type == "isbedarfs" && ( count($this->bedarfsdrop) > 0 || count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
				<label>Medikamenten Set hinzufgen</label>
				<?php if( count($this->bedarfsdrop) > '1') :?>					
					<?php echo $this->formSelect('bid', $this->bid, array('onChange'=>'togglebutton(this.value)'), $this->bedarfsdrop) ?>
					<input name="insert_bedarf" type="submit" id="MedicButton" value="<?php echo $this->translate('add'); ?>" disabled="disabled" />
				<?php endif;?>
				
			<!-- ISPC-2247 -->
			<?php if( count($this->new_medication_sets[$medication_type]) > '0') :?>					
				<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
			<?php endif;?>
		</div>
		<?php endif;?>


		<?php if( $medication_type == "iscrisis"  && ( count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
			<!-- ISPC-2247 -->
			<label>Medikamenten Set hinzufgen</label>
			<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
		</div>
		<?php endif;?>



		<table id="<?php echo $medication_type; ?>" class="medication_table_<?php echo $medication_type; ?> datatable">
		<?php if ($medication_type == "isintubated" ): ?>
		<thead>
		 		
		 		
		 		<tr>
		 			<th rowspan="4" ><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
		 			<th rowspan="4" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->		 			
		 			<th rowspan="4" data-sortname="packaging"><?php echo $this->translate('medication_packaging_hidden'); ?></th><!--  3 -->
		 			
		 			<?php if ($this->show_new_fileds == "1"):?>
						<!-- header 1 column-->
			 			<th rowspan="4" data-sortname="concentration"><?php echo $this->translate('medication_concentration'); ?></th><!--  3=>6 -->
			 			<th rowspan="1" data-sortname="type"><?php echo $this->translate('medication_type_hidden'); ?></th><!--  4 -->
			 			<th rowspan="4" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  5=>3 -->	
						<th rowspan="1" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th'); ?></th><!--  5 -->
		 			<?php endif;?>
		 			
		 					 			
		 			<th rowspan="4"  colspan="<?php echo count($this->dosage_intervals[$medication_type]);?>"><?php echo $this->translate('medication_dosage'); ?></th> <!--  4 -->
		 			<th rowspan="1"  data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  5 -->

		 			<th rowspan="4" data-sortname="kcal"><?php echo $this->translate('medication_kcal_hidden'); ?></th><!--  6 -->
		 			<th rowspan="4" data-sortname="volume"><?php echo $this->translate('medication_volume_hidden'); ?></th><!--  6 -->

		 			<th rowspan="4" data-sortname="comments"><?php echo $this->translate('medication_comments_hidden'); ?></th><!--  6 -->
		 			<th rowspan="4" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  7 -->
		 			<th rowspan="4" data-sortname="importance" ><?php echo $this->translate('medication_importance'); ?></th><!--  8 -->
		 		</tr>
		 		
		 		<tr>
					<!--empty --> <!-- 0 -->
		 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_drug'); ?></th><!--  1 -->
		 			
		 			
		 			
		 			<?php if ($this->show_new_fileds == "1"):?>
			 			<th rowspan="3" class="sorting" id="med_type_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_type'); ?></th>
						<th rowspan="3" class="sorting" id="dosage_form_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_dosage_form_th'); ?></th>
		 			<?php endif;?>
		 			 
					<!--empty --> <!-- 2 -->
					<!--empty --> <!-- 3 -->
					<!--empty --> <!-- 4 -->
		 		 
		 			<th rowspan="1" id="kcal_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_kcal'); ?></th><!--  5 -->
					<!--empty --> <!-- 6 -->
					<!--empty --> <!-- 7 -->
					<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 		<tr>
		 			<!--empty --> <!-- 0 -->
		 			<th rowspan="2" class="sorting" id="packaging_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_packaging'); ?></th><!-- 1 -->
		 			<!--empty --> <!-- 2 -->
		 			<!--empty --> <!-- 3 -->
		 			<!--empty --> <!-- 4 -->
		 			<th rowspan="1" id="volume_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_volume'); ?></th><!--  5 -->
		 			<!--empty --> <!-- 6 -->
		 			<!--empty --> <!-- 7 -->
		 			<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 		<tr>
		 			<!--empty --> <!-- 0 -->
		 			<!--empty --> <!-- 1 -->
		 			<!--empty --> <!-- 2 -->
		 			<!--empty --> <!-- 3 -->
		 			<!--empty --> <!-- 4 -->
		 			<th rowspan="1" id="comments_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_comments'); ?></th><!--  5 --> 
		 			<!--empty --> <!-- 6 -->
		 			<!--empty --> <!-- 7 -->
		 			<!--empty --> <!-- 8 -->
		 		</tr>
		 		
		 	</thead>
		
		
		
		
		<? else: ?>
		
			<thead>
		 		<tr>
		 			<th rowspan="2"><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
		 			<th rowspan="2" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->

					<?php if ($this->show_new_fileds == "1"):?>
			 			<th rowspan="1" data-sortname="concentration"><?php echo $this->translate('medication_concentration'); ?></th><!--  3 -->
			 			<th rowspan="2" data-sortname="type"><?php echo $this->translate('medication_type_hidden'); ?></th><!--  4 -->
			 			<th rowspan="1" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  3 -->
			 			<th rowspan="2" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th'); ?></th><!--  5 -->
		 			<?php endif;?>
					
		 			<!--  DOSAGE TABLE HEADER PARENT-->
		 			<th rowspan="2" data-sortname="dosage"><?php echo $this->translate('medication_dosage'); ?><?=($medication_type == "isbedarfs" || $medication_type == "iscrisis") ? ' / '. $this->translate('Interval for dosage') : '';?></th> <!--  5 -->
		 			<th rowspan="1" data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="comments"><?php echo $this->translate('medication_comments_hidden'); ?></th><!--  0 -->
		 			<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis"):?>
		 				<th rowspan="1" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 			<?php else: ?>
			 			<th rowspan="2" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 			<?php endif; ?>
					<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
		 				<th rowspan="1" data-sortname="days_interval"><?php echo $this->translate('medication_days_interval'); ?></th><!--  0 -->
		 			<?php endif;?>
		 			<th rowspan="2" data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
		 		</tr>
		 		<tr>
		 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_drug'); ?></th><!--  2 -->

					<?php if ($this->show_new_fileds == "1"):?>
			 			<th rowspan="1" class="sorting" id="med_type_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_type'); ?></th>
						<th rowspan="1" class="sorting" id="dosage_form_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_dosage_form_th'); ?></th>
		 			<?php endif;?>
					
		 			<th rowspan="1" id="comments_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_comments'); ?></th><!--  4 -->
		 			<?php if(in_array($medication_type, array("isbedarfs", "iscrisis"))):?>
		 				<th rowspan="1" class="sorting" id="escalation_<?php echo $medication_type; ?>" data-sortname="escalation"><?php echo $this->translate('medication_escalation'); ?></th><!--  4 -->
		 			<?php endif; ?>
		 			<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
		 				<th rowspan="1" class="sorting" id="administration_date_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_administration_date'); ?></th>
		 			<?php endif;?>
		 		</tr>
		 	</thead>
	<?php endif;?>
			<!--  LIST MEDICATION -->
		 	<tbody>
		 		<?php foreach($medication_array[$medication_type] as $k =>$med):?>
                    <tr <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']]))) :?> data-medid="<?php echo $med['id']; ?>"  class="has_ack" <?php endif; ?> >
						<!--  MEDICATION CHANGE IN FULL -->
						<td><?php echo $med['medication_change'];?></td>
						
						<!--  MEDICATION NAME -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><a href="javascript:void(0)" class="show_medication_info" data-medication_type="<?php echo $medication_type; ?>" data-drugplan_id="<?php echo $med['id']; ?>" ><img src="<?php echo RES_FILE_PATH ?>/images/info_med.png" alt="mediction_info" class="medication_info" /></a><?php echo $med['medication'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $med['drug'];?></span>
								
								<?php if ($medication_type=="isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
									<span class="vl"><?php echo $med['packaging_name'];?></span>
								<?php endif;?>
							</div>
						</td>
						
						<!--  MEDICATION DRUG HIDDEN-->
						<td><?php echo $med['drug'];?></td>
				
				
						<!--  MEDICATION PACKAGING HIDDEN-->
						<?php if($medication_type=="isintubated"):?>
							<td><?php echo $med['packaging'];?></td>
						<?php endif;?>	
						
						
				
						<?php if ($this->show_new_fileds == "1"):?>

						<!--  MEDICATION UNIT / TYPE -->
						<td>
							<div class="mifo" style="width:420px;">
							
								<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
								<span class="vl"><?php echo $med['concentration'];?></span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
									<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
									<span class="vl"><?php echo $med['unit'];?></span>
								</div>
								<div style="float:left; width:25px; padding:2px;">
								<span class="pro_word">pro:</span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
									<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
									<span class="vl"><?php echo $med['dosage_form'];?></span>
								</div>
								<div style="float:left; width:90px; padding:2px;">
								<span class="lb"><?php echo $this->translate('medication_type'); ?></span>
								<span class="vl"><?php echo $med['type'];?></span>
							</div>
						

												
								
								
							</div>
						</td>
						
						<!--  MEDICATION TYPE HIDDEN-->
						<td><?php echo $med['type'];?></td> 

												
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $med['unit'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $med['dosage_form'];?></span>

							</div>
						</td>
						
						<!--  MEDICATION CONCENTRATION HIDDEN-->
						<td><?php echo $med['dosage_form'];?></td> 
						<?php endif;?>
						
						
						<!--  MEDICATION DOSAGE INPUTS-->
						
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage'); ?></span>
									<span class="vl"><?php echo $med['dosage'];?>
									<!--  ISPC-1848 F p.19
										<?php if ($this->show_new_fileds == "1" && strlen($med['dosage']) > 0):?> 
										<?php echo $med['unit'];?>
										<?php endif;?>
									 -->
									</span>
                                    <?php if ($medication_type == "isbedarfs" || $medication_type == "iscrisis") : ?>
                                        <span class="lb"><?php echo $this->translate('Interval for dosage'); ?></span>
                                        <span class="vl"><?php echo $med['dosage_interval'];?></span>
                                    <?php endif; ?>
								</div>
							</td>
		 				
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['indication_color'];?>"><?php echo $med['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['indication'];?></span> 
								<?php endif;?>
								
								<?php if($medication_type=="isintubated"):?>		
					 				<span class="lb"><?php echo $this->translate('medication_kcal'); ?>:</span>
									<span class="vl"><?php echo $med['kcal'];?></span>
					 				<span class="lb"><?php echo $this->translate('medication_volume'); ?>:</span>
									<span class="vl"><?php echo $med['volume'];?></span>
								<?php endif; ?>
								
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl" id="<?php echo $med['id'];?>_medi_comment"><?php echo $med['comments'];?></span>
							</div>
						
						</td>
						
						<?php if($medication_type=="isintubated"):?>
							<!--  MEDICATION KCAL HIDDEN-->
							<td><?php echo $med['kcal'];?></td>
							<!--  MEDICATION VOLUME HIDDEN-->
							<td><?php echo $med['volume'];?></td>
						<?php endif; ?>
						
						
						<!--  MEDICATION COMMENTS HIDDEN-->
						<td><?php echo $med['comments'];?></td>
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<?php if(in_array($medication_type, array("isbedarfs", "iscrisis"))):?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_last_update'); ?></span>
									<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
									
									<span class="lb"><?php echo $this->translate('medication_escalation'); ?></span>
									<span class="vl"><?php echo $med['escalation'];?></span>
								</div>
							</td>
						<?php else: ?>
							<td>
								<div class="mifo">
									<span class="lb">&nbsp;</span>
									<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
								</div>
							</td>
						<?php endif;?>
						
						<?php if($medication_type=="actual" && $allow_normal_scheduled == "1"):?>
						<!--  MEDICATION DAYS INTERVAL / ADMINISTRATION DATE -->
						<td data-order="<?php echo $med['days_interval'];?>" >
							<div class="mifo">
								<?php if($med['has_interval'] == "1"):?>
									<span class="lb"><?php echo $this->translate('medication_days_interval')?>:</span>
									<span class="vl"><?php echo $med['days_interval'];?> </span>
	
									<span class="lb"><?php echo $this->translate('medication_administration_date')?>:</span>
									<?php  if( $med['administration_date'] != "0000-00-00 00:00:00"):?>
										<span class="vl" id="<?php echo $med['id'];?>_administration_date" ><?php echo date("d.m.Y",strtotime($med['administration_date']));?></span>
										<?php if($med['allow_restart'] == "1"):?>
											<button type="button" class="interval_restart interval_settings" data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>" id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_restart" ><?php echo $this->translate("give medication- Restart start interval")?></button>
										<?php endif; ?>
									<?php else: ?>
										
										<span class="vl"  id="<?php echo $med['id'];?>_administration_date" ></span>
										<button type="button" class="interval_start interval_settings"  data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>"  id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_start" ><?php echo $this->translate("give medication- start interval")?></button>
									<?php endif; ?>
								<?php endif; ?>
							</div>
						</td>
						
						<?php endif; ?>					
													
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td  data-order="<?php echo $med['importance'];?>" >
							<div class="mifo" style="padding-top:24px;">
								<span class="vl"><?php echo $med['importance'];?> </span>
							</div>
						</td>
						
						<?php if(in_array($medication_type, array("isbedarfs", "iscrisis"))):?>
						<!--  MEDICATION ESCALATION-->
			 				<td><?php echo $med['escalation']; ?></td>
		 				<?php endif; ?>
						
					</tr>
		 		<?php endforeach;?>
		 	</tbody>
		 </table>
	</div>
	<?php elseif($medication_type == "isschmerzpumpe" ):?>
	<?php if(empty($medication_array[$medication_type])):?>
	
	<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title ".$cocktail_details['pumpe_type'])?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>
			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][allow]" checked="checked"  id="print<?php echo $medication_type;?><?php echo $pumpe_id?>" class="all_print_medication"/>
				<label for="print<?php echo $medication_type;?><?php echo $pumpe_id?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_<?php echo $pumpe_id?>_sort_by" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_<?php echo $pumpe_id?>_sort_dir" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][sortdir]" />
		</div>
	
	
		<table class="sch_empty_medication_table datatable" style="width:100%">
			<thead>
				<?php if ($this->show_new_fileds == "1"):?>
					<tr>
			 			<th rowspan="1" data-sortname="medication"><b><?php echo $this->translate('medication_name');?></b></th><!--  1 -->
			 			<th rowspan="1" data-sortname="unit"><b><?php echo $this->translate('medication_unit'); ?></b></th><!--  3 -->
			 			<th rowspan="1" data-sortname="dosage"><b><?php echo $this->translate('medication_dosage_h'); ?></b></th> <!--  5 -->
			 			<th rowspan="3" data-sortname="indication"><b><?php echo $this->translate('medication_indication'); ?></b></th><!--  0 -->
			 			<th rowspan="3" data-sortname="medication_change"><b><?php echo $this->translate('medication_last_update'); ?></b></th><!--  0 -->
			 			<th rowspan="3" data-sortname="importance"><b><?php echo $this->translate('medication_importance'); ?></b></th><!--  0 -->
			 		</tr>
			 		<tr>
			 			<th rowspan="2" class="sorting" data-sortname="drug"><b><?php echo $this->translate('medication_drug'); ?></b></th><!--  2 -->
			 			<!--  4 -->
			 			<!-- 
			 			<th rowspan="1" class="sorting" data-sortname="dosage_form"><b><?php echo $this->translate('medication_dosage_form'); ?></b></th>
			 			 -->
			 			<th rowspan="2" class="sorting" data-sortname="concentration"><b><?php echo $this->translate('medication_concentration'); ?></b></th><!--  4 -->
			 			 
			 			
			 			<th rowspan="2" class="sorting" data-sortname="dosage_24h"><b><?php echo $this->translate('medication_dosage_24h'); ?></b></th><!--  2 -->
			 		</tr>
			 		<!--  4 -->
			 		<!--
			 		<tr>
			 			<th rowspan="1" class="sorting" data-sortname="concentration"><b><?php echo $this->translate('medication_concentration'); ?></b></th>
			 		</tr>
			 		-->
				<?php else: ?>
					<tr>
			 			<th rowspan="1" data-sortname="medication"><b><?php echo $this->translate('medication_name');?></b></th><!--  1 -->
			 			<th rowspan="1" data-sortname="dosage_h"><b><?php echo $this->translate('medication_dosage_h'); ?></b></th> <!--  5 -->
			 			<th rowspan="2" data-sortname="indication"><b><?php echo $this->translate('medication_indication'); ?></b></th><!--  0 -->
			 			<th rowspan="2" data-sortname="medication_change"><b><?php echo $this->translate('medication_last_update'); ?></b></th><!--  0 -->
			 			<th rowspan="2" data-sortname="importance"><b><?php echo $this->translate('medication_importance'); ?></b></th><!--  0 -->
			 		</tr>
			 		<tr>
			 			<th rowspan="1" class="sorting" data-sortname="drug" ><b><?php echo $this->translate('medication_drug'); ?></b></th><!--  2 -->
			 			<th rowspan="1" class="sorting" data-sortname="dosage_24h" ><b><?php echo $this->translate('medication_dosage_24h'); ?></b></th><!--  2 -->
			 		</tr>
				<?php endif;?>
		 	</thead>
		 	<tbody>
		 		 <tr>
		 		 <?php if ($this->show_new_fileds == "1"):?>
		 		 	<td colspan="6">&nbsp;</td>
		 		 <?php else:?>	
		 		 	<td colspan="5">&nbsp;</td>
		 		 <?php endif; ?>	
		 		 </tr>
		 	</tbody>
		 </table>
	</div>
	<?php endif;?>
	<?php $pumpe_cnt = 1; foreach($medication_array[$medication_type] as $pumpe_id =>$med_pumpe):?>
		<?php 
			$cocktail_details=""; 
			$schmerz[$pumpe_id] = end($medication_array[$medication_type][$pumpe_id]);
			$cocktail_details = $schmerz[$pumpe_id]['smpdescription'];  
			$cocktail_details_alt = $schmerz[$pumpe_id]['smpdescription_alt'];  
			$cocktail_details_alt_offline = $schmerz[$pumpe_id]['smpdescription_alt_offline']; // this is multi
		?>
	<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title ".$cocktail_details['pumpe_type'])?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>
			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][allow]" checked="checked"  id="print<?php echo $medication_type;?><?php echo $pumpe_id?>" class="all_print_medication" />
				<label for="print<?php echo $medication_type;?><?php echo $pumpe_id?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_<?php echo $pumpe_id?>_sort_by" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_<?php echo $pumpe_id?>_sort_dir" name="print[<?php echo $medication_type;?>][<?php echo $pumpe_id?>][sortdir]" />
		</div>
		<table id="<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>" data-sch_id = "<?php echo $pumpe_cnt;?>" class="medication_table_<?php echo $medication_type; ?> datatable">
			<thead>
				<?php if ($this->show_new_fileds == "1"):?>
					<tr>
			 			<th rowspan="3"><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
			 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
			 			<th rowspan="3" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->
			 			<th rowspan="2" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  3 -->
			 			<th rowspan="3" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th_hidden'); ?></th><!--  5 -->
			 			<th rowspan="3" data-sortname="concentration"><?php echo $this->translate('medication_conentration_hidden'); ?></th><!--  6 -->
			 			<th rowspan="1" data-sortname="dosage"><?php echo $this->translate('medication_dosage_h'); ?></th> <!--  5 -->
			 			<th rowspan="3" data-sortname="dosage_24h"><?php echo $this->translate('medication_dosage_24h_hidden'); ?></th> <!--  5 -->
			 			<th rowspan="3" data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  0 -->
			 			<th rowspan="3" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
			 			<th rowspan="3" data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
			 		</tr>
			 		<tr>
			 			<th rowspan="2" class="sorting" id="drug_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_drug'); ?></th><!--  2 -->
			 			<!-- 
			 			<th rowspan="1" class="sorting" id="dosageform_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_dosage_form'); ?></th>
			 			-->
			 			<th rowspan="2" class="sorting" id="dosage_24h_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_dosage_24h'); ?></th><!--  2 -->
			 		</tr>
			 		<tr>
			 			<th rowspan="1" class="sorting" id="concentration_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_concentration'); ?></th><!--  4 -->
			 		</tr>
				<?php else: ?>
					<tr>
			 			<th rowspan="2"><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
			 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
			 			<th rowspan="2" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->
			 			<th rowspan="1" data-sortname="dosage"><?php echo $this->translate('medication_dosage_h'); ?></th> <!--  5 -->
			 			<th rowspan="2" data-sortname="dosage_24h"><?php echo $this->translate('medication_dosage_24h_hidden'); ?></th> <!--  5 -->
			 			<th rowspan="2" data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  0 -->
			 			<th rowspan="2" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
			 			<th rowspan="2" data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
			 		</tr>
			 		<tr>
			 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_drug'); ?></th><!--  2 -->
			 			<th rowspan="1" class="sorting" id="dosage_24h_<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>"><?php echo $this->translate('medication_dosage_24h'); ?></th><!--  2 -->
			 		</tr>
				<?php endif;?>

		 		
		 	</thead>
	
			<!--  LIST MEDICATION -->
		 	<tbody>
		 		<?php foreach($med_pumpe as $k =>$med):?>
                   <tr 
                   <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']]))) :?> data-medid="<?php echo $med['id']; ?>"  class="has_ack" <?php endif; ?> 
                   >
						<!--  MEDICATION CHANGE IN FULL -->
						<td><?php echo $med['medication_change'];?></td>
						
						<!--  MEDICATION NAME -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><a href="javascript:void(0)" class="show_medication_info" data-medication_type="<?php echo $medication_type; ?>" data-drugplan_id="<?php echo $med['id']; ?>" ><img src="<?php echo RES_FILE_PATH ?>/images/info_med.png" alt="mediction_info" class="medication_info" /></a><?php echo $med['medication'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $med['drug'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION DRUG HIDDEN-->
						<td><?php echo $med['drug'];?></td>
						
						<?php if ($this->show_new_fileds == "1"):?>
							<!--  MEDICATION UNIT / TYPE / DOSAGE FORM / CONCENTRATION -->
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
									<span class="vl"><?php echo $med['unit'];?></span>
									<!--  
									<span class="lb"><?php echo $this->translate('medication_dosageform'); ?>XXX</span>
									<span class="vl"><?php echo $med['dosage_form'];?></span>
									-->
									<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
									<span class="vl"><?php echo $med['concentration_full'];?></span>
								</div>
							</td>
							
							<!--  MEDICATION DOSAGE FORM HIDDEN-->
							<td><?php echo $med['dosage_form'];?></td>
							
							<!--  MEDICATION CONCENTRATION HIDDEN-->
							<td><?php echo $med['concentration'];?></td>
							 
						<?php endif;?>
						
						
						<!--  MEDICATION DOSAGE INPUTS-->
						
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage_h'); ?></span>
									<?php if ($this->show_new_fileds == "1"):?>
										<span class="vl"><?php echo round($med['dosage'],2).$med['unit']."/h"; echo $med['dosage_mg_h_kg'] ; ?>
									</span>
									<?php else:;?>
										<span class="vl"><?php echo round($med['dosage'], 2) ;?>
									</span>
									<?php endif;?>


									<span class="lb"><?php echo $this->translate('medication_dosage24h'); ?></span>
									<span class="vl"><?php echo $med['dosage_24h'];?><?php if ($this->show_new_fileds == "1" && strlen($med['dosage_24h']) > 0 && strlen($med['dosage_24h_concentration']) > 0 ):?><?php echo $med['unit'];?>(<?php echo $med['dosage_24h_concentration'];?>ml)<?php endif;?></span>
									
								</div>
							</td>
							
						<!--  MEDICATION DOSAGE 24h HIDDEN -->
						<td><?php echo $med['dosage_24h'];?></td>
									 				
						<!--  MEDICATION INDICATION  -->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['indication_color'];?>"><?php echo $med['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['indication'];?></span> 
								<?php endif;?>
							</div>
						</td>
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
							</div>
						</td>
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td><?php echo trim($med['importance']);?></td>
					</tr>
		 		<?php endforeach;?>
		 	</tbody>
		 </table>
			 			 		
		 		 
         
         <table class="datatable_sch
         <?php if(($this->acknowledge  == "1" && !empty($cocktail_details_alt)) || ($this->ModulePrivileges[155] == true && ! empty($cocktail_details_alt_offline)) ) echo 'ack_back';?>
         " style="width:100%">
			<tr>
				<td width="20%"><label><?php echo $this->translate("Kommentar")?>:</label></td>
				<td width="80%"><?php echo $cocktail_details['description']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("medication_type")?>:</label></td>
				<td><?php echo $cocktail_details['pumpe_medication_type']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("Flussrate")?>:</label></td>
				<td><?php echo $cocktail_details['flussrate']?></td>
			</tr>
			<tr>
				<td><label><?php echo $this->translate("medication_carrier_solution")?>:</label></td>
				<td><?php echo $cocktail_details['carrier_solution']?></td>
			</tr>		 
				<tr>
					<td><label><?php echo $this->translate("Bolus")?>:</label></td>
					<td><?php echo $cocktail_details['bolus']?></td>
				</tr>		 
				<tr>
					<td><label><?php echo $this->translate("Max Bolus")?>:</label></td>
					<td><?php echo $cocktail_details['max_bolus']?></td>
				</tr>
				<tr>
					<td><label><?php echo $this->translate("Sperrzeit")?>:</label></td>
					<td><?php echo $cocktail_details['sperrzeit']?></td>
				</tr>		 
	 	</table>
		 		
		<?php if($this->acknowledge  == "1" && !empty($cocktail_details_alt)):?>
		<?php 
                        $prefix_lang_ack = '';
                        $ack_referance_txt = array();
                        $ack_referance_del = array();
						$ack_referance_txt[$med['id']]="";
						$ack_referance_del[$med['id']] = "";

						if($cocktail_details_alt['status'] == "delete")
						{
							$ack_referance_txt[$cocktail_details_alt['id']] = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>';
							$ack_referance_del[$cocktail_details_alt['id']] = '<span class="red_text">'.$this->translate($prefix_lang_ack . "Delete medication: ").'</span>'; 
						} 
						else if($cocktail_details_alt['status'] == "new")
						{
							$ack_referance_txt[$cocktail_details_alt['id']] = '<span class="green_text">'.$this->translate($prefix_lang_ack . "Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$cocktail_details_alt['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$cocktail_details_alt['id']] = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>'; 
							$ack_referance_del[$cocktail_details_alt['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$approve = '<button class="pump_med_approve_rights approvem" data-action="approve" data-recordid="'.$cocktail_details_alt['drugplan_cocktailid'].'" data-alt_id="'.$cocktail_details_alt['id'].'">'.$this->translate($prefix_lang_ack . "Approve").'</button>';
							$deny = '<button class="pump_med_approve_rights denym"   data-action="decline" data-recordid="'.$cocktail_details_alt['drugplan_cocktailid'].'" data-alt_id="'.$cocktail_details_alt['id'].'">'.$this->translate($prefix_lang_ack . "Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 ?>
		 <?php
         /* 
            $rowspan = 5; 
            if( 1 || $cocktail_details_alt['pumpe_type'] == "pca"){
			     $rowspan = 8;
		    }
          */
            $rowspan = 8;
         ?>
		 <table class="datatable_sch ack_back" style='width:100%;' border="1">
		 	<tr>
		 		<td colspan="2" width="60%">
		 			<?php echo  $ack_referance_txt[$cocktail_details_alt['id']]; ?>
		 		</td>
		 		<td rowspan="<?php echo $rowspan;?>" width="40%" style='text-align:right'>
		 			<?php echo  $approve; ?>
		 			<?php echo  $deny; ?>
		 		</td>
		 		
		 	</tr>
			<tr>
				<td width="20%"><label><?php echo $this->translate("Kommentar")?>:</label></td>
				<td width="40%"><?php echo $cocktail_details_alt['description']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("medication_type")?>:</label></td>
				<td><?php echo $cocktail_details_alt['pumpe_medication_type']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("Flussrate")?>:</label></td>
				<td><?php echo $cocktail_details_alt['flussrate']?></td>
			</tr>
			<tr>
				<td><label><?php echo $this->translate("medication_carrier_solution")?>:</label></td>
				<td><?php echo $cocktail_details_alt['carrier_solution']?></td>
			</tr>		 
				<tr>
					<td><label><?php echo $this->translate("Bolus")?>:</label></td>
					<td><?php echo $cocktail_details_alt['bolus']?></td>
				</tr>	
				<tr>
					<td><label><?php echo $this->translate("Max Bolus")?>:</label></td>
					<td><?php echo $cocktail_details_alt['max_bolus']?></td>
				</tr>	 
				<tr>
					<td><label><?php echo $this->translate("Sperrzeit")?>:</label></td>
					<td><?php echo $cocktail_details_alt['sperrzeit']?></td>
				</tr>		 
	 	</table>
		<?php endif; ?>
	 	
	 	
<?php if($this->ModulePrivileges[155] == true && ! empty($cocktail_details_alt_offline) ) :?> 
<!-- start offline changes isschmerzpumpe details -->
<?php foreach($cocktail_details_alt_offline as $on_hold_changes_offline) : ?>
<?php 
    $prefix_lang_ack = 'Offline ';
    $ack_referance_txt = "";
    $ack_referance_del = "";
	 	
    if($cocktail_details_alt['status'] == "delete")
    {
        $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>';
        $ack_referance_del = '<span class="red_text">'.$this->translate($prefix_lang_ack . "Delete medication: ").'</span>'; 
    } 
    else if($cocktail_details_alt['status'] == "new")
    {
        $ack_referance_txt = '<span class="green_text">'.$this->translate($prefix_lang_ack . "Unapproved newly added medication: ").'</span>'; 
        $ack_referance_del = ''; 
    } 
    else
    {
        $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>'; 
        $ack_referance_del = ''; 
    }

    if($this->approval_rights == "1")
    {
        $approve = '<button class="pump_med_approve_rights approvem" data-action="approve" data-recordid="'.$on_hold_changes_offline['drugplan_cocktailid'].'" data-alt_id="'.$on_hold_changes_offline['id'].'">'.$this->translate($prefix_lang_ack . "Approve").'</button>';
        $deny = '<button class="pump_med_approve_rights denym"   data-action="decline" data-recordid="'.$on_hold_changes_offline['drugplan_cocktailid'].'" data-alt_id="'.$on_hold_changes_offline['id'].'">'.$this->translate($prefix_lang_ack . "Decline").'</button>';
    } 
    else
    {
        $app_rights = '';
        $approve = '';
        $deny = '';
    }

    $rowspan = 8;
?>
         <table class="datatable_sch ack_back" style='width:100%;' border="1">
			<tr>
                <td colspan="2" width="60%">
                    <?php echo  $ack_referance_txt; ?>
                </td>
                <td rowspan="<?php echo $rowspan;?>" width="40%" style='text-align:right'>
                    <?php echo  $approve; ?>
                    <?php echo  $deny; ?>
                </td>
                
            </tr>
            <tr>
				<td width="20%"><label><?php echo $this->translate("Kommentar")?>:</label></td>
                <td width="40%"><?php echo $on_hold_changes_offline['description']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("medication_type")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['pumpe_medication_type']?></td>
			</tr>		 
			<tr>
				<td><label><?php echo $this->translate("Flussrate")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['flussrate']?></td>
			</tr>
			<tr>
				<td><label><?php echo $this->translate("medication_carrier_solution")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['carrier_solution']?></td>
			</tr>		 
				<tr>
					<td><label><?php echo $this->translate("Bolus")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['bolus']?></td>
				</tr>		
				<tr>
					<td><label><?php echo $this->translate("Max Bolus")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['max_bolus']?></td>
				</tr> 
				<tr>
					<td><label><?php echo $this->translate("Sperrzeit")?>:</label></td>
                <td><?php echo $on_hold_changes_offline['sperrzeit']?></td>
				</tr>		 
	 	</table>

<?php endforeach; ?>
<!-- end offline changes isschmerzpumpe details -->
		<?php endif; ?>
	</div>
		
	
<script type="text/javascript">
$(document).ready(function(){
	// DATATABLE
	
	var isschmerzpumpe_sorting = saved_sorting['isschmerzpumpe'];	
	
	var sch_id = "<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>";
	var table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = 	$('#'+sch_id).DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		
		"stateSave": false,
		
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "targets": 1, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 2, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
				       	
				       	<?php $column = 3;?>
				       	
				       	<?php if ($this->show_new_fileds == "1"):?>
					       	{ "targets": 3, "searchable": true, "orderable": true, "name":"medication_unit" }, // medication_unit
					       	{ "bVisible": false, "targets": 4, "searchable": true, "orderable": true, "name":"medication_dosageform_hidden" }, // medication_dosage_form
					       	{ "bVisible": false, "targets": 5, "searchable": true, "orderable": true, "name":"medication_concentration_hidden" }, // medication_concentration  -HIDDEN
				       		<?php $column = 6;?>
				       	<?php endif;?>
				       	
				       	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": true,"name":"medication_dosage"  }, // medication_dosaje
				       	<?php $column++; ?>
				       	<?php $new_cloumn_number = $column;?>
				       	
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_dosage_24h_hidden" }, // medication_dosage_24h  -HIDDEN
				       	{ "targets": <?php echo $new_cloumn_number + 1;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	

				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				    
				       	{ "targets":  <?php echo $new_cloumn_number + 3;?>, "searchable": true, "orderable": true, "name":"medication_importance" }, // medication_importance
				],				
		order: [[isschmerzpumpe_sorting.col,isschmerzpumpe_sorting.ord]],
 		
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();

           api.rows( {page:'current'} ).every(function(){

        	   if( $(this.node()).data('medid') != undefined) {

					var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
           	   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }
                    this.child( [ack_moderate], "shown has_ack" ).show();
               }
           });
 
        } ,
        
		initComplete: function()
		{
			if(isschmerzpumpe_sorting.col == this.api().column('medication_drug_hidden:name').index() ) { // DRUG
				$('#drug_'+sch_id).removeClass('sorting');
				$('#drug_'+sch_id).removeClass('sorting_asc');
				$('#drug_'+sch_id).removeClass('sorting_desc');
				$('#drug_'+sch_id).addClass('sorting_'+isschmerzpumpe_sorting.ord);
			} 
			else
			{
				$('#drug_'+sch_id).removeClass('sorting_asc');
				$('#drug_'+sch_id).removeClass('sorting_desc');
				$('#drug_'+sch_id).addClass('sorting');
				
			}
			/*
			if(isschmerzpumpe_sorting.col== this.api().column('medication_dosageform_hidden:name').index()) { //TYPE
				$('#dosageform_'+sch_id).removeClass('sorting');
				$('#dosageform_'+sch_id).removeClass('sorting_asc');
				$('#dosageform_'+sch_id).removeClass('sorting_desc');
				$('#dosageform_'+sch_id).addClass('sorting_'+isschmerzpumpe_sorting.ord);
			} 
			else
			{
				$('#dosageform_'+sch_id).removeClass('sorting_asc');
				$('#dosageform_'+sch_id).removeClass('sorting_desc');
				$('#dosageform_'+sch_id).addClass('sorting');
				
			}
			*/
			if(isschmerzpumpe_sorting.col ==  this.api().column('medication_concentration_hidden:name').index()) { //Concentration
				$('#concentration_'+sch_id).removeClass('sorting');
				$('#concentration_'+sch_id).removeClass('sorting_asc');
				$('#concentration_'+sch_id).removeClass('sorting_desc');
				$('#concentration_'+sch_id).addClass('sorting_'+isschmerzpumpe_sorting.ord);
			} 
			else
			{
				$('#concentration_'+sch_id).removeClass('sorting_asc');
				$('#concentration_'+sch_id).removeClass('sorting_desc');
				$('#concentration_'+sch_id).addClass('sorting');
			}
			
			
			if(isschmerzpumpe_sorting.col ==  this.api().column('medication_dosage_24h_hidden:name').index()) { //Dosage 24h
				$('#dosage_24h_'+sch_id).removeClass('sorting');
				$('#dosage_24h_'+sch_id).removeClass('sorting_asc');
				$('#dosage_24h_'+sch_id).removeClass('sorting_desc');
				$('#dosage_24h_'+sch_id).addClass('sorting_'+isschmerzpumpe_sorting.ord);
			} 
			else
			{
				$('#dosage_24h_'+sch_id).removeClass('sorting_asc');
				$('#dosage_24h_'+sch_id).removeClass('sorting_desc');
				$('#dosage_24h_'+sch_id).addClass('sorting');
			}
		}
		
	});
	
	
	
	table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order.listener( $('#drug_'+sch_id), table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_drug_hidden:name').index() );
	//table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order.listener( $('#dosageform_'+sch_id), table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_dosageform_hidden:name').index() );
	table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order.listener( $('#concentration_'+sch_id), table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_concentration_hidden:name').index() );
	table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order.listener( $('#dosage_24h_'+sch_id), table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_dosage_24h_hidden:name').index() );
	
	$('#'+sch_id).on("order.dt",function(){
		var order = table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		
		save_sorting("medication-isschmerzpumpe",order);
		
		if(order[0][0] == table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_'+sch_id).removeClass('sorting');
			$('#drug_'+sch_id).removeClass('sorting_asc');
			$('#drug_'+sch_id).removeClass('sorting_desc');
			$('#drug_'+sch_id).addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_'+sch_id).removeClass('sorting_asc');
			$('#drug_'+sch_id).removeClass('sorting_desc');
			$('#drug_'+sch_id).addClass('sorting');
			
		}
		/*
		if(order[0][0] == table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_dosageform_hidden:name').index()) { //TYPE
			$('#dosageform_'+sch_id).removeClass('sorting');
			$('#dosageform_'+sch_id).removeClass('sorting_asc');
			$('#dosageform_'+sch_id).removeClass('sorting_desc');
			$('#dosageform_'+sch_id).addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosageform_'+sch_id).removeClass('sorting_asc');
			$('#dosageform_'+sch_id).removeClass('sorting_desc');
			$('#dosageform_'+sch_id).addClass('sorting');
			
		}
		*/
		if(order[0][0] ==  table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_'+sch_id).removeClass('sorting');
			$('#concentration_'+sch_id).removeClass('sorting_asc');
			$('#concentration_'+sch_id).removeClass('sorting_desc');
			$('#concentration_'+sch_id).addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_'+sch_id).removeClass('sorting_asc');
			$('#concentration_'+sch_id).removeClass('sorting_desc');
			$('#concentration_'+sch_id).addClass('sorting');
		}
		
		
		if(order[0][0] ==  table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column('medication_dosage_24h_hidden:name').index()) { //Dosage 24h
			$('#dosage_24h_'+sch_id).removeClass('sorting');
			$('#dosage_24h_'+sch_id).removeClass('sorting_asc');
			$('#dosage_24h_'+sch_id).removeClass('sorting_desc');
			$('#dosage_24h_'+sch_id).addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#dosage_24h_'+sch_id).removeClass('sorting_asc');
			$('#dosage_24h_'+sch_id).removeClass('sorting_desc');
			$('#dosage_24h_'+sch_id).addClass('sorting');
		}
		
		
		var cocktail_id = "<?php echo $cocktail_details['id'];?>";
		var isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order();
		
		if(isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>){
			var isschmerzpumpe_columnheader<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column( isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>[0][0] ).header();
			var isschmerzpumpe_sorted_column<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = $(isschmerzpumpe_columnheader<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>).data('sortname');
			var isschmerzpumpe_sorted_dir<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>[0][1];
			
			$('#<?php echo $medication_type; ?>_<?php echo $cocktail_details["id"];?>_sort_by').val(isschmerzpumpe_sorted_column<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>);
			$('#<?php echo $medication_type; ?>_<?php echo $cocktail_details["id"];?>_sort_dir').val(isschmerzpumpe_sorted_dir<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>);
			
		}
		
	});
	
	var cocktail_id = "<?php echo $cocktail_details['id'];?>";
	var isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.order();
	if(isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>){
		var isschmerzpumpe_columnheader<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = table_isschmerzpumpe<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>.column( isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>[0][0] ).header();
		var isschmerzpumpe_sorted_column<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = $(isschmerzpumpe_columnheader<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>).data('sortname');
		var isschmerzpumpe_sorted_dir<?php echo $medication_type; ?><?php echo $pumpe_cnt;?> = isschmerzpumpe_order<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>[0][1];
		
		$('#<?php echo $medication_type; ?>_<?php echo $cocktail_details['id'];?>_sort_by').val(isschmerzpumpe_sorted_column<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>);
		$('#<?php echo $medication_type; ?>_<?php echo $cocktail_details['id'];?>_sort_dir').val(isschmerzpumpe_sorted_dir<?php echo $medication_type; ?><?php echo $pumpe_cnt;?>);
		
	}

});
</script>
	
	
	<?php $pumpe_cnt++; endforeach;?>
	
	<?php elseif($medication_type == "scheduled"): ?>
	
	<script type="text/javascript">
	$(document).ready(function(){
		
		
		var scheduled_sorting = saved_sorting['scheduled'];	
	// DATATABLE
var table_scheduled = 	$('.medication_table_scheduled').DataTable({
		// ADD language
		"language": {
			"emptyTable" : "Keine Medikamente",
		},
		"lengthMenu": [[10, 25, 50], [10, 25, 50]],
        "dom": 't',
		processing: true,
		info: false,
		filter: true,
		paginate: false,
		 "orderCellsTop": true,
		serverSide: false,
		
		"stateSave": false,
		
		"stateSaveCallback43": function (settings, data)
		{						
			$.ajax({
				url: appbase+'user/savetablepreferences',		
				type: "POST",					
				dataType: "json",
				data: { "page": "medication-scheduled","patient":pat, "data": data, "save_sorting": "yes" }
			});
			
			
		},
 
		"stateLoadCallback2": function (settings)
		{
			o = false;
			
			 $.ajax( {
				url: appbase+'user/loadtablepreferences',			
				type: "POST",
			    "async": false,
			    data: { "page": "medication-scheduled", "load_sorting": "yes" },
			    "dataType": "json",
			    "success": function (json) {
			        o = json;
			    }
			 });
			 
			 return o;
		},
		
		"autoWidth": false,
		"scrollX": true,
		"scrollCollapse":true,
		columnDefs: [ 
				       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true, "name":"medication_last_update_hidden" },  // medication_last_update_full -HIDDEN
				       	{ "bVisible": false, "targets": 1, "searchable": true, "orderable": true, "name":"medication_administration_date_hidden" },  // medication_administration_date_full -HIDDEN
				       	{ "targets": 2, "searchable": true, "orderable": true, "name":"medication_name" }, // medication_name
				       	{ "bVisible": false, "targets": 3, "searchable": true, "orderable": true, "name":"medication_drug_hidden" }, // medication_drug -HIDDEN
			       	<?php $column = 4;?>
					<?php if ($this->show_new_fileds == "1"  && $schedule_extra == "1"):?>
						{ "targets": 4, "searchable": true, "orderable": true, "name":"medication_unit" }, // medication_unit
					    { "bVisible": false, "targets": 5, "searchable": true, "orderable": true, "name":"medication_type_hidden" }, // medication_type  -HIDDEN
					    { "targets": 6, "searchable": true, "orderable": true, "name":"medication_dosage_form" }, // medication_dosage_form
					    { "bVisible": false, "targets": 7, "searchable": true, "orderable": true, "name":"medication_concentration_hidden" }, // medication_concentration  -HIDDEN
					<?php $column = 8;?>
					<?php endif;?>

					<?php if(in_array("scheduled",$timed_scheduled_medications )):?>
						<?php foreach($this->dosage_intervals['scheduled'] as $k => $di):?>
						{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - time schedule
					<?php $column++; endforeach; ?>
					<?php else: ?>
					   	{ "targets": <?php echo $column;?>, "searchable": true, "orderable": false }, // medication_dosage - ONE textfiels
					   	<?php $column++;?>
				    <?php endif;?>
			       	<?php $new_cloumn_number = $column;?>
				       	{ "targets": <?php echo $new_cloumn_number;?>, "searchable": true, "orderable": true, "name":"medication_indication" }, // medication_indication
				       	{ "bVisible": false, "targets": <?php echo $new_cloumn_number+1;?>, "searchable": true, "orderable": true, "name":"comment_hidden" }, // medication_commets -HIDDEN
				       	
				       	{ "targets": <?php echo $new_cloumn_number + 2;?>, "searchable": true, "orderable": true, "name":"medication_days_interval"}, // medication_days_interval
				       	{ "iDataSort": 1, "targets": <?php echo $new_cloumn_number + 3;?>, "searchable": true, "orderable": true, "name":"medication_administration_date"}, // medication_administration
				       	
				       	{ "iDataSort": 0, "targets": <?php echo $new_cloumn_number + 4;?>, "searchable": true, "orderable": true, "name":"medication_last_update"}, // medication_last_update
				       	{ "targets":  <?php echo $new_cloumn_number+5;?>, "searchable": true, "orderable": true, "name":"medication_importance" } // medication_importance
				],				
		order: [[scheduled_sorting.col,scheduled_sorting.ord]],
 		
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();

            api.rows( {page:'current'} ).every(function(){
				
            	var classnow="odd";
                if ($(this.node()).hasClass('even')){
                    classnow = 'even';
                }
                
        	   if( $(this.node()).data('medid') != undefined) {
        		   
					var medid = $(this.node()).data('medid');
                   var ack_moderate = '';
                   if ($( "#ack_information_"+medid ).length) {
                       ack_moderate += $( "#ack_information_"+medid ).html();
           	   }
                   if ($( ".ack_information_offline_"+medid ).length) {
                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
                   }                   
                   this.child( [content_toggler_row, ack_moderate], "child_row_toggler shown has_ack" ).show();
               } else { 
                   this.child( content_toggler_row , "child_row_toggler shown toggler_closed "+classnow).show();
               }
        	   
           });
 
        },
		initComplete: function()
		{
			// this.api().draw();
			
		}
		
	});


	// ############## SORTING scheduled ##############################
	var scheduled_order = table_scheduled.order();
	var scheduled_columnheader = table_scheduled.column( scheduled_order[0][0] ).header();
	var scheduled_sorted_column = $(scheduled_columnheader).data('sortname');
	var scheduled_sorted_dir = scheduled_order[0][1];
	
	$('#scheduled_sort_by').val(scheduled_sorted_column);
	$('#scheduled_sort_dir').val(scheduled_sorted_dir);

	table_scheduled.order.listener( $('#drug_scheduled'), table_scheduled.column('medication_drug_hidden:name').index() );
	table_scheduled.order.listener( $('#med_type_scheduled'), table_scheduled.column('medication_type_hidden:name').index() );
	table_scheduled.order.listener( $('#concentration_scheduled'), table_scheduled.column('medication_concentration_hidden:name').index() );
	table_scheduled.order.listener( $('#comments_scheduled'), table_scheduled.column('comment_hidden:name').index() );
	
	$('.medication_table_scheduled').on("order.dt",function(){
		var order = table_scheduled.order();
		var column_id = order[0][0];
		var order_direction = order[0][1];
		
		/* save sorting */
		save_sorting("medication-scheduled",order);
				
		
		if(order[0][0] == table_scheduled.column('medication_drug_hidden:name').index() ) { // DRUG
			$('#drug_scheduled').removeClass('sorting');
			$('#drug_scheduled').removeClass('sorting_asc');
			$('#drug_scheduled').removeClass('sorting_desc');
			$('#drug_scheduled').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#drug_scheduled').removeClass('sorting_asc');
			$('#drug_scheduled').removeClass('sorting_desc');
			$('#drug_scheduled').addClass('sorting');
			
		}
		
		if(order[0][0] == table_scheduled.column('medication_type_hidden:name').index()) { //TYPE
			$('#med_type_scheduled').removeClass('sorting');
			$('#med_type_scheduled').removeClass('sorting_asc');
			$('#med_type_scheduled').removeClass('sorting_desc');
			$('#med_type_scheduled').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#med_type_scheduled').removeClass('sorting_asc');
			$('#med_type_scheduled').removeClass('sorting_desc');
			$('#med_type_scheduled').addClass('sorting');
			
		}
		
		if(order[0][0] ==  table_scheduled.column('medication_concentration_hidden:name').index()) { //Concentration
			$('#concentration_scheduled').removeClass('sorting');
			$('#concentration_scheduled').removeClass('sorting_asc');
			$('#concentration_scheduled').removeClass('sorting_desc');
			$('#concentration_scheduled').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#concentration_scheduled').removeClass('sorting_asc');
			$('#concentration_scheduled').removeClass('sorting_desc');
			$('#concentration_scheduled').addClass('sorting');
			
		}
		
		if(order[0][0] == table_scheduled.column('comment_hidden:name').index()) { // COMMENT 
			$('#comments_scheduled').removeClass('sorting');
			$('#comments_scheduled').removeClass('sorting_asc');
			$('#comments_scheduled').removeClass('sorting_desc');
			$('#comments_scheduled').addClass('sorting_'+order[0][1]);
		} 
		else
		{
			$('#comments_scheduled').removeClass('sorting_asc');
			$('#comments_scheduled').removeClass('sorting_desc');
			$('#comments_scheduled').addClass('sorting');
			
		}
		
		var scheduled_order = table_scheduled.order();
		var scheduled_columnheader = table_scheduled.column( scheduled_order[0][0] ).header();
		var scheduled_sorted_column = $(scheduled_columnheader).data('sortname');
		var scheduled_sorted_dir = scheduled_order[0][1];

		$('#scheduled_sort_by').val(scheduled_sorted_column);
		$('#scheduled_sort_dir').val(scheduled_sorted_dir);
	});

	
			
});
</script>
	
	<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title")?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>

			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][allow]" checked="checked" id="print<?php echo $medication_type;?>"  class="all_print_medication" />
				<label for="print<?php echo $medication_type;?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_sort_by" name="print[<?php echo $medication_type;?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_sort_dir" name="print[<?php echo $medication_type;?>][sortdir]" />			
		</div>

		<?php if($medication_type == "isbedarfs" && ( count($this->bedarfsdrop) > 0 || count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
				<label>Medikamenten Set hinzufgen</label>
				<?php if( count($this->bedarfsdrop) > '1') :?>					
					<?php echo $this->formSelect('bid', $this->bid, array('onChange'=>'togglebutton(this.value)'), $this->bedarfsdrop) ?>
					<input name="insert_bedarf" type="submit" id="MedicButton" value="<?php echo $this->translate('add'); ?>" disabled="disabled" />
				<?php endif;?>
				
			<!-- ISPC-2247 -->
			<?php if( count($this->new_medication_sets[$medication_type]) > '0') :?>					
				<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
			<?php endif;?>
		</div>
		<?php endif;?>


		<?php if( $medication_type == "iscrisis"  && ( count($this->new_medication_sets[$medication_type]) > 0)):?>
		<div class="bedarf_sets">
			<!-- ISPC-2247 -->
			<label>Medikamenten Set hinzufgen</label>
			<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
		</div>
		<?php endif;?>


		<table id="<?php echo $medication_type; ?>" class="medication_table_<?php echo $medication_type; ?> datatable">
			<thead>
		 		<tr>
		 			<th rowspan="2"><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th rowspan="2"><?php echo $this->translate('medication_administration_date_full'); ?></th><!--  0 -->
		 			<th rowspan="1" data-sortname="medication"><?php echo $this->translate('medication_name');?></th><!--  1 -->
		 			<th rowspan="2" data-sortname="drug"><?php echo $this->translate('medication_drug_hidden'); ?></th><!--  2 -->
		 			<?php if ($this->show_new_fileds == "1" && $schedule_extra == "1" ):?>
			 			<th rowspan="1" data-sortname="unit"><?php echo $this->translate('medication_unit'); ?></th><!--  3 -->
			 			<th rowspan="2" data-sortname="type"><?php echo $this->translate('medication_type_hidden'); ?></th><!--  4 -->
			 			<th rowspan="1" data-sortname="dosage_form"><?php echo $this->translate('medication_dosage_form_th'); ?></th><!--  5 -->
			 			<th rowspan="2" data-sortname="concentration"><?php echo $this->translate('medication_conentration_hidden'); ?></th><!--  6 -->
		 			<?php endif;?>
		 			<!--  DOSAGE TABLE HEADER PARENT-->
		 			<th rowspan="2" data-sortname="dosage"><?php echo $this->translate('medication_dosage'); ?></th> <!--  5 -->
		 			<th rowspan="1" data-sortname="indication"><?php echo $this->translate('medication_indication'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="comments"><?php echo $this->translate('medication_comments_hidden'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="days_interval"><?php echo $this->translate('medication_days_interval'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="medication_administration_date"><?php echo $this->translate('medication_administration_date'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 			<th rowspan="2" data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
		 		</tr>
		 		<tr>
		 			<th rowspan="1" class="sorting" id="drug_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_drug'); ?></th><!--  2 -->
		 			<?php if ($this->show_new_fileds == "1"  && $schedule_extra == "1"):?>
			 			<th rowspan="1" class="sorting" id="med_type_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_type'); ?></th><!--  4 -->
			 			<th rowspan="1" class="sorting" id="concentration_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_concentration'); ?></th><!--  4 -->
		 			<?php endif;?>
		 			
		 			<th rowspan="1" class="sorting" id="comments_<?php echo $medication_type; ?>"><?php echo $this->translate('medication_comments'); ?></th><!--  4 -->
		 		</tr>
		 	</thead>
	
			<!--  LIST MEDICATION -->
		 	<tbody>
		 		<?php foreach($medication_array[$medication_type] as $k =>$med):?>
					<tr  
                    <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']]))) :?> data-medid="<?php echo $med['id']; ?>"  class="has_ack" <?php endif; ?>                     
                    >
						<!--  MEDICATION CHANGE IN FULL -->
						<td><?php echo $med['medication_change'];?></td>
						<td><?php echo $med['administration_date'];?></td>
						
						<!--  MEDICATION NAME -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><a href="javascript:void(0)" class="show_medication_info" data-medication_type="<?php echo $medication_type; ?>" data-drugplan_id="<?php echo $med['id']; ?>" ><img src="<?php echo RES_FILE_PATH ?>/images/info_med.png" alt="mediction_info" class="medication_info" /></a><?php echo $med['medication'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $med['drug'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION DRUG HIDDEN-->
						<td><?php echo $med['drug'];?></td>
						
						<?php if ($this->show_new_fileds == "1"  && $schedule_extra == "1"):?>
						
						<!--  MEDICATION UNIT / TYPE -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $med['unit'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_type'); ?></span>
								<span class="vl"><?php echo $med['type'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION TYPE HIDDEN-->
						<td><?php echo $med['type'];?></td> 

												
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $med['dosage_form'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
								<span class="vl"><?php echo $med['concentration'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION CONCENTRATION HIDDEN-->
						<td><?php echo $med['concentration'];?></td> 
						<?php endif;?>
						
						
						<!--  MEDICATION DOSAGE INPUTS-->
						
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage'); ?></span>
									<span class="vl"><?php echo $med['dosage'];?><?php if ($this->show_new_fileds == "1"  && $schedule_extra == "1" && strlen($med['dosage']) > 0):?> <?php echo $med['unit'];?><?php endif;?></span>
								</div>
                                <?php if ($this->ModulePrivileges[182]): ?>
                                    <div class="mifo">
                                        <span class="lb">
                                            <?=$this->translate("Dosage according to the product information")?>
                                            <?=($med['dosage_product'] == 'yes' ? ': Ja' : ($med['dosage_product'] == 'no' ? ': Nein' : '-'))?>
                                        </span>
                                    </div>
                                <?php endif; ?>
							</td>
		 				
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['indication_color'];?>"><?php echo $med['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['indication'];?></span> 
								<?php endif;?>
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl" id="<?php echo $med['id'];?>_medi_comment"><?php echo $med['comments'];?></span>
							</div>
						
						</td>
						
						<!--  MEDICATION COMMENTS HIDDEN-->
						<td><?php echo $med['comments'];?></td>
						 
						<!--  MEDICATION DAYS INTERVAL  -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['days_interval'];?></span>
							</div>
                            <?php if ($this->ModulePrivileges[182]): ?>
                                <div class="mifo">
                                    <span class="lb">
                                        <?=$this->translate("Interval according to technical information")?>
                                        <?=($med['days_interval_technical'] == 'yes' ? ': Ja' : ($med['days_interval_technical'] == 'no' ? ': Nein' : '-'))?>
                                    </span>
                                </div>
                            <?php endif; ?>
						</td>
						
						
						<!--  MEDICATION ADMINISTRATION DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<?php //echo $med['scheduled_date'];?>
								
								<span class="lb">&nbsp;</span>
								<?php  if( $med['administration_date'] != "0000-00-00 00:00:00"):?>
									<span class="vl" id="<?php echo $med['id'];?>_administration_date" ><?php echo date("d.m.Y",strtotime($med['administration_date']));?></span>
									<?php if($med['allow_restart'] == "1"):?>
										<button type="button" class="interval_restart interval_settings" data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>" id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_restart" ><?php echo $this->translate("give medication- Restart start interval")?></button>
									<?php endif; ?>
								<?php else: ?>
									
									<span class="vl"  id="<?php echo $med['id'];?>_administration_date" ></span>
									<button type="button" class="interval_start interval_settings"  data-drug_id="<?php echo $med['id'];?>"  data-medication_type = "<?php echo $medication_type;?>"  id="<?php echo $medication_type;?>_<?php echo $med['id'];?>_interval_start" ><?php echo $this->translate("give medication- start interval")?></button>
								<?php endif; ?>
							</div>
						</td>
						
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo date('d.m.Y',strtotime($med['medication_change']));?></span>
							</div>
						</td>
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td  data-order="<?php echo $med['importance'];?>" >
							<div class="mifo" style="padding-top:24px">
								<span class="vl"><?php echo $med['importance'];?> </span>
							</div>
						</td>
					</tr>
		 		<?php endforeach;?>
		 	</tbody>
		 </table>
	</div>
	
	
<!-- ###########################################	 -->
	<?php else: //  treatment care?>
	<script type="text/javascript">
		$(document).ready(function(){
			// DATATABLE TREATMENT CARE
			/*###################################################################################################################################################*/			
			var treatment_care_sorting = saved_sorting['treatment_care'];	
			treatmentcare_table = $('.tr_medication_table').DataTable({
				"language": {
					"emptyTable" : "Keine Medikamente",
				},
				"lengthMenu": [[10, 25, 50], [10, 25, 50]],

		        "dom": 't',
		 
				processing: true,

				info: false,
				
				filter: true,
				
				paginate: false,

				 "orderCellsTop": true,
				
				serverSide: false,
				"autoWidth": true,
				"scrollX": false,
				"scrollCollapse":true,
		 
				columnDefs: [ 
						       	{ "bVisible": false, "targets": 0, "searchable": true, "orderable": true,  "name":"medication_last_update_hidden" },  // medication_last_update_full
					       		{ "targets": 1, "searchable": true, "orderable": true,"name":"medication_name"  }, // medication_name
						       	{ "targets": 2, "searchable": true, "orderable": true, "name":"comments" }, // medication_commets
						       	{ "iDataSort": 0, "targets":3, "searchable": true, "orderable": true, "name":"medication_last_update"  }, // medication_last_update
						       	{ "targets":  4, "searchable": true, "orderable": true, "name":"medication_importance"  }, // medication_sort
						],				
				order: [[treatment_care_sorting.col,treatment_care_sorting.ord]],	
				
				
		        "drawCallback": function ( settings ) {
		            var api = this.api();
		            var rows = api.rows( {page:'current'} ).nodes();
		            
		           api.rows( {page:'current'} ).every(function(){

		        	   /* if( $(this.node()).data('medid') != undefined) {
							var medid = $(this.node()).data('medid');
							
							var content = $( "#ack_information_"+medid ).html();
							this.child(content ).show();
		           	   } */
		        	   
		        	   if( $(this.node()).data('medid') != undefined) {
		                   var medid = $(this.node()).data('medid');
		                   var ack_moderate = '';
		                   if ($( "#ack_information_"+medid ).length) {
		                       ack_moderate += $( "#ack_information_"+medid ).html();
		                   }
		                   if ($( ".ack_information_offline_"+medid ).length) {
		                       $( ".ack_information_offline_"+medid).each(function(){ack_moderate += $(this).html();});
		                   }                   
		                   this.child( ack_moderate, "shown has_ack" ).show();
		           	   }
		           });
		 
		        },
		        
				initComplete: function()
				{
					// this.api().draw();
					
				}
				
			});
			/* -------------- SORTING treatment_care ------------------------------ */
			var treatment_care_order = treatmentcare_table.order();
			
			if(treatment_care_order){
				var treatment_care_columnheader = treatmentcare_table.column( treatment_care_order[0][0] ).header();
				var treatment_care_sorted_column = $(treatment_care_columnheader).data('sortname');
				var treatment_care_sorted_dir = treatment_care_order[0][1];
				
				$('#treatment_care_sort_by').val(treatment_care_sorted_column);
				$('#treatment_care_sort_dir').val(treatment_care_sorted_dir);
			}
			
			$('.tr_medication_table').on("order.dt",function(){
				var treatment_care_order = treatmentcare_table.order();
				
				var column_id = treatment_care_order[0][0];
				var order_direction = treatment_care_order[0][1];
				
				
				/* save sorting */
				save_sorting("medication-treatment_care", treatment_care_order);
				
				if(treatment_care_order){
					var treatment_care_columnheader = treatmentcare_table.column( treatment_care_order[0][0] ).header();
					var treatment_care_sorted_column = $(treatment_care_columnheader).data('sortname');
					var treatment_care_sorted_dir = treatment_care_order[0][1];
					
					$('#treatment_care_sort_by').val(treatment_care_sorted_column);
					$('#treatment_care_sort_dir').val(treatment_care_sorted_dir);
				}
			});
			
			
			
		});
	</script>	
	
	
	
	
		<div class="medication_block">
		<div class="med_block_header">
			<h1><?php echo $this->translate($medication_type." medication title")?></h1>
			<a href="<?php  echo APP_BASE.'patientnew/medicationedit?id='.$_REQUEST['id'].'&#'.$medication_type; ?>"  class="medication_edit_button"> <?php echo $this->translate($medication_type." medication edit")?> </a>
			
			<div class="pdf_options">
				<input type="checkbox" value="1" name="print[<?php echo $medication_type;?>][allow]" checked="checked" id="print<?php echo $medication_type;?>" class="all_print_medication" />
				<label for="print<?php echo $medication_type;?>"><?php echo $this->translate('show in pdf');?></label>
			</div>
			
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['col'];?>" id="<?php echo $medication_type;?>_sort_by" name="print[<?php echo $medication_type;?>][sortby]" /> 	
			<input type="hidden" value="<?php echo $this->saved_order[$medication_type]['ord'];?>" id="<?php echo $medication_type;?>_sort_dir" name="print[<?php echo $medication_type;?>][sortdir]" /> 	
		</div>
		<table id="<?php echo $medication_type; ?>_med_table" class="tr_medication_table datatable">
			<thead>
		 		<tr>
		 			<th><?php echo $this->translate('medication_last_update_full'); ?></th><!--  0 -->
		 			<th data-sortname="medication"><?php echo $this->translate('medication_treatment_care_name');?></th><!--  1 -->
		 			<th data-sortname="comments"><?php echo $this->translate('medication_comments'); ?></th><!--  0 -->
		 			<th data-sortname="medication_change"><?php echo $this->translate('medication_last_update'); ?></th><!--  0 -->
		 			<th data-sortname="importance"><?php echo $this->translate('medication_importance'); ?></th><!--  0 -->
		 		</tr>
 
		 	</thead>
			<!--  LIST MEDICATION -->
		 	<tbody>
		 		<?php foreach($medication_array[$medication_type] as $k =>$med):?>
		 		
					<tr
                    <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']]))) :?> data-medid="<?php echo $med['id']; ?>"  class="has_ack" <?php endif; ?>
                    >
						<!--  MEDICATION CHANGE IN FULL -->
						<td><?php echo $med['medication_change'];?></td>
						
						<!--  MEDICATION NAME -->
						<td><a href="javascript:void(0)" class="show_medication_info" data-medication_type="<?php echo $medication_type; ?>" data-drugplan_id="<?php echo $med['id']; ?>" ><img src="<?php echo RES_FILE_PATH ?>/images/info_med.png" alt="mediction_info" class="medication_info" /></a><?php echo $med['medication'];?></td>
						
						<!--  MEDICATION COMMENTS -->
						<td><?php echo $med['comments'];?></td> 
						
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td><?php echo date('d.m.Y',strtotime($med['medication_change']));?></td>
						
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td><?php echo $med['importance'];?> </td>
					</tr> 			
		 		<?php endforeach;?>
		 	</tbody>
		 </table>
	</div>
	<?php endif;?>

<!--################################ -->
<!-- START MEDICAL ACKNOWLEDGE  -->
<!--################################ -->
<div>
	<?php if($medication_type != "isschmerzpumpe"):?>
	
			 		<?php foreach($medication_array[$medication_type] as $k =>$med):?>
						
				 	<?php if( $this->acknowledge  == "1" && ! empty($med['on_hold_changes'][$med['id']] )) : ?>
				 	<!-- online changes ack moderate -->
				 			 		
					<?php 
						$ack_referance_txt = array();
                        $ack_referance_del = array();
                        $ack_referance_txt[$med['id']]="";
						$ack_referance_del[$med['id']] = "";

						  if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						  {
							 $ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							 $ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						  } 
						  else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						  {
							 $ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							 $ack_referance_del[$med['id']] = ''; 
						  } 
						  else
						  {
							 $ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							 $ack_referance_del[$med['id']] = ''; 
						  }
                       
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
					<div id="ack_information_<?php echo $med['id'];?>"  class="ack_div">
				 		<div class="ack_inner_div">
				 			<?php echo $ack_referance_txt[$med['id']];?>
					 		<div class=" ack_buttons">
					 			<?php echo $approve; ?>
								<?php echo $deny; ?>
					 		</div>
				 		</div>
						<div class="ack_inner_div">
						 	<?php echo $ack_referance_del[$med['id']];?> 
						 	<b><?php echo $this->translate('medication_change_date');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?>  |  
					 		<b><?php echo $this->translate('medication_name');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['name'];?>  | 
					 		
					 		<? if( strlen($med['on_hold_changes'][$med['id']]['drug'])  > 0) :?> 
					 			<b><?php echo $this->translate('medication_drug');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['drug'];?>  | 
							<?php endif;?>
					 		
					 		<?php if($medication_type == "isintubated"):?>
						 		<? if( strlen($med['on_hold_changes'][$med['id']]['packaging'])  > 0) :?> 
						 			<b><?php echo $this->translate('medication_packaging');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['packaging_name'];?>  | 
								<?php endif;?>
							<?php endif;?>

					 		
			 				<?php if ($this->show_new_fileds == "1" && $medication_type != "treatment_care"):?>
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['unit'])  > 0) :?> 
									<b><?php echo $this->translate('medication_unit');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['unit'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['type'])  > 0) :?> 
									<b><?php echo $this->translate('medication_type');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['type'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['dosage_form'])  > 0) :?> 
									<b><?php echo $this->translate('medication_dosage_form');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['dosage_form'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['concentration'])  > 0) :?> 
									<b><?php echo $this->translate('medication_concentration');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['concentration'];?> | 
								<?php endif;?>
							<?php endif;?>
						
							<!--  MEDICATION DOSAGE INPUTS-->
							
							<?php if(in_array($medication_type,$timed_scheduled_medications)):?>
								<b><?php echo $this->translate('medication_dosage');?></b> 
								<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
									<b><?php echo $dosage_time; ?></b>: <?php echo $med['on_hold_changes'][$med['id']]['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>  
									<?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time]) > 0):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time];?>)<?php endif;?>  |  
				 				<?php endforeach;?>
			 				<?php elseif($medication_type != "treatment_care"): ?>
								<b><?php echo $this->translate('medication_dosage');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage'];?> <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
                                
                                <?php if ($medication_type == "isbedarfs" || $medication_type == "iscrisis") : ?>
                                 | <b><?=$this->translate('Interval for dosage'); ?></b> <?=$med['on_hold_changes'][$med['id']]['dosage_interval'];?>
                                | <b><?=$this->translate('medication_escalation'); ?></b> <?=$med['on_hold_changes'][$med['id']]['escalation'];?> | 
                                <?php endif; ?>
			 				<?php else:?>
			 				
			 				<?php endif;?>
			 				
			 				<?php if($medication_type != "treatment_care"):?>
								<b><?php echo $this->translate('medication_indication');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['indication'];?>   |
							<?php endif;?>
							  
							  
							  
					 		<?php if($medication_type == "isintubated"):?>
						 		<? if( strlen($med['on_hold_changes'][$med['id']]['kcal'])  > 0) :?> 
						 			<b><?php echo $this->translate('medication_kcal');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['kcal'];?>  | 
								<?php endif;?>
						 		<? if( strlen($med['on_hold_changes'][$med['id']]['volume'])  > 0) :?> 
						 			<b><?php echo $this->translate('medication_volume');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['volume'];?>  | 
								<?php endif;?>
							<?php endif;?>
							  
							  
							  
							<b><?php echo $this->translate('medication_comments');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['comments'];?>  | 
			 				
			 				<?php if($medication_type == "scheduled"):?>
								<b><?php echo $this->translate('medication_days_interval');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['days_interval'];?>   |
								<b><?php echo $this->translate('medication_administration_date');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['administration_date'];?>   |
							<?php endif;?>
							<b><?php echo $this->translate('medication_prescribed_by');?></b> <?php echo $med['on_hold_changes'][$med['id']]['prescribed_by'];?>   | 
							<b><?php echo $this->translate('medication_created_by');?></b>  <?php echo $med['on_hold_changes'][$med['id']]['created_by'];?>   
			 			</div>
		 			</div>
					<?php endif;?>
                    
                    
                    
                    <?php if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) : ?>
                    <!-- offline changes moderate -->               
                    <?php         
                    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes ) : 
                   
                        $ack_referance_txt = "";
                        $ack_referance_del = "";
                        switch($on_hold_changes['status']) {
                            case 'delete' :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>';
                                $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>';
                            break;

                            case 'new' :
                                $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>';
                                $ack_referance_del = '';
                            break;

                            case 'edit' :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved Edit changes: ").'</span>';
                                $ack_referance_del = '';
                            break;

                            default :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>';
                                $ack_referance_del = '';
                            break;
                        }


                 
                        if($this->approval_rights == "1")
                        {
                            $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Decline").'</button>';
                            $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Approve").'</button>';
                            $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Decline").'</button>';
                        } 
                        else
                        {
                            $app_rights = '';
                            $approve = '';
                            $deny = '';
                        }

                ?>
                    <div class="ack_div ack_information_offline_<?php echo $med['id'];?>">
                        <div class="ack_inner_div">
                            <?php echo $ack_referance_txt;?>
                            <div class=" ack_buttons">
                                <?php echo $approve; ?>
                                <?php echo $deny; ?>
                            </div>
                        </div>
                        <div class="ack_inner_div">
                            <?php echo $ack_referance_del;?> 
                            <b><?php echo $this->translate('medication_change_date');?></b>: <?php echo $on_hold_changes['medication_change_date'];?>  |  
                            <b><?php echo $this->translate('medication_name');?></b>: <?php echo $on_hold_changes['name'];?>  | 
                            
                            <? if( strlen($on_hold_changes['drug'])  > 0) :?> 
                                <b><?php echo $this->translate('medication_drug');?></b>: <?php echo $on_hold_changes['drug'];?>  | 
                            <?php endif;?>
                            
                            <?php if ($this->show_new_fileds == "1" && $medication_type != "treatment_care"):?>
                                <?php if( strlen($on_hold_changes['unit'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_unit');?></b>: <?php echo $on_hold_changes['unit'];?> | 
                                <?php endif;?>
                                 
                                <?php if( strlen($on_hold_changes['type'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_type');?></b>: <?php echo $on_hold_changes['type'];?> | 
                                <?php endif;?>
                                 
                                <?php if( strlen($on_hold_changes['dosage_form'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_dosage_form');?></b>: <?php echo $on_hold_changes['dosage_form'];?> | 
                                <?php endif;?>
                                 
                                <?php if( strlen($on_hold_changes['concentration'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_concentration');?></b>: <?php echo $on_hold_changes['concentration'];?> | 
                                <?php endif;?>
                            <?php endif;?>
                        
                            <!--  MEDICATION DOSAGE INPUTS-->
                            
                            <?php if(in_array($medication_type,$timed_scheduled_medications)):?>
                                <b><?php echo $this->translate('medication_dosage');?></b> 
                                <?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
                                    <b><?php echo $dosage_time; ?></b>: <?php echo $on_hold_changes['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes['dosage'][$dosage_time]) > 0):?> <?php echo $on_hold_changes['unit'];?><?php endif;?>  
                                    <?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes['dosage_concentration'][$dosage_time]) > 0):?>(<?php echo $on_hold_changes['dosage_concentration'][$dosage_time];?>)<?php endif;?>  |  
                                <?php endforeach;?>
                            <?php elseif($medication_type != "treatment_care"): ?>
                                <b><?php echo $this->translate('medication_dosage');?></b>:
                                <?php echo $on_hold_changes['dosage'];?> <?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes['dosage']) > 0):?> <?php echo $on_hold_changes['unit'];?><?php endif;?>
                            <?php else:?>
                            
                            <?php endif;?>
                            
                            <?php if($medication_type != "treatment_care"):?>
                                <b><?php echo $this->translate('medication_indication');?></b>: <?php echo $on_hold_changes['indication'];?>   |
                            <?php endif;?>
                              
                              
					 		<?php if($medication_type == "isintubated"):?>
						 		<? if( strlen($on_hold_changes['kcal'])  > 0) :?> 
						 			<b><?php echo $this->translate('medication_kcal');?></b>: <?php echo $on_hold_changes['kcal'];?>  | 
								<?php endif;?>
						 		<? if( strlen($on_hold_changes['volume'])  > 0) :?> 
						 			<b><?php echo $this->translate('medication_volume');?></b>: <?php echo $on_hold_changes['volume'];?>  | 
								<?php endif;?>
							<?php endif;?>
                              
                            <b><?php echo $this->translate('medication_comments');?></b>: <?php echo $on_hold_changes['comments'];?>  | 
                            
                            <?php if($medication_type == "scheduled"):?>
                                <b><?php echo $this->translate('medication_days_interval');?></b>: <?php echo $on_hold_changes['days_interval'];?>   |
                                <b><?php echo $this->translate('medication_administration_date');?></b>: <?php echo $on_hold_changes['administration_date'];?>   |
                            <?php endif;?>
                            <b><?php echo $this->translate('medication_prescribed_by');?></b> <?php echo $on_hold_changes['prescribed_by'];?>   | 
                            <b><?php echo $this->translate('medication_created_by');?></b>  <?php echo $on_hold_changes['created_by'];?>   
                        </div>
                    </div>
                    <?php endforeach; endif;?>
						
		 		<?php endforeach;?>

	
	<?php else:?>
		<?php $pumpe_cnt = 1; foreach($medication_array[$medication_type] as $pumpe_id =>$med_pumpe):?>
						
			<?php foreach($med_pumpe as $k =>$med):?>
						
				 	<?php if($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) :?>
				 	
				 			 		
					<?php 
						$ack_referance_txt = array();
                        $ack_referance_del = array();
							$ack_referance_txt[$med['id']]="";
						$ack_referance_del[$med['id']] = "";

						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						} 
						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						{
							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
					<div id="ack_information_<?php echo $med['id'];?>">
				 		<div class="ack_inner_div">
				 			<?php echo $ack_referance_txt[$med['id']];?>
					 		<div class=" ack_buttons">
					 			<?php echo $approve; ?>
								<?php echo $deny; ?>
					 		</div>
				 		</div>
						<div class="ack_inner_div">
						 	<?php echo $ack_referance_del[$med['id']];?> 
						 	<b><?php echo $this->translate('medication_change_date');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?>  |  
					 		<b><?php echo $this->translate('medication_name');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['name'];?>  | 
					 		
					 		<? if( strlen($med['on_hold_changes'][$med['id']]['drug'])  > 0) :?> 
					 			<b><?php echo $this->translate('medication_drug');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['drug'];?>  | 
							<?php endif;?>
					 		
			 				<?php if ($this->show_new_fileds == "1" && $medication_type != "treatment_care"):?>
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['unit'])  > 0) :?> 
									<b><?php echo $this->translate('medication_unit');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['unit'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['type'])  > 0) :?> 
									<b><?php echo $this->translate('medication_type');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['type'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['dosage_form'])  > 0) :?> 
									<b><?php echo $this->translate('medication_dosage_form');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['dosage_form'];?> | 
								<?php endif;?>
								 
						 		<?php if( strlen($med['on_hold_changes'][$med['id']]['concentration'])  > 0) :?> 
									<b><?php echo $this->translate('medication_concentration');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['concentration'];?> | 
								<?php endif;?>
							<?php endif;?>
						
							<!--  MEDICATION DOSAGE INPUTS-->
							
							
							<b><?php echo $this->translate('medication_dosage_h');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage'];?>
			 					<?php if(strlen($med['on_hold_changes'][$med['id']]['dosage_concentration']) > 0 ):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'];?>)<?php endif;?>
			 					 <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
								<b><?php echo $this->translate('medication_dosage_24h');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage_24h'];?> <?php if(strlen($med['on_hold_changes'][$med['id']]['dosage_24h_concentration']) > 0 ):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_24h_concentration'];?>)<?php endif;?> <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
							
							<!-- 
							<?php if($medication_type == "actual"):?>
								<b><?php echo $this->translate('medication_dosage');?></b> 
								<?php foreach($this->dosage_intervals as $k => $dosage_time):?>
									<b><?php echo $dosage_time; ?></b>: <?php echo $med['on_hold_changes'][$med['id']]['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>  
									<?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time]) > 0):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time];?>)<?php endif;?>  |  
				 				<?php endforeach;?>
			 				<?php elseif($medication_type != "treatment_care" && $medication_type != "isschmerzpumpe"): ?>
								<b><?php echo $this->translate('medication_dosage');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage'];?> <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
			 				<?php elseif($medication_type == "isschmerzpumpe"): ?>
								<b><?php echo $this->translate('medication_dosage_h');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage'];?>
			 					<?php if(strlen($med['on_hold_changes'][$med['id']]['dosage_concentration']) > 0 ):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'];?>)<?php endif;?>
			 					 <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
								<b><?php echo $this->translate('medication_dosage_24h');?></b>:
			 					<?php echo $med['on_hold_changes'][$med['id']]['dosage_24h'];?> <?php if(strlen($med['on_hold_changes'][$med['id']]['dosage_24h_concentration']) > 0 ):?>(<?php echo $med['on_hold_changes'][$med['id']]['dosage_24h_concentration'];?>)<?php endif;?> <?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage']) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?>
			 				<?php else:?>
			 				
			 				<?php endif;?>
							 -->
			 				
			 				<?php if($medication_type != "treatment_care"):?>
								<b><?php echo $this->translate('medication_indication');?></b>: <?php echo $med['on_hold_changes'][$med['id']]['indication'];?>   |
							<?php endif;?>
							  
							<b><?php echo $this->translate('medication_prescribed_by');?></b> <?php echo $med['on_hold_changes'][$med['id']]['prescribed_by'];?>   | 
							<b><?php echo $this->translate('medication_created_by');?></b>  <?php echo $med['on_hold_changes'][$med['id']]['created_by'];?>   
		
							<?php if(($medication_type=="actual" && $allow_normal_scheduled == "1") ):?>
								<b><?php echo $this->translate('medication_days_interval');?></b> <?php echo $med['on_hold_changes'][$med['id']]['days_interval'];?>   | 
								<b><?php echo $this->translate('medication_administration_date');?></b> <?php echo $med['on_hold_changes'][$med['id']]['administration_date'];?>   | 
							
							<?php elseif($medication_type == "scheduled" ):?>
								<b><?php echo $this->translate('medication_days_interval');?></b> <?php echo $med['on_hold_changes'][$med['id']]['days_interval'];?>   | 
								<b><?php echo $this->translate('medication_administration_date');?></b> <?php echo $med['on_hold_changes'][$med['id']]['administration_date'];?>   | 
							  
						 	<?php endif;?>
			 			</div>
		 			</div>
					<?php endif;?>
					
	
                    <?php if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) : ?>
                    <!-- offline changes moderate isschmerzpumpe-->               
                    <?php           
                    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes ) : 
						
                        $ack_referance_txt = "";
                        $ack_referance_del = "";
                        switch($on_hold_changes['status']) {
                            case 'delete' :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>';
                                $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>';
                            break;
				 	
                            case 'new' :
                                $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>';
                                $ack_referance_del = '';
                            break;
				 			 		
                            case 'edit' :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved Edit changes: ").'</span>';
                                $ack_referance_del = '';
                            break;

                            default :
                                $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>';
                                $ack_referance_del = '';
                            break;
						}
		 		 
						if($this->approval_rights == "1")
						{
                            $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Decline").'</button>';
                            $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Approve").'</button>';
                            $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes['alt_id'].'">'.$this->translate("Offline Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
                    <div class="ack_div ack_information_offline_<?php echo $med['id'];?>">
				 		<div class="ack_inner_div">
                            <?php echo $ack_referance_txt;?>
					 		<div class=" ack_buttons">
					 			<?php echo $approve; ?>
								<?php echo $deny; ?>
					 		</div>
				 		</div>
						<div class="ack_inner_div">
                            <?php echo $ack_referance_del;?> 
                            <b><?php echo $this->translate('medication_change_date');?></b>: <?php echo $on_hold_changes['medication_change_date'];?>  | 
                            <b><?php echo $this->translate('medication_name');?></b>: <?php echo $on_hold_changes['name'];?>  |
                            <? if( strlen($on_hold_changes['drug'])  > 0) :?> 
                                <b><?php echo $this->translate('medication_drug');?></b>: <?php echo $on_hold_changes['drug'];?>  | 
							<?php endif;?>
				 		
                            <?php if ($this->show_new_fileds == "1") : ?>
                                <?php if( strlen($on_hold_changes['unit'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_unit');?></b>: <?php echo $on_hold_changes['unit'];?> | 
								<?php endif;?>
							 
                                <?php if( strlen($on_hold_changes['type'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_type');?></b>: <?php echo $on_hold_changes['type'];?> | 
								<?php endif;?>
							 
                                <?php if( strlen($on_hold_changes['dosage_form'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_dosage_form');?></b>: <?php echo $on_hold_changes['dosage_form'];?> | 
								<?php endif;?>
							 
                                <?php if( strlen($on_hold_changes['concentration'])  > 0) :?> 
                                    <b><?php echo $this->translate('medication_concentration');?></b>: <?php echo $on_hold_changes['concentration'];?> | 
								<?php endif;?>
							<?php endif;?>
					
							<!--  MEDICATION DOSAGE INPUTS-->
							
							
                            <b><?php echo $this->translate('medication_dosage_h');?></b>: <?php echo $on_hold_changes['dosage'];?>
                            <?php if(strlen($on_hold_changes['dosage_concentration']) > 0 ):?>(<?php echo $on_hold_changes['dosage_concentration'];?>)<?php endif;?>
                            <?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes['dosage']) > 0):?> <?php echo $on_hold_changes['unit'];?><?php endif;?>
                            <b><?php echo $this->translate('medication_dosage_24h');?></b>: <?php echo $on_hold_changes['dosage_24h'];?>
                            <?php if(strlen($on_hold_changes['dosage_24h_concentration']) > 0 ):?>(<?php echo $on_hold_changes['dosage_24h_concentration'];?>)<?php endif;?>
                            <?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes['dosage']) > 0):?> <?php echo $on_hold_changes['unit'];?><?php endif;?>
							
                            <b><?php echo $this->translate('medication_indication');?></b>: <?php echo $on_hold_changes['indication'];?>   |
							  
                            <b><?php echo $this->translate('medication_prescribed_by');?></b> <?php echo $on_hold_changes['prescribed_by'];?>   | 
                            <b><?php echo $this->translate('medication_created_by');?></b>  <?php echo $on_hold_changes['created_by'];?>   
			 			</div>
		 			</div>
                    
                    <?php endforeach;?>
                    <!-- end offline changes moderate isschmerzpumpe-->   
					<?php endif;?>
					
			 	<?php endforeach;?>
	
		
		<?php endforeach;?>
	<?php endif;?>
</div>

<!--################################ -->
<!-- END MEDICAL ACKNOWLEDGE  -->
<!--################################ -->		
<?php endforeach;?>

<div id="deleted_medication_list">

</div>

<div class="medication_history">
	
	<div class="history_content" >
	
	</div>
</div>


<div class="medication_shared_meds">
	
	<div class="shared_meds_content" >
	
	</div>
</div>


<div class="print_block" >
<label>
<?php echo $this->translate("print_medication_plan:"); ?>
</label>
<select name="pdf_layout" id="select_pdf">
	<option value="0"></option>
	<option value="medicationplan"><?php echo $this->translate("pdf_medicationplan")?></option>
	<option value="medicationplanpatient"><?php echo $this->translate("pdf_patient_medicationplan")?></option>
	<option value="medicationplanpatient_active_substance"><?php echo $this->translate("pdf_patient_medicationplan") ." ". $this->translate("medication_drug") ?></option>
	<option value="medicationplanpatient_bedarfsmedication"><?php echo $this->translate("pdf_patient_bedarfsmedication") ?></option>
	<option value="medicationplanpatient_applikation"><?php echo $this->translate("pdf_patient_applikation") ?></option>
	<option value="medicationplanpatient_datamatrix"><?php echo $this->translate("pdf_patient_datamatrix") ?></option>	
</select>
 <input  type="submit" id="print_button"  name="print_action" value="<?php echo $this->translate('print')?>"  class="btnsubmit_usersessions"/>
 
 <?php  if($this->pharmacyorder) : ?>
	<input type="button" class="button" value="Apotheken Bestellung" onclick="location.href='<?php echo APP_BASE; ?>patient/pharmacyorder?id=<?php echo $_REQUEST["id"]; ?>'" />
 <?php  endif; ?>
 	<br/>
	<?php 
		//recipe request button
		if ($this->reciperequest_privileges) {
			echo $this->formButton('reciperequest', $this->translate('reciperequest_button'), array("type"=>"button" ,"class"=>"button", "onclick"=>"window.location.href=String(window.appbase + 'patientnew/reciperequest?id=' + window.idpd)"));
		} 

		//import medication from datamatrix xml
		echo $this->formButton('reciperequest', $this->translate('datamatrix_import_button'), array("type"=>"button" ,"class"=>"button", "onclick"=>"$.fn.datamatrixImport()"));
	?>
	
<!-- TODO-2508 ISPC: Lore 19.08.2019 -->
<?php if($this->pharmacyprivileges) : ?>
	<input type="button" class="button" value="BTM Buch" name="btmbuch" id="btmbuch" onclick="location.href='<?php echo APP_BASE; ?>patient/btmbuch?id=<?php echo $_REQUEST['id']; ?>'" />
<?php endif; ?>
	
<!-- 
 <button name="print_action"  type="submit" class="medication_edit_button"><?php echo $this->translate("generatepdf")?></button>
 -->
 </div>
</form>

<!-- datamatrix import dialog -->
<?php
	$datamatrix_lang = $this->translate('datamatrix_lang');
?>
<div class="modal" id="datamatix_dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display:none">

	<?php if($this->ModulePrivileges[189] == true):?>
    <!-- ISPC-2346 Added by Ancuta  18.06.2019 START: -->

       <div id="noCam" style="display: none">
            <div class="s-info"><?php echo $this->translate('No camera available'); ?></div>
        </div>
			
        <div id="div-video-container">
            <video class="dbrScanner-video" playsinline="true"></video>
        </div>
    <!-- End-->
    <?php endif;?>    

	<div class="row inprogresss" data-step="inprogress" data-title="<?php echo $this->escape($datamatrix_lang['step_in_progress_title']);?>">
		<?php echo $this->escape($datamatrix_lang['step_in_progress_infotext']);?>
	</div>
	<div class="row errors" data-step="errors" data-title="<?php echo $this->escape($datamatrix_lang['step_errors_title']);?>">
		<?php echo $this->escape($datamatrix_lang['step_errors_infotext']);?>
	</div>
	
	<div class="row hide first_step" data-step="1" data-title="<?php echo $this->escape($datamatrix_lang['step1_title']);?>">
		
		<div class="datamatrix_xml_div">
			<label>
				<?php echo $this->escape($datamatrix_lang['step1_label']);?>
				<textarea class='datamatrix_xml' style="width:99%; height: 300px;  "></textarea>
			</label> 
			
			<div class='infotext'>
				<?php echo $this->escape($datamatrix_lang['step1_infotext']);?>
			</div>
		</div>
		
	</div>
	
	<div class="row hide second" data-step="2" data-title="<?php echo $this->escape($datamatrix_lang['step2_title']);?>">
		 
		<form id="datamatrixSelected" name="datamatrixSelected" method="post">
			<div class="medication_html_grid"></div>
		</form>
		
		<div class='infotext'>
			<?php echo $this->escape($datamatrix_lang['step2_infotext']);?>
		</div>
	</div>
	
	<div class="row hide" data-step="3" data-title="<?php echo $this->escape($datamatrix_lang['step3_title']);?>">		
		<div class='infotext'>
			<?php echo $this->escape($datamatrix_lang['step3_infotext']);?>
		</div>
	</div>
	
</div>
<!-- eo datamatrix import dialog -->

<div id="MedicSet">
	<div class="sets_content" >

</div>
</div>

<div class="medication_sets">
	
	<div class="medication_sets_content" >
	
	</div>
</div>