<?php
use Mpdf\Writer\ResourceWriter;

/*
	//this page is loaded with a ajax request, so in order for the js files to included, the Obi-Wan Kenobi way must be used
*/


$page_lang = $this->translate('pharma_request');

$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen.jquery.min.js');
$this->headLink()->appendStylesheet(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen_2016.09.22.css');


	$allowed_medication_types = $this->medication_blocks; 
	$medication_array = $this->medication;
	$client_medication_extra = $this->client_medication_extra;
	$allow_normal_scheduled = $this->allow_normal_scheduled;

	$request_info = $this->request_data;
	
// for ISPC-2247 changes were made to this page (Ancuta 06.11.2018)
// for ISPC-2430 Carmen 27.11.2019 added data-medication_type to isschmerzpumpe, isscheduled and treatmentcare table
?>
<style>
<?php if($this->show_mmi == "1"):?>

	input[type="text"].livesearchmedinp_fixedwidth {
/* 		width:120px !important; */
	}

<?php else: ?>


<?php endif; ?>

.dosage_firstrow_div,
.dosage_secondrow_div {
    position: relative;
}

.over_the_input {
    position: absolute;
    top: 12px;
    right: 2px;
    z-index: 2;
    float: right;
    color: #696969;
}

/* TODO-3401 - CRISTI C*/
.mk-container.mk-edit table.medikation input[type="text"]:read-only {
    background-color:#e8e8e8;
}


</style>
<script type="text/javascript">
	//ISPC-2829 Ancuta 18.03.2021
	var efaoption= "<?php echo $this->efaoption; ?>";
	//
	
	// Define all needed variables
	// ISPC-2329 pct.b
	var current_doctor = <?php echo $this->verordnetvon ?>;
	var jsusers = <?php echo $this->jsusers ?>;
	var js_unit = <?php echo $this->js_med_unit ?>;
	var js_dosage_form = <?php echo $this->js_med_dosage_form ?>;
	var js_dosage_form_custom = <?php echo $this->js_med_dosage_form_custom ?>;
	var js_type = <?php echo $this->js_med_type ?>;
	var js_type_custom = <?php echo $this->js_med_type_custom ?>;
	var js_indication = <?php echo $this->js_med_indication ?>;
	var js_dosage_intervals = <?php echo $this->js_dosage_intervals ?>;
	var healthinsuranceik = "<?php echo $this->kassen_no; ?>";
	var client = '<?php echo $this->clientid ?>';	
	var new_fields = '<?php echo $this->show_new_fileds ?>';	
	var max_pumpe = 5;	
	var number_of_pumps_def = "<?php echo count($this->cocktail_array);?>";
	var number_of_pumps = number_of_pumps_def;
		
	//ISPC-2833 Ancuta 01.03.2021		
	var max_ispumpe_pumpe = 5;	
	var number_of_ispumpe_pumps_def = "<?php echo count($this->perfusor_pumpe_data_array);?>";
	var number_of_ispumpe_pumps = number_of_ispumpe_pumps_def;
	//-- 
	
		
	var timed_bocks = '<?php echo $this->js_timed_scheduled_medications; ?>';	

	var allow_normal_scheduled =  "<?php echo $this->allow_normal_scheduled; ?>";
	

	var individual_medication_time = "<?php echo $this->individual_medication_time; ?>";
	var show_mmi = "<?php echo $this->show_mmi; ?>";
	
	var elsa_planned_medis = "<?php echo $this->elsa_planned_medis; ?>";//ISPC-2797 Ancuta 18.02.2021
	
	var allow_changes = "<?php echo $this->allow_changes;?>";
	var approval_rights = "<?php echo $this->approval_rights;?>";
	var acknowledge = "<?php echo $this->acknowledge;?>";
	
	var client_pumpe_autocalculus = <?=($this->ModulePrivileges[163] == true) ? 1 : 0;?>;//module 163

	var show_dosage_unit = <?=($this->ModulePrivileges[240] == true) ? 1 : 0;?>;  //module 240	ISPC-2684 Lore 05.10.2020
	
	var js_packaging_array = <?php echo $this->js_packaging_array ?>;
	
	
	var js_escalation = <?php echo $this->js_med_escalation ?>;
	
    var module_lysocare = <?=($this->ModulePrivileges[182] == true) ? 1 : 0;?>;//module 182

    var pat = "<?php echo $_REQUEST['id'];?>";
    
	//ISPC-2554 pct.1 Carmen 03.04.2020
    var js_dosageform_mmi = <?php echo $this->js_med_dosageform_mmi ?>;
    var js_clientdosageform = <?php echo $this->js_clientdosageform ?>;
    var js_clientunit = <?php echo $this->js_clientunit ?>;
	//Carmen 17.06.2020
    var module_takinghint = <?=($this->ModulePrivileges[230] == true) ? 1 : 0;?>;//module 230
    //--

    var allow_medication_comunication_ii = "<?php echo $this->allow_medication_comunication_ii;?>"; //added by Carmen 06.05.2020 for ISPC-2507
	//TODO-3365 Carmen 21.08.2020
    var js_pharmaindex_settings = <?php echo $this->js_pharmaindex_settings ?>;
    //console.log(js_pharmaindex_settings);
    //--
    //ISPC-2664 carmen 30.09.2020
    var module_pediatric_medication = <?=($this->ModulePrivileges[239] == true) ? 1 : 0;?>;//module 239
    var patientweight = "<?php echo $this->patientweight;?>";  
    //--
      
    
$('.indication_color_select').chosen({
	//placeholder_text_single: "<?php echo $this->translate('please select'); ?>",
	multiple:0,
	//width:'250px',// TODO-2762 Ancuta 19.12.2019
	//"search_contains": true, //TODO-3242 Carmen 03.07.2020
	//disable_search: true,//TODO-2858 Ancuta 29.01.2020+commented for TODO-3242 Carmen 03.07.2020
	"enable_split_word_search": false, //TODO-3242 Carmen 03.07.2020
	no_results_text: "<?php echo $this->translate('noresultfound'); ?>"
});


$('.todo_selectbox').chosen({
	placeholder_text_single: translate('please select'),
	placeholder_text_multiple : translate('please select'),
	multiple:1,
	"search_contains": true,
	no_results_text: translate('noresultfound')
});


$('.request_comment').elastic();
$('.deny_textarea_comment').elastic();

//TODO-3401 CRISTI C. 18.11.2020
	
$(document).on('change','.medication_concentration',function(){
	 var attribute = $(this).attr('id');
	    if($(this).val().length > 0 ) {
	    	$(".dosage_secondrow_div [id*="+attribute+"]").removeAttr("readonly");  
	    } else { ($(".dosage_secondrow_div [id*="+attribute+"]").attr("readonly", "true")); }    
});

$('.secondDosajeDiv').each(function(){
	if($(this).val().length > 0) {
		$(this).removeAttr("readonly");
		}
});

//ISCP-3402 CRISTI.C

// $(".mk-container").on("scroll", function(e){
// 	mediAutoFloat();
// });

//--  


</script>
<!-- <form action="<?php  echo APP_BASE.'patientnew/medicationeditblocks?id='.$_REQUEST['id'].''; ?>" method="post" > -->
<?php if($this->individual_medication_time == "0"): ?>
<!--  # NOT individual_medication_time table# -->
<div class="medication_block  mk-container mk-edit"  style="width:100%; align:center; padding-bottom:10px;">
	
	<div class="time_title_master border_bottom" style="padding:10px;">
		<h1><?php echo $this->translate('Patient time scheme for dosage')?></h1>
	</div>

		<table id="not_individual_medication_time" class="medikation medication_edit_table" style="width:auto;  margin: 0 auto;padding:10px;">
					<tr class="time dosage_intervals_holder">		
							<?php $rel = "1"; $int_id = "1";?> 
							<?php foreach($this->interval_array['interval']['all']  as $interval_id => $interval_details):?>

							<th  >					
								<div style="text-align:center;" class="one_dosage_hour <?php if (count($this->interval_array['interval'][$medication_type]) == $int_id) {echo 'one_dosage_hour_last';} ?>	">
									 <span class='errorMessage'><?php echo $this->translate('medication_clock_error_messaje');?></span><!-- TODO-3828 CRISTI C. 09.02.2021 -->
									<input type="text" style="float:left;" rel="time" value="<?php echo $interval_details['time']; ?>"   class="date time_interval_style  int_time_style time_interval_all int_time_all" name="interval[all][<?php echo $int_id;?>][time]" />
									<input type="hidden" rel="custom" value="<?php echo $interval_details['custom']; ?>"  class="custom" name="interval[all][<?php echo $int_id;?>][custom]" />
									
									<?php if( $interval_details['custom'] != "1"):?>
										<input type="hidden" rel="interval_id" value="<?php echo $interval_id; ?>"  class="interval_id" name="interval[all][<?php echo $int_id;?>][interval_id]" />
									<?php endif;?>
									
									<br style="clear:both"/>
									<a href="javascript:void(0)" onclick="add_dosage_intervals_before(this)" style="float:left;" class="btnBlue btnPlus  add_button add_before_btn add_before_all change" rel="<?php echo $rel; ?>" ></a>
									<a style="margin: 0 auto; display:inline-block;" href="javascript:void(0)" onclick="delete_dosage_intervals(this)" class="btnBlue btnDelete delete_interval_button delete_interval_all <?php if(count($this->interval_array['interval'][all]) < 5 ){ echo " hidden_delete ";}?>  ">
									<?php if (count($this->interval_array['interval']['all']) == $int_id) : ?>		
					 					<a href="javascript:void(0)" onclick="add_dosage_intervals_after(this)" style="float:left;" class="btnBlue btnPlus  add_button add_after_all change add_after_button" rel="<?php echo $rel; ?>" > 
										</a>
									<?php endif; ?> 
									</a>
									
								</div>

							</th>
							<?php $rel++; $int_id++; ?>
							<?php endforeach;?>
						
							<!-- 	INPUT FOR DELETED TIME INTERVALS-->
							<input type="hidden" class="deleted_intervals_hidden_input" id="deleted_intervals_all" name="deleted_intervals_ids[all]" value="" />
				 		
				 		
				</tr>
		</table>
</div>
<!--  # end NOT individual_medication_time table# -->
<?php endif; ?>

<?php foreach($allowed_medication_types as $k=>$medication_type):?>
	<?php if($medication_type != "treatment_care" && $medication_type != "isschmerzpumpe" && $medication_type != "ispumpe" && $medication_type != "scheduled"): ?>
	<div class="medication_block mk-container mk-edit">
	
		<div class="mk-top mk-edit-title">
			<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title")?> </h1>
		</div>
		
		<!-- ISPC-2329 pct.j) Carmen 28.08.2019  -->
		<?php if($medication_type == "isbedarfs" && count($this->bedarfsdrop) > 1 && $this->efaoption != "1" ):?>
		<div class="bedarf_sets edit">
				<label>Medikamenten Set hinzufügen</label>
				<?php if( count($this->bedarfsdrop) > 1) :?>					
					<?php echo $this->formSelect('bid', $this->bid, array('onChange'=>'togglebutton(this.value)'), $this->bedarfsdrop) ?>
					<input name="insert_bedarf" type="submit" id="MedicButton" value="<?php echo $this->translate('add'); ?>" disabled="disabled" />
				<?php endif;?>
		</div>
		<?php endif;?>
		
		
		<?php if(($medication_type == "actual" || $medication_type == "isbedarfs" || $medication_type == "iscrisis")  && $this->efaoption != "1"  ):?>
		<div class="bedarf_sets edit">
				<label>Medikamenten Set hinzufügen</label>
				<input name="insert_set" type="button" class="MedicSetButton" value="<?php echo $this->translate('add_set'); ?>"  data-med_block="<?php echo $medication_type; ?> " />			
		</div>
		<?php endif;?>
		<!-- ISPC-2329 pct.j) Carmen 28.08.2019  -->
		
		<table id="<?php echo $medication_type; ?>_med_table" class="medikation medication_edit_table" data-medication_type="<?php echo $medication_type; ?>">
		
		
			<thead>
                <tr>
                    <!-- TH:: SORT -->		 		   
                    <th  rowspan="2" class="name sort"><?php echo $this->translate('medication_importance'); ?></th>
		 		
		 		
		 		    <!-- TH:: Name | Drug | packaging if isintubated -->
    		 		<th rowspan="2"  class="name">
    		 		   <?php echo $this->translate('medication_name');?> / <br/><span><?php echo $this->translate('medication_drug'); ?></span> 
    		 		   <?php if ($medication_type == "isintubated"): ?>/<br/> <?php echo $this->translate('medication_packaging'); ?><?php endif;?>
    		 		</th>
    		 		 
		 			<?php if(in_array($medication_type,$this->timed_scheduled_medications) && $this->individual_medication_time != "0" ):?>
		 		        <!-- TH:: Dosage times per type -->		
		 				<th rowspan="1" colspan="<?php echo count($this->interval_array['interval'][$medication_type]);?>" class="dosage_intervals_holder_header">
		 					<?php echo $this->translate('medication_dosage'); ?>
		 				</th>
		 			<?php elseif(in_array($medication_type,$this->timed_scheduled_medications) && $this->individual_medication_time == "0" ):?>
		 			      <!-- TH:: Dosage times per overall -->
		 				<th rowspan="2" colspan="<?php echo count($this->interval_array['interval'][all]);?>" class="dosage_intervals_holder_header">
		 					<?php echo $this->translate('medication_dosage'); ?>
		 				</th>
		 			<?php else: ?>
		 			    <!-- TH:: Dosage simple -->
		 				<th rowspan="2">
		 					<?php echo $this->translate('medication_dosage'); ?><?=($medication_type == 'isbedarfs' || $medication_type == 'iscrisis') ? ' / ' . $this->translate('Interval for dosage') : ''; ?>    
		 				</th>
		 			<?php endif; ?>
		 			
		 			
					<?php if ($medication_type == "isintubated"): ?>	
						<!-- TH:: Indication | Kcal | Volume | Comment -->
    		 			<th rowspan="2"  ><?php echo $this->translate('medication_indication'); ?> /
    		 			<br/><?php echo $this->translate('medication_kcal'); ?> /
    		 			<br/><?php echo $this->translate('medication_volume'); ?> /
    		 			<br/><?php echo $this->translate('medication_comments'); ?>
    		 			</th>
                    <?php else:?>
                    	<!-- TH:: Indication | Comment -->	 			
                        <th rowspan="2"  ><?php echo $this->translate('medication_indication'); ?> /<br/><?php echo $this->translate('medication_comments'); ?></th>
 					<?php endif;?>
 					
                    <!-- TH:: Prescribed by | Date --> 					
		 			<th rowspan="2" colspan="2"><?php echo $this->translate('medication_prescribed_by'); ?> / <br/><?php echo $this->translate('medication_change_date'); ?></th>
		 		</tr>
		 		
		 		
		 		<?php if($this->individual_medication_time != "0"): ?>
		 		<?php if($this->efaoption != "1" ):?>
		 		<tr class="dosage_intervals_holder time">	
		 			<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>	 					

		 					<?php $rel = 1; $int_id = 1;?> 

		 					<?php foreach($this->interval_array['interval'][$medication_type]  as $interval_id => $interval_details):?>
		 					<!-- TH:: Dosage -time columns (<?php echo $interval_details['time']; ?>) -->
			                 <th>					
								<div class="one_dosage_hour <?php if (count($this->interval_array['interval'][$medication_type]) == $int_id) {echo 'one_dosage_hour_last';} ?>	">
						 			<span class='errorMessage'><?php echo $this->translate('medication_clock_error_messaje'); ?></span><!-- TODO-3828 CRISTI C. 09.02.2021 -->
									<input type="text" style="float:left;" rel="time" value="<?php echo $interval_details['time']; ?>"   class="time_interval_style  int_time_style time_interval_<?php echo $medication_type; ?> int_time_<?php echo $medication_type; ?>" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][time]" />
									<input type="hidden" rel="custom" value="<?php echo $interval_details['custom']; ?>"  class="custom" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][custom]" />

									<?php if( $interval_details['custom'] != "1"):?>
										<input type="hidden" rel="interval_id" value="<?php echo $interval_id; ?>"  class="interval_id" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][interval_id]" />
									<?php endif;?>
									
									<!-- Dosage buttons  Start-->
									<br style="clear:both"/>
									<a href="javascript:void(0)" onclick="add_dosage_intervals_before(this)"    class="btnBlue btnPlus add_button add_before_btn add_before_<?php echo $medication_type ?> change" rel="<?php echo $rel; ?>" ></a>
									<a href="javascript:void(0)" onclick="delete_dosage_intervals(this)"        class="btnBlue btnDelete delete_interval_button delete_interval_<?php echo $medication_type; ?> <?php if(count($this->interval_array['interval'][$medication_type]) < 5 ){ echo " hidden_delete ";}?>  "></a>
									<?php if (count($this->interval_array['interval'][$medication_type]) == $int_id) : ?>		
					 					<a href="javascript:void(0)" onclick="add_dosage_intervals_after(this)" class="btnBlue btnPlus  add_button add_after_<?php echo $medication_type ?> change add_after_button" rel="<?php echo $rel; ?>" ></a>
									<?php endif; ?> 
									<!-- Dosage buttons  END-->
									
									
								</div>

							</th>
							
							<?php $rel++; $int_id++; ?>
							<?php endforeach; ?>
					
		 					<!-- 	INPUT FOR DELETED TIME INTERVALS-->
							<input type="hidden" class="deleted_intervals_hidden_input" id="deleted_intervals_<?php echo $medication_type; ?>" name="deleted_intervals_ids[<?php echo $medication_type; ?>]" value="" />
				 			
		 			<?php endif; ?>
		 			
		 		</tr>
		 		<?php else:?>
    		 		<tr class="dosage_intervals_holder time">	
    		 			<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>	 					
    
    		 					<?php $rel = 1; $int_id = 1;?> 
    
    		 					<?php foreach($this->interval_array['interval'][$medication_type]  as $interval_id => $interval_details):?>
    		 					<!-- TH:: Dosage -time columns (<?php echo $interval_details['time']; ?>) -->
    			                 <th>					
    								<div class="one_dosage_hour <?php if (count($this->interval_array['interval'][$medication_type]) == $int_id) {echo 'one_dosage_hour_last';} ?>	">
    								<?php echo $interval_details['time']; ?>
    						 			<span class='errorMessage'><?php echo $this->translate('medication_clock_error_messaje'); ?></span><!-- TODO-3828 CRISTI C. 09.02.2021 -->
    									<input type="hidden" style="float:left;" rel="time" value="<?php echo $interval_details['time']; ?>"   class="time_interval_style  int_time_style time_interval_<?php echo $medication_type; ?> int_time_<?php echo $medication_type; ?>" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][time]" />
    									<input type="hidden" rel="custom" value="<?php echo $interval_details['custom']; ?>"  class="custom" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][custom]" />
    
    									<?php if( $interval_details['custom'] != "1"):?>
    										<input type="hidden" rel="interval_id" value="<?php echo $interval_id; ?>"  class="interval_id" name="interval[<?php echo $medication_type; ?>][<?php echo $int_id;?>][interval_id]" />
    									<?php endif;?>
    									
    								</div>
    
    							</th>
    							
    							<?php $rel++; $int_id++; ?>
    							<?php endforeach; ?>
    					
    		 					<!-- 	INPUT FOR DELETED TIME INTERVALS-->
    							<input type="hidden" class="deleted_intervals_hidden_input" id="deleted_intervals_<?php echo $medication_type; ?>" name="deleted_intervals_ids[<?php echo $medication_type; ?>]" value="" />
    				 			
    		 			<?php endif; ?>
    		 			
    		 		</tr>
		 		
		 		<?php endif; ?>
		 		
		 		<?php endif; ?>
		 		
		 	</thead>
		 	
		 	
		 	<tbody>
		 		<?php $cnt = 1; foreach($medication_array[$medication_type] as $k =>$med):?>
					<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>"  class="<?php if(!empty($request_info[$med['id']])  ) : ?> has_request expanded<? endif;?> medication_row_<?php echo $med['id']?>  selector_medication_tr_1 single <?= (($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) ? 'has_ack' : '' ?><?php if(!empty($request_info[$med['id']])) : ?> expanded <? endif;?>"  >
					   
					   <!-- TD :: SORT  -->
					   <td class="sortnum">
					       <input type="text"   name="medication_block[<?php echo $medication_type; ?>][importance][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_importance referral change_status sort" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['importance'];?>"  rel="<?php echo $medication_type; ?>" />
						   <input type="hidden" name="medication_block[<?php echo $medication_type; ?>][replace_with][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input replace_with referral sort" value="<?php echo $med['replace_with'];?>"  rel="<?php echo $medication_type; ?>" />
					   </td>
					   
						<!-- TD:: NAME | DRUG | Packaging if intubated -->
						<td class="name">
						    <div class="cn">
    							<!-- Name -->						
    							<? if($medication_type == "isnutrition"):?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp_nutrition med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> referral change_status onchange_reset_pzn name" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    							<?php else:?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> referral change_status livesearchmedinp_fixedwidth onchange_reset_pzn name" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    							<?php endif;?>
    							
    							<?php if($this->show_mmi == "1" && $medication_type != "isnutrition"):?>
    							    <!-- MMI Button -->
    								<input type="button" class="mmi_search_button btnBlue btnMMI" value="<?php echo $this->translate('mmi_button');?>" id="mmi_search_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" name="mmi_search">
    							<?php endif;?>
    							
    			    			<input name="medication_block[<?php echo $medication_type; ?>][hidd_medication][<?php echo $cnt; ?>]" value="<?php echo $med['medication_master_id'];?>" id="hidd_medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" type="hidden">						
    		    				<input type="hidden" id="drid_<?php echo $medication_type; ?>_[<?php echo $cnt; ?>]" name="medication_block[<?php echo $medication_type; ?>][drid][<?php echo $cnt; ?>]" value="<?php echo $med['id'];?>" />
    						    <input type="hidden" id="edited_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][edited][<?php echo $cnt; ?>]" value="0" />
						    </div>
						    
						    
							<!--TD:: DRUG -->
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][drug][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  value="<?php echo $med['drug'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug referral  change_status onchange_reset_pzn" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
							
							<!-- Packaging -->
							<?php if ($medication_type == "isintubated"): ?>
							
								<label><?php echo $this->translate('medication_packaging');?></label>
								<?php 
									echo $this->formSelect(
										"medication_block[{$medication_type}][packaging][{$cnt}]", 
							 			$med['packaging'], 
										array(
											"disable" => array("0"),
											"class" => "packaging_select referral  change_status",
											"rel" => "{$medication_type}",
											"data-medication_type" => "{$medication_type}",
											"title" => "{$medication_type}_{$cnt}"
										),
										$this->packaging_array
									);
								?>	
							
							<?php endif; ?>
							
							
							
			<?php /** hidden inputs neded for the PZN **/ ?>				
			<?php $medication_row = $cnt; ?>
            <?php
				$field_name = "medication_block[{$medication_type}][{$medication_row}][pzn]";
				$field_value = $med['MedicationMaster']['pzn'];
				$attr = array("id" => "{$medication_type}_medication_pzn-{$medication_row}", "class" => "medication_pzn");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				$field_name = "medication_block[{$medication_type}][{$medication_row}][source]";
				$field_value = $med['MedicationMaster']['source'];
				$attr = array("id" => "{$medication_type}_medication_source-{$medication_row}", "class" => "medication_source");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				$field_name = "medication_block[{$medication_type}][{$medication_row}][dbf_id]";
				$field_value = $med['MedicationMaster']['dbf_id'];
				$attr = array("id" => "{$medication_type}_medication_dbf_id-{$medication_row}", "class" => "medication_dbf_id");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				//ISPC-2554 pct.3 Carmen 27.03.2020
				$field_name = "medication_block[{$medication_type}][{$medication_row}][atc]";
				$field_value = $med['MedicationMaster']['atc'];
				$attr = array("id" => "{$medication_type}_medication_atc-{$medication_row}", "class" => "medication_atc");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
						</td>
							
						

						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
						    <!-- TD:: Dosage inputs-->
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
									<td>
									<div class="dosage_firstrow_div">
                                        <input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage][<?php echo $cnt;?>][<?php echo $dosage_time;?>]"  value="<?php echo $med['dosage'][$dosage_time];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="small_dosage_inptuts dosage_input referral  change_status calculate_dosage_concentration cdc_<?php echo $medication_type; ?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-dosage_column_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>"  id="dosage_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>"/>
                                        <span class="over_the_input selector_dosage_text"><?=$client_medication_extra['unit'] [$med['unit_id']]?></span>
									</div>
									<div class="dosage_secondrow_div">
										<?php if ($this->show_new_fileds == "1"):?>
                                            <input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage_concentration][<?php echo $cnt;?>][<?php echo $dosage_time;?>]"  value="<?php echo $med['dosage_concentration'][$dosage_time];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="secondDosajeDiv small_dosage_inptuts dosage_input referral  change_status calculate_dosage" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  data-dosage_column_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"   rel="<?php echo $medication_type; ?>" id="dosage_concentration_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>" readonly/>
                                            <span class="over_the_input selector_concentration_text"><? 
                                            if( ! empty($client_medication_extra['dosage_form'] [$med['dosage_form_id']]) ){
                                            	echo $client_medication_extra['dosage_form'] [$med['dosage_form_id']];
											} else if( ! empty($client_medication_extra['dosage_form_custom'] [$med['dosage_form_id']]) ){
                                            	echo $client_medication_extra['dosage_form_custom'] [$med['dosage_form_id']];
											} else if( $this->show_mmi == "1" && ! empty($client_medication_extra['dosageform_mmi'] [$med['dosage_form_id']])){
												echo substr($client_medication_extra['dosageform_mmi'] [$med['dosage_form_id']], 0, 3);
											}
											?>
                                            
                                            </span>
										<?php endif;
										?>
									</div>
								</td>
			 				<?php endforeach;?>
						<?php else:?>
							<td class="dosierung">
                                <div class="item">
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage][<?php echo $cnt;?>]"   value="<?php echo $med['dosage'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts dosage_input referral  change_status dosierung" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>"/>
                                </div>
                                
                                
                                <?php if ($medication_type == 'isbedarfs' || $medication_type == 'iscrisis') : ?>
                                <div>
                                <?php
                                    $field_name = "medication_block[{$medication_type}][{$medication_row}][dosage_interval]";
                                    $field_value = $med['dosage_interval'];
                                    $attr = array("id" => "{$medication_type}_dosage_interval-{$medication_row}", "class" => "dosage_interval selector_medication_edited");
                                    echo $this->formText($field_name, $field_value, $attr); 
                                ?>
                                </div>
                                <?php endif; //($medication_type == 'isbedarf' || $medication_type == 'iscrisis') ?>
							</td>
						<?php endif; ?>


						<!-- ##################################### -->
						<!-- TD MEDICATION :: INDICATION / COMMENTS-->
						<td class="ind-comm">
							<!--  MEDICATION INDICATION -->						
    						<div class="indikation">
    							<select name="medication_block[<?php echo $medication_type; ?>][indication][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="indication_color_select referral" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" <?php if(strlen($med['indication_id'])>0 && $med['indication_id'] != "0"):?> style="background: #<?php echo $client_medication_extra['indication'][$med['indication_id']]['color'];?>" <?php endif; ?>   rel="<?php echo $medication_type; ?>">
   								    <option id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#FFFFFF" value="0" style="background: #FFFFFF!important"  >Auswahl</option>
    								<?php foreach($client_medication_extra['indication'] as $indication_id => $indication) :?>
    									<option value="<?php echo $indication_id; ?>"  id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#<?php echo $indication['color'];?>" style="background: #<?php echo $indication['color'];?>"  <?php if($med['indication_id'] == $indication_id):?> selected="selected" <?php endif; ?> ><?php echo $indication['name'];?></option>
    								<?php endforeach; ?>
							     </select>
							</div>
							<?php if ($medication_type == "isintubated"): ?>
							  
								<!-- MEDICATION kcal --><!-- TODO-3828 CRISTI C. 09.02.2021 -->
								<div class="kcalContainer"> 
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][kcal][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  value="<?php echo $med['kcal'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug referral  change_status onchange_reset_pzn" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    								<i class="kcalSize"><?php echo $this->translate('medication_kcal'); ?></i>	
								</div>		
								<!-- MEDICATION volume --><!-- TODO-3828 CRISTI C. 09.02.2021 -->
								<div class="volumeContainer"> 
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][volume][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  value="<?php echo $med['volume'];?>"   data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug referral  change_status onchange_reset_pzn" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    								<i class="volumeSize"><?php echo $this->translate('medication_volume'); ?></i>		
								</div>
							<?php endif; ?>
							
							
							
							
							<!--  MEDICATION COMMENTS-->
							<textarea name="medication_block[<?php echo $medication_type; ?>][comments][<?php echo $cnt;?>]"  id="comments_<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-medication_type="<?php echo $medication_type; ?>"  class="med_com_textarea referral  change_status editcomment" placeholder="Kommentar" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rows="" cols=""  rel="<?php echo $medication_type; ?>" ><?php echo $med['comments'];?></textarea>
						</td>

						<!-- ############################################# -->
						<!-- TD  MEDICATION  VERORDNET VON  / DATUM / SORT -->
						<td>
							<!--  MEDICATION  VERORDNET VON -->
							<select name="medication_block[<?php echo $medication_type; ?>][verordnetvon][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="verordnetvon_select referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
								<?php foreach($this->users as $user_id => $unsername) :?>
									<option value="<?php echo $user_id; ?>" <?php if($med['verordnetvon'] == $user_id):?> selected="selected" <?php endif; ?> ><?php echo $unsername;?></option>
								<?php endforeach; ?>
							</select>
							
							<!--  MEDICATION DATUM  -->
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication_change][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['medication_change']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
							
						</td>
	
						
						<!-- ############################## -->
						<!-- TD MEDICATION :: DELETE -->
						<td   class="delete delete_medication"  rel="<?php echo $med['id'];?>" data-medication_type="<?php echo $medication_type; ?>" > </td>
						<!-- ############################## -->
						<!-- TD MEDICATION :: DETAILS -->
						<!-- 						<td class="details expand_details" <?php echo $row_span?> data-expand_details_id="<?php echo $med['id']?>"></td>
						ISPC-2329 Lore 16.06.2020 -->
						<td class="details expand_details" <?php echo $row_span?> data-expand_details_id="<?php echo $med['id']?>"><button class="expand_details_float" name="btn123"></button></td>
					</tr> 
 
					<!-- child row  -->
					
				<?php if($this->ModulePrivileges[239] == true):?>
				<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>_child"    class="<?php if(!empty($request_info[$med['id']]) ) : ?> has_request <? endif;?>    medication_details_row_<?php echo $med['id']?> hide_details child_row child_row_holder selector_medication_tr_3 expandedItemnew <?=(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) ? 'has_ack' : '' ?>" <?php if(!empty($request_info[$med['id']])) : ?> style="display: table-row;" <? endif;?>>
					<td colspan="2">
					<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
						<table class="medikation_child_row">
						  	<tr class="child_row">
						    	<td style="text-align:right; height: 28px; width: 59px; padding-right: 5px; vertical-align: middle; border: 1px solid #000; border-right:0px;">Dies entspricht</td>
							</tr>
							</table>
							<?php endif; ?>
							<table class="medikation_child_row">
							<tr class="child_row">
								<td class="sortnum"></td>
								<td>Darreichungsform</td>
								<td></td>
							</tr>
							<tr class="child_row">
								<td class="sortnum">Ein/e</td>
								<td> 
                                 <ul class="item">
							        <!--  MEDICATION  DOSAGE FORM -->
                                    <li>
            							 <select name="medication_block[<?php echo $medication_type; ?>][dosage_form][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_dosage_form referral  change_status small_input selector_medication_dosage_form" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
            								<option value="0" >  </option>
            								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
            								<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
            								<optgroup label="<?php echo $this->translate('client dosageform list'); ?>">
            								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
            								<?php endif; ?>
	            								<?php foreach($client_medication_extra['dosage_form'] as $dosage_form_id => $dosage_form) :?>
	            									<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
	            								<?php endforeach; ?>
	            								<?php if(!empty($client_medication_extra['dosage_form_custom'][$med['dosage_form_id']])): ?>
	            									<option value="<?php echo $med['dosage_form_id']; ?>" selected="selected" ><?php echo $client_medication_extra['dosage_form_custom'][$med['dosage_form_id']]?></option>
	            								<?php endif; ?>
	            							<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
	            							<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
	            							</optgroup>
	            							<optgroup label="<?php echo $this->translate('mmi dosageform list'); ?>">
	            								<?php foreach($client_medication_extra['dosageform_mmi'] as $dosage_form_id => $dosage_form) :?>
	            									<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
	            								<?php endforeach; ?>
	            							</optgroup>
	            							<?php endif; ?>
	            							<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->            		 
            							</select>
        							</li>
        							</ul>
								</td>
								<td class="dosageaftertext">des Präparats entspricht</td>
							</tr>
							</table>
							</td>
							<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
								<td class="expandedItemnew_second_column" colspan="<?php echo (count($this->dosage_intervals[$medication_type]) + 4) ?>">
									<table class="medikation_child_row first_row_child">
										<tr class="child_row">
											<td style="width: 60%;">
												<table>
													<tr class="dosageperkg">
														<?php foreach($med['dosageperkg'] as $k => $doskg):?>
															<td style="border: 1px solid #000; height: 28px; text-align: center; width: 106px; vertical-align: middle;"><span class="doskg"><?php echo $doskg; ?></span>&nbsp;<span class="selector_dsp_text"><?php echo $client_medication_extra['unit'][$med['unit_id']]?></span>/kg</td>									
														<?php endforeach; ?>
													</tr>
												</table>
											</td>
											<td style="width: 40%;">
												<table style="width: 100%;">
													<tr class="child_row cumulativ">
														<td style="border: 1px solid #000; height: 28px; text-align: center; vertical-align: middle;">
															<!-- kumulativ:&nbsp;<font style="font-weight: bold;"><span><?php echo $med['dosagetotal']; ?></span></font>&nbsp;absolut.bzw&nbsp;<font style="font-weight: bold;"><b><?php echo $med['dosageperkgtotal']; ?></b>&nbsp;pro&nbsp;kg</font>/Körpergewicht&nbsp;über&nbsp;<font style="font-weight: bold;">24 Stunden</font>
															ISPC-2664 Lore 21.10.2020 -->
															kumulativ:&nbsp;<font style="font-weight: bold;"><span><?php echo $med['dosagetotal']; ?></span>&nbsp;<span class="selector_dsp_text"><?php echo $client_medication_extra['unit'][$med['unit_id']];?></span></font>&nbsp;absolut.bzw&nbsp;<font style="font-weight: bold;"><b><?php echo $med['dosageperkgtotal']; ?></b>&nbsp;<span class="selector_dsp_text"><?php echo $client_medication_extra['unit'][$med['unit_id']];?></span>&nbsp;pro&nbsp;kg</font>/Körpergewicht&nbsp;über&nbsp;<font style="font-weight: bold;">24 Stunden</font>
														</td>
													</tr>
												</table>
											</td>
										</tr>
									</table>
									<table class="medikation_child_row">
							<?php else: ?>
								<td colspan="5">
									<table class="medikation_child_row">
							<?php endif; ?>
										<tr class="child_row">
											<td> Konzentration</td>
											<td>Einheit</td>
											<td></td>
											<td>Applikationsweg</td>
											<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis" || $medication_type == "actual"):?><!-- TODO-3247 Carmen 03.07.2020 -->
												<td>Eskalation</td>
											<?php endif; ?>
											<td></td>									
										</tr>
										<tr class="child_row">
											<td style="vertical-align: top;">
												<ul class="item">
				        							<!--  MEDICATION  CONCENTRATION  -->
												    <li>						
												        <input type="text" name="medication_block[<?php echo $medication_type; ?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration referral change_status concentration_calculation" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>"   id="concentration_<?php echo $medication_type; ?>_<?php echo $cnt;?>"   />
												    </li>
											    </ul>
											</td>
										
											<td style="vertical-align: top;">
												<ul class="item">
													<!--  MEDICATION  UNIT -->
				        							<li>
				        								<select name="medication_block[<?php echo $medication_type; ?>][unit][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_unit referral  change_status small_input selector_medication_unit" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
            												<option value="0" >  </option>
				            								<?php foreach($client_medication_extra['unit'] as $unit_id => $unit) :?>
				            									<option value="<?php echo $unit_id; ?>" <?php if($med['unit_id'] == $unit_id):?> selected="selected" <?php endif; ?> ><?php echo $unit;?></option>
				            								<?php endforeach; ?>
            											</select>
							         				</li>
							     				</ul>
											</td>
											<td style="width:150px;  vertical-align: top;" >des Wirkstoffs.</td>
								<td style="vertical-align: top;">
								<ul class="item">
								<!--  MEDICATION  TYPE  -->
        							<li>
            							<select name="medication_block[<?php echo $medication_type; ?>][type][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_type referral  change_status small_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
            								<option value="0" >  </option>
            								<?php foreach($client_medication_extra['type'] as $type_id => $type) :?>
            									<option value="<?php echo $type_id; ?>" <?php if($med['type_id'] == $type_id):?> selected="selected" <?php endif; ?> ><?php echo $type;?></option>
            								<?php endforeach; ?>
            								<?php if(!empty($client_medication_extra['type_custom'][$med['type_id']])): ?>
            									<option value="<?php echo $med['type_id']; ?>" selected="selected" ><?php echo $client_medication_extra['type_custom'][$med['type_id']]; ?></option>
            								<?php endif; ?>
            								
            							</select>
        							</li>
        						</ul>
								</td>
								<td style="vertical-align: top;">
									<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis" || $medication_type == "actual"):?><!-- TODO-3247 Carmen 03.07.2020 -->
							  			 <ul class="item">
							  				 <li>
			        							<select name="medication_block[<?php echo $medication_type; ?>][escalation][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_escalation referral  change_status small_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
			        								<option value="0" >  </option>
			        								<?php foreach($client_medication_extra['escalation'] as $esk_id => $escalation_label) :?>
			        									<option value="<?php echo  $esk_id; ?>" <?php if($med['escalation'] == $esk_id):?> selected="selected" <?php endif; ?> ><?php echo $escalation_label;?></option>
			        								<?php endforeach; ?>
			        							</select>
							    			 </li>
							    			</ul>
							    	<?php endif; ?>
								</td>
								<td style="vertical-align: top;">
								<ul class="item">
        							<?php if(($medication_type == "actual" || $medication_type == "isivmed") && $allow_normal_scheduled == "1"):?>
            							<li>
            								<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][has_interval][<?php echo $cnt;?>]" value="1" class="has_interval" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>" <?php if($med['has_interval'] == "1"):?> checked="checked" <?php endif; ?> /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("is interval medi?")?></label>
            							</li>
                                        <li class="interval_block <?php if($med['has_interval'] != '1'):?> has_no_interval <?php endif; ?>"  id="int_set_<?php echo $medication_type; ?>_<?php echo $cnt;?>">
                                            <ul class="item">
                    							<li>
                        							<span><?php echo $this->translate('medication_days_interval');?>:</span>						
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][days_interval][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_days_interval referral change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['days_interval'];?>"  rel="<?php echo $medication_type; ?>" />
                                                </li>
                                                <li>            
                        							<span><?php echo $this->translate('medication_administration_date');?>:</span>						
                        							<?php if($med['administration_date'] != "0000-00-00 00:00:00"):?>
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['administration_date']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
                        							<? else:?>
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value=""  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
                        							<?php endif;?>
                    							</li>                    							
                							</ul>
                						</li>                                    
        							<?php endif; ?>
    							     <!-- ISPC-2524 pct.2)  Lore 15.01.2020-->
         							 <?php if($medication_type == "actual" && $this->move_medication == '1'):?> 
            							<li>
            								<input type="checkbox" style="display:inline-block;" name="medication_block[<?php echo $medication_type; ?>][move_actual_to_bedarf][<?php echo $cnt;?>]" value="1" class="change_actual_vs_bedarf" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("move_medi_actual_to_bedarf")?></label>
            							</li>                                       
        							<?php endif; ?>
        							<!-- /. --> 
        							<!-- ISPC-2524 pct.2)  Lore 15.01.2020-->
     							 <?php if($medication_type == "isbedarfs" && $this->move_medication == '1'):?> 
        							<li>
        								<input type="checkbox" style="display:inline-block;" name="medication_block[<?php echo $medication_type; ?>][move_bedarf_to_actual][<?php echo $cnt;?>]" value="1" class="change_bedarf_vs_actual" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("move_medi_bedarf_to_actual")?></label>
        							</li>                                       
								<?php endif; ?>
							     <!-- /. -->
							     <!-- ISPC-2507 Lore 31.01.2020  + ANcuta-->
	   							<?php if($this->allow_medication_comunication_i == '10' && $this->is_pharma_user == "1"):?>	
	        						<li>
										<input name="medi_communic_set" type="button" class="MediCommButton" value=""  data-med_details=" " data-med_id="<?php echo $med['id'];?>"  data-med_block="<?php echo $medication_type; ?> " data-medcount="<?php echo $cnt; ?>" data-request_id="<?php echo $this->pending_request_id?>" />			
								   </li>
								<?php endif;?>
								<!-- /. -->
							     <!-- ISPC-2507 Ancuta 19.02.2020 -->
							 <?php if($medication_type == "isnutrition"): ?>
							 		<li>&nbsp;
							 		</li>
							 <?php endif; ?>   
							 
				 
							 
							 
							 
   							<?php if($this->allow_medication_comunication_ii == '1'  ):?>
                            <!--TODO-3462 Ancuta 19.10.2020 -->
   							<li style="width: 450px;">
   							<div class="pharma_outer_new">
        						<div class="pharma_request_checkbox" >
        							<?php if(!empty($request_info[$med['id']]) && $this->is_pharma_user != 1 ):?>
	    								<input type="checkbox" value="1" style="display:inline-block;" checked="checked" disabled="disabled"  readonly="readonly" class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("Request change for this medication?")?></label>
	    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1"  />
        							<?php elseif($this->is_pharma_user=='1'):?>
        							
        								<?php $has_Reques = "";?>
        								<?php if(!empty($request_info[$med['id']])) : ?>
        									<?php $has_Reques = 'checked="checked"   readonly="readonly"';?>
	    									 <input type="hidden" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1"  />
	    								    <input type="checkbox" style="display:inline-block;" value="1"  checked="checked" disabled="disabled"  readonly="readonly" class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("Request change for this medication?")?></label>
	    									
        								<?php else:?>
    									<input type="checkbox" style="display:inline-block;" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1" <?php echo $has_Reques; ?>  class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label style="display:inline-block; padding-left: 5px;"><?php echo $this->translate("Request change for this medication?")?></label>
        								<?php endif;?>	
    								<?php endif;?>
    								
    								
    								<?php if( $this->is_assigned_doctor_user == '1'):?>
    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][pharma_med_type][<?php echo $cnt;?>]" value="approved_state" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  />
    								<?php else:?>
    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][pharma_med_type][<?php echo $cnt;?>]" value="requested_state" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  />
    								<?php endif;?>
    						    </div>
    						    <?php
    						    $req_block_class= !empty($request_info[$med['id']]) ? "" :"hide_pharma_req";
    						    ?>
    						    <div class="pharma_request_block <?php echo $req_block_class;?>  req_block_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" >
    						    	<fieldset>
    						    		<legend><?php echo $this->translate('Pharma request:');?></legend>
    						    		<div class="pharme_request_line">
    						    			<label><?php echo $this->translate('Grund der Empfehlung ');?>:</label>
    						    			<?php if( $this->is_pharma_user == '1'):?>
											<?php 
											
                        						echo $this->formSelect(
                        							"medication_block[{$medication_type}][request_reason][{$cnt}][]", 
                        							$request_info[$med['id']]['request_data']['request_reason_arr'], 
                        							array(
                        								"class" => "todo_selectbox reasonarr",
                        							    "style"=>'width:100%;',
                        								"multiple" => true,
                        								"size" => 1,
                        								"disable" => array("0")
                        							),
                        							$this->reasons_arr
                        						);
					                        ?>	
					                        <?php else :?>
					                        	<span class="assigned_doctor_req_info"><?php echo !empty($request_info[$med['id']]['request_data']['request_reason_text']) ? $request_info[$med['id']]['request_data']['request_reason_text'] : ""; ?></span>
					                        <?php endif;?>
    						    			
    						    			
    						    		</div>
    						    		
    						    		<div class="pharme_request_line">
    						    			<label><?php echo $this->translate('Kommentar der Apotheke  ');?>:</label>
    						    			<?php if( $this->is_pharma_user !='1' ):?>
    						    				<span class="assigned_doctor_req_info"><?php echo nl2br($request_info[$med['id']]['request_data']['request_comment']); ?></span>
    						    			<?php else: ?>
    						    			<textarea name="medication_block[<?php echo $medication_type; ?>][request_comment][<?php echo $cnt;?>]"   <?php if($this->is_assigned_doctor_user == '1'):?> disabled="disabled"<?php endif;?> id="request_comment_<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-medication_type="<?php echo $medication_type; ?>"  class="request_comment rerqq_<?php echo $med['id']?>" placeholder="<?php echo $this->translate('Kommentar der Apotheke  ');?>" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rows="" cols=""  rel="<?php echo $medication_type; ?>" ><?php echo $request_info[$med['id']]['request_data']['request_comment']?></textarea>
    						    			<?php endif;?>
    						    		</div>
    						    		<?php if( $this->is_assigned_doctor_user=='1' ):?>
    						    		
        						    		<div class="pharme_request_line">
        						    			<input type="radio"  name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]"    value="fully_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                                				<label><b><?php echo   $page_lang['agree_with_change']?></b></label>
        								    </div>
        								    
        						    		<div class="pharme_request_line">
    											<input type="radio" name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]" value="partially_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                            					<label><b><?php echo   $page_lang['partly agree_with_change']?></b></label>    						    		
        								    </div>
        						    		<div class="pharme_request_line">
    											<input type="radio" name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]" value="dont_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                            					<label><b><?php echo   $page_lang['dont agree_with_change']?></b>
    						    				<textarea name="medication_block[<?php echo $medication_type; ?>][status_comment][<?php echo $cnt;?>]" class="editcomment deny_textarea_comment deny_comment_drug_request<?php echo $cnt; ?>"  placeholder="Kommentar" style="display: none"></textarea>
        								    </div>
        								                                                <!-- extra info -->

<!--        								                                                 
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][request_id]" value="<?php echo $request_data['id']  ?>">
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][original_line_id]" value="<?php echo $requests['original']['id']  ?>">
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][requested_line_id]" value="<?php echo $requests['requested']['id']  ?>">
-->
    									<?php endif;?>
    						    	</fieldset>
    						    </div>
						    </div>
						    </li>
							<?php endif;?>				
							
							
							        							
<!--         							ISPC-2797 Ancuta 17.02.2021 -->
        							<?php if($this->elsa_planned_medis == 1):?>

<?php if(!empty($med['planned']['action'] == 'add'))://If has action and it is add - block is disabled and  - it is not allowed  edite?>
					<li class="planned_style_li planned_add">
						<input type="checkbox" checked="checked" disabled="disabled" />
						<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action]" value="add" class="plan2delete_medi" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>" />
						<label style="display:inline-block; padding-left: 5px;">
							<?php echo $this->translate("Medi is set to start in future")?>
						</label>
					
                    <div class="" id="plan2delete_medi_options_<?php echo $medication_type; ?>_<?php echo $cnt;?>">
                        <ul class="item">
                            <li style="width:100%; float: left; display: block;">            
    							<span><?php echo $this->translate('medication_planned_start_date_date');?>:</span>						
    							<?php
    							if(isset($med['planned']['action_date'])):?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action_date]"  value="<?php echo date('d.m.Y',strtotime($med['planned']['action_date']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="future_planned_date referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
    							<?php else: ?>
	    							<input type="text" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action_date]"  value=""  data-medication_type="<?php echo $medication_type; ?>"  class="future_planned_date referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
    							<?php endif;?>
							</li>                    							
						</ul>
					</div>    
					</li>    


<?php else://if has action and it is removed - checkbox is checked  - and date is set < it can be edited  OR allow to add ?>
 
					<li class="planned_style_li <?php if($med['planned']['action'] == 'remove'):?> planned_remove <?php endif; ?>">
						<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action]" value="remove" class="plan2delete_medi" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>" <?php if($med['planned']['action'] == 'remove'):?> checked="checked" <?php endif; ?> />
						<label style="display:inline-block; padding-left: 5px;">
							<?php echo $this->translate("plan to delete medi  in future?")?>
						</label>
					
					
                    <div class="  <?php if($med['planned']['action'] != 'remove'):?> has_no_plan  <?php endif; ?>" id="plan2delete_medi_options_<?php echo $medication_type; ?>_<?php echo $cnt;?>">
                        <ul class="item">
                            <li style="width:100%; float: left; display: block;">            
    							<span><?php echo $this->translate('medication_planned_removed_date_date');?>:</span>						
    							<?php
    							if(isset($med['planned']['action_date'])):?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action_date]"  value="<?php echo date('d.m.Y',strtotime($med['planned']['action_date']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="future_planned_date referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
    							<?php else: ?>
	    							<input type="text" name="medication_block[<?php echo $medication_type; ?>][planned][<?php echo $cnt;?>][action_date]"  value=""  data-medication_type="<?php echo $medication_type; ?>"  class="future_planned_date referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
    							<?php endif;?>
							</li>                    							
						</ul>
					</div>                                    
					</li>                                    

<?php endif;?> 
        							<?php endif; ?>
<!--         							ISPC-2797 Ancuta 17.02.2021 END -->
										
							</ul>
							<!-- /. --> 
						</td>
					</tr>
				</table>
			</td>
			</tr>
			<?php else: ?>
			<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>_child"    class="<?php if(!empty($request_info[$med['id']]) ) : ?> has_request <? endif;?>    medication_details_row_<?php echo $med['id']?> hide_details child_row child_row_holder selector_medication_tr_3 expandedItem <?=(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) ? 'has_ack' : '' ?>" <?php if(!empty($request_info[$med['id']])) : ?> style="display: table-row;" <? endif;?>>
				<!-- ############################## -->
						<!-- TD  MEDICATION :: UNIT / TYPE / DOSAGE FORM / CONCENTRATION -->
						<td class="border_bottom_solid"
							<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
							 colspan="<?php echo (count($this->dosage_intervals[$medication_type]) + 6) ?>">
							<?php else : ?>
								colspan="7" >
							<?php endif; ?>
								      <h3>
								<?php echo $this->translate('medication_type'); ?>,
								<?php echo $this->translate('medication_dosageform'); ?>,
								<?php echo $this->translate('medication_unit'); ?>,
						      </h3>
							
							<div class="ei-content">
                                <ul class="item">
        							<!--  MEDICATION  CONCENTRATION  -->
								    <li>
								        <span><?php echo $this->translate('medication_concentration');?>:</span>						
								        <input style="width:85px" type="text" name="medication_block[<?php echo $medication_type; ?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration referral change_status concentration_calculation" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>"   id="concentration_<?php echo $medication_type; ?>_<?php echo $cnt;?>"   />
								    </li>
							
							         <!--  MEDICATION  UNIT -->
							         <li>
							             <span><?php echo $this->translate('medication_unit');?>:</span>
            							<select name="medication_block[<?php echo $medication_type; ?>][unit][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_unit referral  change_status small_input selector_medication_unit" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
            								<option value="0" >  </option>
            								<?php foreach($client_medication_extra['unit'] as $unit_id => $unit) :?>
            									<option value="<?php echo $unit_id; ?>" <?php if($med['unit_id'] == $unit_id):?> selected="selected" <?php endif; ?> ><?php echo $unit;?></option>
            								<?php endforeach; ?>
            							</select>
							         </li>
							     </ul>
 
                                 <ul class="item">
							        <!--  MEDICATION  DOSAGE FORM -->
                                    <li>
    							         <span><?php echo $this->translate('medication_dosageform');?>:</span>
            							 <select name="medication_block[<?php echo $medication_type; ?>][dosage_form][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_dosage_form referral  change_status small_input selector_medication_dosage_form" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
            								<option value="0" >  </option>
            								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
            								<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
            								<optgroup label="<?php echo $this->translate('client dosageform list'); ?>">
            								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
            								<?php endif; ?>
	            								<?php foreach($client_medication_extra['dosage_form'] as $dosage_form_id => $dosage_form) :?>
	            									<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
	            								<?php endforeach; ?>
	            								<?php if(!empty($client_medication_extra['dosage_form_custom'][$med['dosage_form_id']])): ?>
	            									<option value="<?php echo $med['dosage_form_id']; ?>" selected="selected" ><?php echo $client_medication_extra['dosage_form_custom'][$med['dosage_form_id']]?></option>
	            								<?php endif; ?>
	            							<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
	            							<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
	            							</optgroup>
	            							<optgroup label="<?php echo $this->translate('mmi dosageform list'); ?>">
	            								<?php foreach($client_medication_extra['dosageform_mmi'] as $dosage_form_id => $dosage_form) :?>
	            									<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
	            								<?php endforeach; ?>
	            							</optgroup>
	            							<?php endif; ?>
	            							<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->            		 
            							</select>
        							</li>
        							
                                    <!--  MEDICATION  TYPE  -->
        							<li>
            							<span><?php echo $this->translate('medication_type');?>:</span>
            							<select name="medication_block[<?php echo $medication_type; ?>][type][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_type referral  change_status small_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
            								<option value="0" >  </option>
            								<?php foreach($client_medication_extra['type'] as $type_id => $type) :?>
            									<option value="<?php echo $type_id; ?>" <?php if($med['type_id'] == $type_id):?> selected="selected" <?php endif; ?> ><?php echo $type;?></option>
            								<?php endforeach; ?>
            								<?php if(!empty($client_medication_extra['type_custom'][$med['type_id']])): ?>
            									<option value="<?php echo $med['type_id']; ?>" selected="selected" ><?php echo $client_medication_extra['type_custom'][$med['type_id']]; ?></option>
            								<?php endif; ?>
            								
            							</select>
        							</li>
        						</ul>
        							
        							
                                 <ul class="item">
        							<?php if(($medication_type == "actual" || $medication_type == "isivmed") && $allow_normal_scheduled == "1"):?>
            							<li>
            								<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][has_interval][<?php echo $cnt;?>]" value="1" class="has_interval" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>" <?php if($med['has_interval'] == "1"):?> checked="checked" <?php endif; ?> /><label><?php echo $this->translate("is interval medi?")?></label>
            							</li>
                                        <li class="interval_block <?php if($med['has_interval'] != '1'):?> has_no_interval <?php endif; ?>"  id="int_set_<?php echo $medication_type; ?>_<?php echo $cnt;?>">
                                            <ul class="item">
                    							<li>
                        							<span><?php echo $this->translate('medication_days_interval');?>:</span>						
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][days_interval][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_days_interval referral change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['days_interval'];?>"  rel="<?php echo $medication_type; ?>" />
                                                </li>
                                                <li>            
                        							<span><?php echo $this->translate('medication_administration_date');?>:</span>						
                        							<?php if($med['administration_date'] != "0000-00-00 00:00:00"):?>
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['administration_date']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
                        							<? else:?>
                        							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value=""  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
                        							<?php endif;?>
                    							</li>                    							
                							</ul>
                                        </li>
                                     
        							<?php endif; ?>
        							
    							     <!-- ISPC-2524 pct.2)  Lore 15.01.2020-->
         							 <?php if($medication_type == "actual" && $this->move_medication == '1'):?> 
            							<li>
            								<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][move_actual_to_bedarf][<?php echo $cnt;?>]" value="1" class="change_actual_vs_bedarf" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label><?php echo $this->translate("move_medi_actual_to_bedarf")?></label>
            							</li>                                       
        							<?php endif; ?>
        							<!-- /. -->   
							     </ul>
							
							
							<?php if($medication_type == "isbedarfs" || $medication_type == "iscrisis" || $medication_type == "actual"):?><!-- TODO-3247 Carmen 03.07.2020 -->
							   <ul class="item">
							   <li>
        							<span><?php echo $this->translate('medication_escalation');?>:</span>
        							<select name="medication_block[<?php echo $medication_type; ?>][escalation][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_escalation referral  change_status small_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
        								<option value="0" >  </option>
        								<?php foreach($client_medication_extra['escalation'] as $esk_id => $escalation_label) :?>
        									<option value="<?php echo  $esk_id; ?>" <?php if($med['escalation'] == $esk_id):?> selected="selected" <?php endif; ?> ><?php echo $escalation_label;?></option>
        								<?php endforeach; ?>
        							</select>
							     </li>
							     <!-- ISPC-2524 pct.2)  Lore 15.01.2020-->
     							 <?php if($medication_type == "isbedarfs" && $this->move_medication == '1'):?> 
        							<li>
        								<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][move_bedarf_to_actual][<?php echo $cnt;?>]" value="1" class="change_bedarf_vs_actual" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label><?php echo $this->translate("move_medi_bedarf_to_actual")?></label>
        							</li>                                       
								<?php endif; ?>
							     <!-- /. -->							     
							</ul>
							<?php endif; ?>
							
   							<!-- ISPC-2507 Lore 31.01.2020  + ANcuta-->
   							<?php if($this->allow_medication_comunication_i == '10' && $this->is_pharma_user == "1"):?>
    						<ul class="item">	
        						<li>
									<input name="medi_communic_set" type="button" class="MediCommButton" value=""  data-med_details=" " data-med_id="<?php echo $med['id'];?>"  data-med_block="<?php echo $medication_type; ?> " data-medcount="<?php echo $cnt; ?>" data-request_id="<?php echo $this->pending_request_id?>" />			
							   </li>							   
						    </ul>
							<?php endif;?>
							<!-- /. --> 				
							
							
   							<!-- ISPC-2507 Ancuta 19.02.2020 -->
   							<?php if($this->allow_medication_comunication_ii == '1'  ):?>
   							
   							<div class="pharma_outer">
        						<div class="pharma_request_checkbox" >
        							<?php if(!empty($request_info[$med['id']]) && $this->is_pharma_user != 1 ):?>
	    								<input type="checkbox" value="1"  checked="checked" disabled="disabled"  readonly="readonly" class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label><?php echo $this->translate("Request change for this medication?")?></label>
	    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1"  />
        							<?php elseif($this->is_pharma_user=='1'):?>
        							
        								<?php $has_Reques = "";?>
        								<?php if(!empty($request_info[$med['id']])) : ?>
        									<?php $has_Reques = 'checked="checked"   readonly="readonly"';?>
	    									 <input type="hidden" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1"  />
	    								    <input type="checkbox" value="1"  checked="checked" disabled="disabled"  readonly="readonly" class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label><?php echo $this->translate("Request change for this medication?")?></label>
	    									
        								<?php else:?>
    									<input type="checkbox" name="medication_block[<?php echo $medication_type; ?>][has_request_change][<?php echo $cnt;?>]" value="1" <?php echo $has_Reques; ?>  class="pharma_request_change" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  /><label><?php echo $this->translate("Request change for this medication?")?></label>
        								<?php endif;?>	
    								<?php endif;?>
    								
    								
    								<?php if( $this->is_assigned_doctor_user == '1'):?>
    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][pharma_med_type][<?php echo $cnt;?>]" value="approved_state" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  />
    								<?php else:?>
    								<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][pharma_med_type][<?php echo $cnt;?>]" value="requested_state" data-medication_type="<?php echo $medication_type; ?>" data-medcount="<?php echo $cnt; ?>"  />
    								<?php endif;?>
    						    </div>
    						    <?php
    						    $req_block_class= !empty($request_info[$med['id']]) ? "" :"hide_pharma_req";
    						    ?>
    						    <div class="pharma_request_block <?php echo $req_block_class;?>  req_block_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" >
    						    	<fieldset>
    						    		<legend><?php echo $this->translate('Pharma request:');?></legend>
    						    		<div class="pharme_request_line">
    						    			<label><?php echo $this->translate('Grund der Empfehlung ');?>:</label>
    						    			<?php if( $this->is_pharma_user == '1'):?>
											<?php 
											
                        						echo $this->formSelect(
                        							"medication_block[{$medication_type}][request_reason][{$cnt}][]", 
                        							$request_info[$med['id']]['request_data']['request_reason_arr'], 
                        							array(
                        								"class" => "todo_selectbox reasonarr",
                        							    "style"=>'width:100%;',
                        								"multiple" => true,
                        								"size" => 1,
                        								"disable" => array("0")
                        							),
                        							$this->reasons_arr
                        						);
					                        ?>	
					                        <?php else :?>
					                        	<span class="assigned_doctor_req_info"><?php echo !empty($request_info[$med['id']]['request_data']['request_reason_text']) ? $request_info[$med['id']]['request_data']['request_reason_text'] : ""; ?></span>
					                        <?php endif;?>
    						    			
    						    			
    						    		</div>
    						    		
    						    		<div class="pharme_request_line">
    						    			<label><?php echo $this->translate('Kommentar der Apotheke  ');?>:</label>
    						    			<?php if( $this->is_pharma_user !='1' ):?>
    						    				<span class="assigned_doctor_req_info"><?php echo nl2br($request_info[$med['id']]['request_data']['request_comment']); ?></span>
    						    			<?php else: ?>
    						    			<textarea name="medication_block[<?php echo $medication_type; ?>][request_comment][<?php echo $cnt;?>]"   <?php if($this->is_assigned_doctor_user == '1'):?> disabled="disabled"<?php endif;?> id="request_comment_<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-medication_type="<?php echo $medication_type; ?>"  class="request_comment rerqq_<?php echo $med['id']?>" placeholder="<?php echo $this->translate('Kommentar der Apotheke  ');?>" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rows="" cols=""  rel="<?php echo $medication_type; ?>" ><?php echo $request_info[$med['id']]['request_data']['request_comment']?></textarea>
    						    			<?php endif;?>
    						    		</div>
    						    		<?php if( $this->is_assigned_doctor_user=='1' ):?>
    						    		
        						    		<div class="pharme_request_line">
        						    			<input type="radio"  name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]"    value="fully_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                                				<label><b><?php echo   $page_lang['agree_with_change']?></b></label>
        								    </div>
        								    
        						    		<div class="pharme_request_line">
    											<input type="radio" name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]" value="partially_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                            					<label><b><?php echo   $page_lang['partly agree_with_change']?></b></label>    						    		
        								    </div>
        						    		<div class="pharme_request_line">
    											<input type="radio" name="medication_block[<?php echo $medication_type; ?>][status][<?php echo $cnt;?>]" value="dont_agree"  class="req_status_radio"  data-show_comment="deny_comment_drug_request<?php echo $cnt; ?>">
                            					<label><b><?php echo   $page_lang['dont agree_with_change']?></b>
    						    				<textarea name="medication_block[<?php echo $medication_type; ?>][status_comment][<?php echo $cnt;?>]" class="editcomment deny_textarea_comment deny_comment_drug_request<?php echo $cnt; ?>"  placeholder="Kommentar" style="display: none"></textarea>
        								    </div>
        								                                                <!-- extra info -->

<!--        								                                                 
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][request_id]" value="<?php echo $request_data['id']  ?>">
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][original_line_id]" value="<?php echo $requests['original']['id']  ?>">
                            					<input type="hidden" name="request_data[<?php echo $patient_drugplan_id;?>][requested_line_id]" value="<?php echo $requests['requested']['id']  ?>">
-->
    									<?php endif;?>
    						    	</fieldset>
    						    </div>
						    </div>
							<?php endif;?>
							<!-- /. --> 
							
							</div>
							
							
							     							
						</td>
						
						<td class="border_bottom_solid">
						</td>
						</tr>
			<?php endif;?>							
 
					
					
	<!-- 		ISPC-2797 Ancuta 17.02.2021 START -->
			<?php if($this->elsa_planned_medis == 1 && !empty($med['planned'])):?>
    			<?php if($med['planned']['action'] == 'add'):?>
    			<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>_elsa_child"  >
    				<td colspan="2" class="planned-extra first">
    					<span class="type">ANSETZEN AM</span>
    				</td>
    				<td colspan="10" class="planned-extra last">
    					<span><b>START:</b> <?php echo $med['planned']['date']; ?></span>					
    				</td>
    			</tr>
    			<?php elseif($med['planned']['action'] == 'remove'):?>
    			<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>_elsa_child"  >
    				<td colspan="2" class="planned-extra red first">
    					<span class="type">ABSETZEN AM</span>
    				</td>
    				<td colspan="10" class="planned-extra red last">
    					<span><b>STOP:</b> <?php echo $med['planned']['date']; ?></span>					
    				</td>
    			</tr>
    			<?php endif;?>
			<?php endif;?>
<!-- 		ISPC-2797 Ancuta 17.02.2021 END -->			
					
			 	<?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))) :?>
				<?php 
						$ack_referance_txt = array();
                        $ack_referance_del = array();

						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						} 
						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						{
							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
			 	
					<tr class="ack_info_tr single acknowlege_row edit_acknowlege_row extedned_ack ack_medication_row_<?php echo $med['id']?> " data-ack_id="tr<?php echo $medication_type;?><?php echo $cnt;?>"   id="ack_<?php echo $med['id'];?>" rel="<?php echo $medication_type;?><?php echo $cnt;?>" >
						
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['importance'];?> </span>
							</div>
						</td>	
						<!--  MEDICATION NAME -->
						<td class="name">
						    <div class="ackn_ref"><?php echo $ack_referance_txt[$med['id']]; ?></div>
						    <?php echo $ack_referance_del[$med['id']]; ?>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo html_entity_decode($med['on_hold_changes'][$med['id']]['name']);?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo html_entity_decode($med['on_hold_changes'][$med['id']]['drug']);?></span>
								<?php if( $medication_type == "isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['packaging_name'];?></span>
								<?php endif;?>
							</div>
						</td>
						
						<!--  MEDICATION DOSAGE INPUTS-->
						<!-- TD  MEDICATION :: DOSAGE INPUTS-->
						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
							<td>
								<div class="mifo">
									<span class="lb dosage_label"><?php echo $dosage_time; ?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?></span>
									<span class="vl"><?php if ($this->show_new_fileds == "1" && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?><?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time];?><?php endif;?></span>
								</div>
							</td>
		 				<?php endforeach;?>
		 				
						<? else:?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage');?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage']; ?></span>
								</div>
                                <?php if ($medication_type == 'isbedarfs' || $medication_type == 'iscrisis') : ?>
                                <div class="mifo">
                                    <span class="lb dosage_label"><?=$this->translate('Interval for dosage');?></span>
                                    <span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage_interval']; ?></span>
                                </div>
                                <?php endif; //($medication_type == 'isbedarf || $medication_type == 'iscrisis') ?>
                                
							</td>
						<?php endif; ?>
						
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['on_hold_changes'][$med['id']]['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['on_hold_changes'][$med['id']]['indication_color'];?>"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span> 
								<?php endif;?>
								
								<?php if ($medication_type == "isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_kcal'); ?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['kcal'];?></span>
									
									<span class="lb"><?php echo $this->translate('medication_volume'); ?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['volume'];?></span>
									
								<?php endif;?>
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['comments'];?></span>
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?></span>
							</div>
						</td>
						
						
						<!-- TD MEDICATION :: DETAILS -->
						<td></td>
						<td class="details ack_expand_details"   data-expand_details_id="<?php echo $med['id']?>"></td>
						
					</tr>
								
					<!--ack child row  -->
					<tr id="ack_tr<?php echo $medication_type;?><?php echo $cnt;?>_child" class="hide_details ack_medication_details_row_<?php echo $med['id']?> ack_info_tr child_row child_row_holder tr_ack_back expandedItem"> 					
						<!--  MEDICATION UNIT / TYPE -->
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td  
							<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
								colspan="<?php echo (count($this->dosage_intervals[$medication_type]) + 6) ?>" >
							<?php else : ?>
								colspan="7" >
							<?php endif; ?>
							
							<h3>
							<?php echo $this->translate('medication_type'); ?>,
							<?php echo $this->translate('medication_dosageform'); ?>,
							<?php echo $this->translate('medication_unit'); ?>,
							etc
							</h3>
							
								<div class="ei-content">
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_concentration'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['concentration'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_unit'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['unit'];?></span>
									 </li>
                                </ul>
                                
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_dosageform'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['dosage_form'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_type'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['type'];?></span>
									 </li>
                                </ul>
                                <?php if(($medication_type == "actual" || $medication_type == "isivmed") && $allow_normal_scheduled == "1"):?>
                                <?php if($med['on_hold_changes'][$med['id']]['has_interval'] =="1" ): ?>
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_days_interval'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['days_interval'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_administration_date'); ?></span>
                                        <span><?php echo $med['on_hold_changes'][$med['id']]['administration_date'];?></span>
									 </li>
                                </ul>
                                
                                <?php endif;?>
                                
                                <?php endif;?>
                                
                                </div>
							
			 
						</td>
 
					</tr>
				<?php endif;?>
                
<?php 
if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) :
    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes_offline) : 
?>
<!-- start offline changes -->
<?php
$ack_referance_txt = '';
$ack_referance_del = '';

switch ($on_hold_changes_offline['status']) {

    case 'delete':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
        $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>'; 
    break;
    
    case 'new':
        $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>'; 
    break;
    
    case 'edit':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
    break;

    default:
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Renew changes: ").'</span>'; 
        $ack_referance_del = ''; 
    break;


    
}
//approve buttons are not displayed in the edit page
/*
if($this->approval_rights == "1") {
    $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
    $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button>';
    $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
} else {
    $app_rights =
    $approve =
    $deny = '';
}
*/
?>
<!--  ##########################  -->
					<tr class="ack_info_tr single acknowlege_row edit_acknowlege_row extedned_ack offline_ack_medication_row_<?php echo $med['id']?> " data-ack_id="tr<?php echo $medication_type;?><?php echo $cnt;?>"   id="ack_<?php echo $med['id'];?>" rel="<?php echo $medication_type;?><?php echo $cnt;?>" >
						
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['importance'];?> </span>
							</div>
						</td>	
						<!--  MEDICATION NAME -->
						<td class="name">
						    <div class="ackn_ref"><?php echo $ack_referance_txt; ?></div>
						    <?php echo $ack_referance_del; ?>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo html_entity_decode($on_hold_changes_offline['name']);?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo html_entity_decode($on_hold_changes_offline['drug']);?></span>
								<?php if( $medication_type == "isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['packaging_name'];?></span>
								<?php endif;?>
							</div>
						</td>
						
						<!--  MEDICATION DOSAGE INPUTS-->
						<!-- TD  MEDICATION :: DOSAGE INPUTS-->
						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
							<td>
								<div class="mifo">
									<span class="lb dosage_label"><?php echo $dosage_time; ?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes_offline['dosage'][$dosage_time]) > 0):?> <?php echo $on_hold_changes_offline['unit'];?><?php endif;?></span>
									<span class="vl"><?php if ($this->show_new_fileds == "1" && strlen($on_hold_changes_offline['dosage'][$dosage_time]) > 0):?><?php echo $on_hold_changes_offline['dosage_concentration'][$dosage_time];?><?php endif;?></span>
								</div>
							</td>
		 				<?php endforeach;?>
		 				
						<? else:?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage');?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['dosage']; ?></span>
								</div>
                                <?php if ($medication_type == 'isbedarfs' || $medication_type == 'iscrisis') : ?>
                                <div class="mifo">
                                    <span class="lb dosage_label"><?=$this->translate('Interval for dosage');?></span>
                                    <span class="vl"><?php echo $on_hold_changes_offline['dosage_interval']; ?></span>
                                </div>
                                <?php endif; //($medication_type == 'isbedarf || $medication_type == 'iscrisis') ?>
                                
							</td>
						<?php endif; ?>
						
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($on_hold_changes_offline['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $on_hold_changes_offline['indication_color'];?>"><?php echo $on_hold_changes_offline['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $on_hold_changes_offline['indication'];?></span> 
								<?php endif;?>
								
								<?php if ($medication_type == "isintubated"):?>
									<span class="lb"><?php echo $this->translate('medication_kcal'); ?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['kcal'];?></span>
									
									<span class="lb"><?php echo $this->translate('medication_volume'); ?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['volume'];?></span>
									
								<?php endif;?>
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $on_hold_changes_offline['comments'];?></span>
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['medication_change_date'];?></span>
							</div>
						</td>
						
						
						<!-- TD MEDICATION :: DETAILS -->
						<td></td>
						<td class="details offline_ack_expand_details"   data-expand_details_id="<?php echo $med['id']?>"></td>
						
					</tr>
								
					<!--ack child row  -->
					<tr id="ack_tr<?php echo $medication_type;?><?php echo $cnt;?>_child" class="hide_details offline_ack_medication_details_row_<?php echo $med['id']?> ack_info_tr child_row child_row_holder tr_ack_back expandedItem"> 					
						<!--  MEDICATION UNIT / TYPE -->
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td  
							<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
								colspan="<?php echo (count($this->dosage_intervals[$medication_type]) + 6) ?>" >
							<?php else : ?>
								colspan="7" >
							<?php endif; ?>
							
							<h3>
							<?php echo $this->translate('medication_type'); ?>,
							<?php echo $this->translate('medication_dosageform'); ?>,
							<?php echo $this->translate('medication_unit'); ?>,
							etc
							</h3>
							
								<div class="ei-content">
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_concentration'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['concentration'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_unit'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['unit'];?></span>
									 </li>
                                </ul>
                                
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_dosageform'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['dosage_form'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_type'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['type'];?></span>
									 </li>
                                </ul>
                                <?php if(($medication_type == "actual" || $medication_type == "isivmed") && $allow_normal_scheduled == "1"):?>
                                <?php if($on_hold_changes_offline['has_interval'] =="1" ): ?>
                                <ul class="item">
                                    <li>
                                        <span><?php echo $this->translate('medication_days_interval'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['days_interval'];?></span>
									 </li>
									 
                                    <li>
                                        <span><?php echo $this->translate('medication_administration_date'); ?></span>
                                        <span><?php echo $on_hold_changes_offline['administration_date'];?></span>
									 </li>
                                </ul>
                                
                                <?php endif;?>
                                
                                <?php endif;?>
                                
                                </div>
							
			 
						</td>
 
					</tr>

<!--  ##########################  -->

<?php endforeach;?>
<!-- end offline changes -->
<?php endif;?>
                
                
                <?php if(module_pediatric_medication) :?>
                	<tr class="separator child_row">
                <?php else: ?>
					<tr class="separator">
				<?php endif; ?>
				<td colspan="9"> </td>
			</tr>
					
		 		<?php $cnt++; endforeach;?>
		 </table>
		 
	 
		
		<input type="hidden" value="<?php echo $cnt;?>" id="new_line_<?php echo $medication_type;?>"> 
		<a  href="javascript:void(0)"  rel="<?php echo $medication_type?>" class="add_button_link medication_add_link"><?php echo $this->translate($medication_type." medication add")?></a>
	</div>
	
	<?php elseif($medication_type == "isschmerzpumpe"):?>
	
	<div class="medication_block  mk-container mk-edit" id="blocks_isschmerzpumpe" style="margin-bottom: 0px!important;">
		<?php if (empty($medication_array[$medication_type]) && in_array($medication_type,$allowed_medication_types)):?>
			<div class="pumpeblock" id="empty_pumpe_block">
				<div class="med_block_header mk-top  mk-edit-title empty_header">
					<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title ")?></h1>
				</div>
			</div>
			
		<?php else: ?>
			<?php $pumpe_cnt = 1; foreach($medication_array[$medication_type] as $pumpe_id =>$med_pumpe):?>
			<?php 
			$cocktail_details=""; 
			$cocktail_details_alt=""; 
		$schmerz[$pumpe_id] = end($medication_array[$medication_type][$pumpe_id]);
		$cocktail_details = $schmerz[$pumpe_id]['smpdescription'];
		$cocktail_details_alt = $schmerz[$pumpe_id]['smpdescription_alt'];
        $cocktail_details_alt_offline = $schmerz[$pumpe_id]['smpdescription_alt_offline']; // this is multi
		?>
			<div class="pumpeblock" id="pumpeblock<?php echo $pumpe_cnt;?>">
				<div class="med_block_header mk-top  mk-edit-title <?php if(strlen($cocktail_details['pumpe_type'])> 0 && $pumpe_cnt > 1):?> inner<?php endif;?>">
					<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title ".$cocktail_details['pumpe_type'])?></h1>
				</div>
		
			
				<table id="<?php echo $medication_type; ?>_pumpeblock<?php echo $pumpe_cnt; ?>" class="medikation medication_edit_table" data-medication_type="<?php echo $medication_type; ?>">
					<thead>
				 		<tr>
				 		    <th class="name sort"><?php echo $this->translate('medication_importance'); ?></th>
				 			<th class="name"><?php echo $this->translate('medication_name');?> /  <span><?php echo $this->translate('medication_drug'); ?></span></th>
		
			 				<th class="name"><?php echo $this->translate('medication_unit'); ?> /  <span><?php echo $this->translate('medication_concentration'); ?></span></th>

			 				<?php if($cocktail_details['pumpe_type'] == "pump"):?>
			 					<th class="doseirung"><?php echo $this->translate('medication_dosage24h'); ?></th>
			 				<?php else: ?>
			 					<th class="doseirung"><?php echo $this->translate('medication_dosage_h'); ?></th>
			 				<?php endif;?>
				 			<th ><?php echo $this->translate('medication_indication'); ?></th>
				 			<th class="name" colspan="2"><?php echo $this->translate('medication_prescribed_by'); ?> /  <span><?php echo $this->translate('medication_change_date'); ?></span> </th>
				 		</tr>
				 	</thead>
				 	
				 	<tbody>
				 		<?php $cnt = 1; foreach($med_pumpe as $k =>$med):?>
							<tr id="tr<?php echo $medication_type;?><?php echo $pumpe_cnt;?><?php echo $cnt;?>"   
							class=" single
                            <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) :?>  has_ack <?php endif;?>"
                            >
                                <td class="sortnum">
                     				<!--  MEDICATION SORT -->
									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][importance][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_importance sch_referral change_status"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['importance'];?>"  rel="<?php echo $medication_type; ?>" />
									<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][replace_with][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input replace_with referral" value="<?php echo $med['replace_with'];?>"  rel="<?php echo $medication_type; ?>" />
                                </td>
                            
                            
								<!-- ############################## -->
								<!-- TD  MEDICATION :: NAME  / DRUG  -->
								<td class="name" style="width:30% !important;">
                                    <div class="cn">
									<!-- MEDICATION NAME -->						
									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> sch_referral change_status livesearchmedinp_fixedwidth onchange_reset_pzn name"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>							
					    			<input name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][hidd_medication][<?php echo $cnt; ?>]" value="<?php echo $med['medication_master_id'];?>" id="hidd_medication_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt; ?>" type="hidden">
									
									<?php if($this->show_mmi == "1"):?>
										<input type="button" class="mmi_search_button  btnBlue btnMMI" value="<?php echo $this->translate('mmi_button');?>" id="mmi_search_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo $cocktail_details['pumpe_type']?>_<?php echo $pumpe_cnt; ?>" name="mmi_search">
									<?php endif;?>
									
				    				<input type="hidden" id="drid_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][drid][<?php echo $cnt; ?>]" value="<?php echo $med['id'];?>" />
								    <input type="hidden" id="edited_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][edited][<?php echo $cnt; ?>]" value="0" />
		
									<!-- MEDICATION DRUG -->
									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][drug][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt; ?>"  value="<?php echo $med['drug'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug sch_referral  change_status onchange_reset_pzn"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
									</div>
									
            <?php           
				$field_name = "medication_block[{$medication_type}][{$pumpe_cnt}][{$cnt}][pzn]";
				$field_value = $med['MedicationMaster']['pzn'];
				$attr = array("id" => "{$medication_type}_medication_pzn-{$pumpe_cnt}_{$cnt}", "class" => "medication_pzn");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				$field_name = "medication_block[{$medication_type}][{$pumpe_cnt}][{$cnt}][source]";
				$field_value = $med['MedicationMaster']['source'];
				$attr = array("id" => "{$medication_type}_medication_source-{$pumpe_cnt}_{$cnt}", "class" => "medication_source");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				$field_name = "medication_block[{$medication_type}][{$pumpe_cnt}][{$cnt}][dbf_id]";
				$field_value = $med['MedicationMaster']['dbf_id'];
				$attr = array("id" => "{$medication_type}_medication_dbf_id-{$pumpe_cnt}_{$cnt}", "class" => "medication_dbf_id");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			<?php
				//ISPC-2554 pct.3 Carmen 27.03.2020
				$field_name = "medication_block[{$medication_type}][{$pumpe_cnt}][{$cnt}][atc]";
				$field_value = $med['MedicationMaster']['atc'];
				$attr = array("id" => "{$medication_type}_medication_atc-{$pumpe_cnt}_{$cnt}", "class" => "medication_atc");
				echo $this->formHidden($field_name, $field_value, $attr); 
			?>
			
									
								</td>
								
								<!-- ############################## -->
								<!-- TD  MEDICATION :: UNIT / DOSAGE FORM / CONCENTRATION    -->
								<td class="border_bottom_solid" style="width:20% !important;">
									
									<!--  MEDICATION  UNIT -->
									<!-- ISPC-2329 pct.c) -->
									<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][unit][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_unit sch_referral  change_status sh_selector_medication_unit"  data-pumpe_number="<?php echo $pumpe_cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
	<!-- 								<?php $selected_unit="EINHEIT";?>
										<option value="0" >  </option>
    -->										
									<?php $selected_unit="i.E.";?>
										<option value="0" >i.E.</option>										
										<?php foreach($client_medication_extra['unit'] as $unit_id => $unit) :?>
											<option value="<?php echo $unit_id; ?>" <?php if($med['unit_id'] == $unit_id):?> selected="selected" <?php endif; ?> ><?php echo $unit;?></option>
											<?php if($med['unit_id'] == $unit_id):?>
											<?php $selected_unit = $unit;?>
											<?php endif;?>
										<?php endforeach; ?>
									</select>
									
									<!--  MEDICATION  CONCENTRATION  -->
									<!-- ISPC-2329 pct.c)
									   <input type="text" placeholder="<?php echo $this->translate('medication_concentration');?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration sch_referral change_status extra_calculation" data-ec_field="concentration"  id="concentration_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>" />
	                                  --> 
									   <!-- ISPC-2684 Lore 02.10.2020 -->
        						  <?php if($this->ModulePrivileges[240] == true) :?> 
        						  	    <input type="text"  style="width: 55%;" placeholder="<?php echo $selected_unit;?> pro ml" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration sch_referral change_status extra_calculation" data-ec_field="concentration"  id="concentration_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>" />
        						      		<!-- <input type="text" readonly style="width: 36%; background:transparent;border: none;"  value="<?php echo $selected_unit != 'EINHEIT' ? $selected_unit : '';?> pro ml"  id="lbl_concentration_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
        						      		 -->
        						      		 <input type="text" readonly style="width: 36%; background:transparent;border: none;"  value="<?php echo $selected_unit;?> pro ml"  id="lbl_concentration_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
        						  <?php else:?> 
        						  	    <input type="text" placeholder="<?php echo $selected_unit;?> pro ml" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration sch_referral change_status extra_calculation" data-ec_field="concentration"  id="concentration_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>" />
        						  <?php endif;?> 
        						  
								</td>
								<!-- ISPC - 2329 - punctul o - 2 digits dosage view -->
								<!-- ############################## -->
								<!-- TD  MEDICATION :: DOSAGE INPUTS-->
								   <!-- ISPC-2684 Lore 02.10.2020 -->
        						  <?php if($this->ModulePrivileges[240] == true) :?> 
    								<td class="doseirung" style="width: 20%;">
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage_h_ml');?>"      style="width: 74%;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][dosage][<?php echo $cnt;?>]"          value="<?php echo  round($med['dosage'],2) == 0 ?  $med['dosage'] :  $med['dosage']  ;?>"        data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts dosage_input sch_referral  change_status calculate_sh_d24h extra_calculation doseirung"   data-pumpe_med="<?php echo $cnt;?>"  data-ec_field="dosage"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    										<input type="text" readonly style="width: 24%; background:transparent;border: none;"  value="ml/h"  id="lbl_dosage_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage_h_unit');?>"    style="width: 74%;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][unit_dosage][<?php echo $cnt;?>]"     value="<?php echo  $med['unit_dosage'] ;?>"    data-medication_type="<?php echo $medication_type; ?>"  class="unit_dosage sch_referral change_status extra_calculation"           data-pumpe_med="<?php echo $cnt;?>"  data-ec_field="unit_dosage"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_unit_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    										<input type="text" readonly style="width: 24%; background:transparent;border: none;"  value="<?php echo $selected_unit != 'EINHEIT' ? $selected_unit : '';?>/h"  id="lbl_dosage_sh_unit_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage_24h_ml');?>"    style="width: 74%;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][dosage_24h][<?php echo $cnt;?>]"      value="<?php echo $med['dosage_24h'];?>"      data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts medication_dosage24_numeric dosage_input sch_referral change_status calculate_sh_d extra_calculation doseirung"           data-pumpe_med="<?php echo $cnt;?>" data-ec_field="dosage_24h" data-pumpe_number="<?php echo $pumpe_cnt;?>"    data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_24h_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    								    	<input type="text" readonly style="width: 24%; background:transparent;border: none;"  value="ml/24h"  id="lbl_dosage_sh_24h_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage_24h_unit');?>"  style="width: 74%;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][unit_dosage_24h][<?php echo $cnt;?>]" value="<?php echo $med['unit_dosage_24h'];?>" data-medication_type="<?php echo $medication_type; ?>"  class="unit_dosage_24h sch_referral change_status extra_calculation"  data-pumpe_med="<?php echo $cnt;?>" data-ec_field="unit_dosage_24h" data-pumpe_number="<?php echo $pumpe_cnt;?>"    data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_24h_unit_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    								    	<input type="text" readonly style="width: 24%; background:transparent;border: none;"  value="<?php echo $selected_unit != 'EINHEIT' ? $selected_unit : '' ;?>/24h"  id="lbl_dosage_sh_24h_unit_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  />
    								</td>
            					  <?php else:?> 
    								<td class="doseirung">
                                        <!-- TODO-3585 Ancuta 10.11.202 - removed round from $med['dosage'] -->
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage');?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][dosage][<?php echo $cnt;?>]"   value="<?php echo $med['dosage']  ;?>"  data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts dosage_input sch_referral  change_status calculate_sh_d24h extra_calculation doseirung"   data-pumpe_med="<?php echo $cnt;?>"  data-ec_field="dosage"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    									<!-- ISPC-2329 pct.p) Lore 22.08.2019 -->
    									<input type="text" placeholder="<?php echo $this->translate('medication_dosage_24h');?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][dosage_24h][<?php echo $cnt;?>]"   value="<?php echo $med['dosage_24h'];?>" data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts medication_dosage24_numeric dosage_input sch_referral change_status calculate_sh_d extra_calculation doseirung"  data-pumpe_med="<?php echo $cnt;?>" data-ec_field="dosage_24h" data-pumpe_number="<?php echo $pumpe_cnt;?>"    data-row_info="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" id="dosage_sh_24h_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"   />
    								</td>
        						  <?php endif;?> 

		
		
								<!-- ##################################### -->
								<!-- TD MEDICATION :: INDICATION -->
								<td class="ind-comm">
									<!--  MEDICATION INDICATION -->						
									<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][indication][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="indication_color_select sch_referral"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>" <?php if(strlen($med['indication_id'])>0 && $med['indication_id'] != "0"):?> style="background: #<?php echo $client_medication_extra['indication'][$med['indication_id']]['color'];?>" <?php endif; ?>   rel="<?php echo $medication_type; ?>">
										<option id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#FFFFFF" value="0" style="background: #FFFFFF!important"  >Auswahl</option>
										<?php foreach($client_medication_extra['indication'] as $indication_id => $indication) :?>
											<option value="<?php echo $indication_id; ?>"  id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#<?php echo $indication['color'];?>" style="background: #<?php echo $indication['color'];?>"  <?php if($med['indication_id'] == $indication_id):?> selected="selected" <?php endif; ?> ><?php echo $indication['name'];?></option>
										<?php endforeach; ?>
									</select>
								</td>
		
								<!-- ############################################# -->
								<!-- TD  MEDICATION  VERORDNET VON  / DATUM / SORT -->
								<td c >
									<!--  MEDICATION  VERORDNET VON -->
									<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][verordnetvon][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="verordnetvon_select sch_referral  change_status"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
										<?php foreach($this->users as $user_id => $unsername) :?>
											<option value="<?php echo $user_id; ?>" <?php if($med['verordnetvon'] == $user_id):?> selected="selected" <?php endif; ?> ><?php echo $unsername;?></option>
										<?php endforeach; ?>
									</select>
									
									<!--  MEDICATION DATUM  -->
									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][medication_change][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['medication_change']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input sch_referral  change_status"  data-pumpe_number="<?php echo $pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
									

								</td>
		
								<!-- ############################## -->
								<!-- TD MEDICATION :: DELETE -->
								<td   class="delete delete_medication"  rel="<?php echo $med['id'];?>" data-medication_type="<?php echo $medication_type; ?>" > </td>
								
							</tr> 
							
					 	<?php if($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) :?>
						<?php 
						$ack_referance_txt = array();
                        $ack_referance_del = array();

						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						} 
						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						{
							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
							<tr class="ack_info_tr single edit_acknowlege_row acknowlege_row extedned_ack" id="ack_<?php echo $med['id'];?>" >
							<!--  MEDICATION SORT / IMPORTANCE -->
								<td class="sortnum">
									<div class="mifo">
										<span class="lb">&nbsp;</span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['importance'];?> </span>
									</div>
								</td>
							
							
								<!--  MEDICATION NAME -->
								<td>
								    <div class="ackn_ref"><?php echo $ack_referance_txt[$med['id']]; ?></div>
									<div class="mifo">
										<span class="lb"><?php echo $ack_referance_del[$med['id']]; ?><?php echo $this->translate('medication_name');?></span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['name'];?></span>
										<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['drug'];?></span>
										
										
										<?php if ($medication_type == "isintubated"):?>
											<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['packaging_name'];?></span>
										<?php endif;?>
										
									</div>
								</td>
								
								
								<?php if ($this->show_new_fileds == "1"):?>
								
								<!--  MEDICATION UNIT / DOSAGE FORM / CONCENTRATION -->
								<td>
									<div class="mifo">
										<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['unit'];?></span>
										<!-- 	
										<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage_form'];?></span>
										-->
										<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['concentration'];?></span>
									</div>
								</td>
								<?php endif;?>
								<!-- ISPC - 2329 - punctul o - 2 digits dosage view -->
								<!-- TD  MEDICATION :: DOSAGE INPUTS-->
								
								 <!-- ISPC-2684 Lore 02.10.2020 -->
        						  <?php if($this->ModulePrivileges[240] == true) :?> 
        							<td class="border_bottom_solid">
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h_ml');?></span>
											<span class="vl"><?php echo round($med['on_hold_changes'][$med['id']]['dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h_unit');?></span>
											<span class="vl"><?php echo round($med['on_hold_changes'][$med['id']]['unit_dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h_ml');?></span>
											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage_24h']; ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h_unit');?></span>
											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['unit_dosage_24h']; ?></span>
										</div>										
									</td>
        						  <?php else:?> 
									<td class="border_bottom_solid">
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h');?></span>
											<span class="vl"><?php echo round($med['on_hold_changes'][$med['id']]['dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h');?></span>
											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage_24h']; ?></span>
										</div>
									</td>
        						  <?php endif;?> 
        						  								
								<!--  MEDICATION INDICATION / COMMENTS-->
								<td >
									<div class="mifo">
						 				<?php if(strlen($med['on_hold_changes'][$med['id']]['indication_color']) > 0):?>
						 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
											<span class="vl indication_span" style="background: #<?php echo $med['on_hold_changes'][$med['id']]['indication_color'];?>"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span>
										<?php else:?>
											<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span> 
										<?php endif;?>
									</div>
								</td>
								<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
								<td>
									<div class="mifo">
										<span class="lb">&nbsp;</span>
										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?></span>
									</div>
								</td>
                                <td></td>
								
							</tr>
						<?php endif;?>
<?php 
if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) :
    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes_offline) : 
?>
<!-- start offline changes isschmerzpumpe-->
<?php
$ack_referance_txt = '';
$ack_referance_del = '';

switch ($on_hold_changes_offline['status']) {

    case 'delete':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
        $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>'; 
    break;
    
    case 'new':
        $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>'; 
    break;
    
    case 'edit':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
    break;

    default:
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Renew changes: ").'</span>'; 
        $ack_referance_del = ''; 
    break;


    
}
//approve buttons are not displayed in the edit page
/*
if($this->approval_rights == "1") {
    $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
    $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button>';
    $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
} else {
    $app_rights =
    $approve =
    $deny = '';
}
*/
?>          

<!-- ############################### -->
                            <tr class="ack_info_tr single edit_acknowlege_row offline_acknowlege_row extedned_ack" id="ack_<?php echo $med['id'];?>" >
							<!--  MEDICATION SORT / IMPORTANCE -->
								<td class="sortnum">
									<div class="mifo">
										<span class="lb">&nbsp;</span>
										<span class="vl"><?php echo $on_hold_changes_offline['importance'];?> </span>
									</div>
								</td>
							
							
								<!--  MEDICATION NAME -->
								<td>
								    <div class="ackn_ref"><?php echo $ack_referance_txt; ?></div>
									<div class="mifo">
										<span class="lb"><?php echo $ack_referance_del; ?><?php echo $this->translate('medication_name');?></span>
										<span class="vl"><?php echo $on_hold_changes_offline['name'];?></span>
										<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
										<span class="vl"><?php echo $on_hold_changes_offline['drug'];?></span>
										
										
										<?php if ($medication_type == "isintubated"):?>
											<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
											<span class="vl"><?php echo $on_hold_changes_offline['packaging_name'];?></span>
										<?php endif;?>
										
									</div>
								</td>
								
								
								<?php if ($this->show_new_fileds == "1"):?>
								
								<!--  MEDICATION UNIT / DOSAGE FORM / CONCENTRATION -->
								<td>
									<div class="mifo">
										<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
										<span class="vl"><?php echo $on_hold_changes_offline['unit'];?></span>
										<!-- 	
										<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
										<span class="vl"><?php echo $on_hold_changes_offline['dosage_form'];?></span>
										-->
										<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
										<span class="vl"><?php echo $on_hold_changes_offline['concentration'];?></span>
									</div>
								</td>
								<?php endif;?>
								<!-- ISPC - 2329 - punctul o - 2 digits dosage view -->
								<!-- TD  MEDICATION :: DOSAGE INPUTS-->
								    <!-- ISPC-2684 Lore 02.10.2020 -->
        						  <?php if($this->ModulePrivileges[240] == true) :?> 
        							<td class="border_bottom_solid">
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h_ml');?></span>
											<span class="vl"><?php echo round($on_hold_changes_offline['dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h_unit');?></span>
											<span class="vl"><?php echo round($on_hold_changes_offline['unit_dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h');?></span>
											<span class="vl"><?php echo $on_hold_changes_offline['dosage_24h']; ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h_unit');?></span>
											<span class="vl"><?php echo $on_hold_changes_offline['unit_dosage_24h']; ?></span>
										</div>										
									</td>
        						  <?php else:?> 
									<td class="border_bottom_solid">
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_h');?></span>
											<span class="vl"><?php echo round($on_hold_changes_offline['dosage'], 2); ?></span>
										</div>
										<div class="mifo">
											<span class="lb"><?php echo $this->translate('medication_dosage_24h');?></span>
											<span class="vl"><?php echo $on_hold_changes_offline['dosage_24h']; ?></span>
										</div>
									</td>
        						  <?php endif;?> 
																

								
								<!--  MEDICATION INDICATION / COMMENTS-->
								<td >
									<div class="mifo">
						 				<?php if(strlen($on_hold_changes_offline['indication_color']) > 0):?>
						 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
											<span class="vl indication_span" style="background: #<?php echo $on_hold_changes_offline['indication_color'];?>"><?php echo $on_hold_changes_offline['indication'];?></span>
										<?php else:?>
											<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
											<span class="vl"><?php echo $on_hold_changes_offline['indication'];?></span> 
										<?php endif;?>
									</div>
								</td>
								<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
								<td>
									<div class="mifo">
										<span class="lb">&nbsp;</span>
										<span class="vl"><?php echo $on_hold_changes_offline['medication_change_date'];?></span>
									</div>
								</td>
                                <td></td>
								
							</tr>

<!-- ############################### -->
              
<?php endforeach;?>
<!-- end offline changes isschmerzpumpe-->
<?php endif;?>              
                        
            <tr class="separator">
				<td colspan="7"> </td>
			</tr>
    <?php $cnt++; endforeach;?>
    </table>
	 			
	 			<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][id]"  value="<?php echo $cocktail_details['id']?>"/>
	 			<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][pumpe_type]"  value="<?php echo $cocktail_details['pumpe_type']?>"/>
	 			<input type="hidden" value="<?php echo $cnt;?>" id="new_sh_line_<?php echo $medication_type;?>_<?php echo $cocktail_details['pumpe_type'];?>_<?php echo $pumpe_cnt;?>">
	 			
					<a  href="javascript:void(0)" data-pumpe_type="<?php echo $cocktail_details['pumpe_type'];?>" data-pumpe_number="<?php echo $pumpe_cnt;?>" rel="<?php echo $medication_type?>" class="add_button_link medication_schm_add_link">
						<?php echo $this->translate($medication_type." medication add")?>
					</a>
                
                
             <div class="medication_block mk-container mk-edit">
				<table class="medikation datatable_sch 
                <?php if(($this->acknowledge  == "1" && !empty($cocktail_details_alt))  || ($this->ModulePrivileges[155] == true && !empty($cocktail_details_alt_offline)) ) :?> ack_back <?php endif;?>       
                " >
					<tr class="single">
						<td><label><?php echo $this->translate("Kommentar")?></label></td>
						<td>
							<textarea class="xxl_input editcomment" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][description]" ><?php echo $cocktail_details['description']?></textarea>
						</td>
					</tr>		 
					<tr class="single">
						<td width="16%"><label><?php echo $this->translate("medication_type")?></label></td>
						
						<td width="">
							<select class="xxl_input" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][pumpe_medication_type]">
								<option value="">--</option>
								<option <?php if($cocktail_details['pumpe_medication_type'] == "i.v.") {echo " selected ";} ?> value="i.v.">i.v.</option>
								<option <?php if($cocktail_details['pumpe_medication_type'] == "s.c.") {echo " selected ";} ?> value="s.c.">s.c.</option>
								<!-- ISPC-2329 pct M Lore 21.08.2019  -->
								<option <?php if($cocktail_details['pumpe_medication_type'] == "über Port") {echo " selected ";} ?> value="über Port">über Port</option>
							</select>
						</td>
					</tr>	
					<tr class="single">
						 <!-- ISPC-2684 Lore 02.10.2020 -->
        				<?php if($this->ModulePrivileges[240] == true) :?> 
						     <td><label>Flussrate</label></td>
    						 <td><input type="text" style="max-width:50px;"    data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="flussrate" id="flussrate_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][flussrate]" value="<?php echo $cocktail_details['flussrate']?>"/>
    						 	<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][flussrate_type]" style="max-width:60px;">
    								<option <?php if($cocktail_details['flussrate_type'] == "ml/h") {echo " selected ";} ?> value="ml/h">ml/h</option>
    								<option <?php if($cocktail_details['flussrate_type'] == "mg/h") {echo " selected ";} ?> value="mg/h">mg/h</option>
    							</select>
    						</td>
    					  <?php else:?> 
    						<td><label><?php echo $this->translate("Flussrate")?></label></td>
    						<td><input type="text" class="xxl_input extra_calculation" style="max-width:50px;"    data-pumpe_number="<?php echo $pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="flussrate" id="flussrate_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][flussrate]" value="<?php echo $cocktail_details['flussrate']?>"/>
    						</td>
						  <?php endif;?> 
						
					</tr>
					<tr class="single">
						<td><label><?php echo $this->translate("medication_carrier_solution")?></label></td>
						<td id="carr_<?php echo $pumpe_cnt;?>">
							<input type="text" class="xxl_input extra_calculation" style="max-width:50px;"  data-pumpe_number="<?php echo $pumpe_cnt;?>"   data-medication_type="<?php echo $medication_type;?>"  data-ec_field="carriersolution" id="carriersolution_<?php echo $medication_type; ?>_<?php echo $pumpe_cnt;?>"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][carrier_solution]" value="<?php echo $cocktail_details['carrier_solution']?>"/>
							<span class='carriersolution_extra_text' id='carriersolution_extra_text_<?php echo $pumpe_cnt;?>'><?php echo $schmerz[$pumpe_id]['carriersolution_extra_text'];?></span>							
						</td>
					</tr>
					
					<tr class="single">
						<td><label><?php echo $this->translate("Bolus")?></label></td>
						<td><input type="text" class="xxl_input" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][bolus]" value="<?php echo $cocktail_details['bolus']?>" /></td>
					</tr>
					<tr class="single">
						<td><label><?php echo $this->translate("Max Bolus")?></label></td>
						<td><input type="text" class="xxl_input" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][max_bolus]" value="<?php echo $cocktail_details['max_bolus']?>" /></td>
					</tr>		
					<tr class="single">
						<td><label><?php echo $this->translate("Sperrzeit")?></label></td>
						<td><input type="text" class="xxl_input" name="medication_block[<?php echo $medication_type; ?>][<?php echo $pumpe_cnt;?>][cocktail][sperrzeit]" value="<?php echo $cocktail_details['sperrzeit']?>"  /></td>
					</tr>
				</table>



				<?php if($this->acknowledge  == "1" && !empty($cocktail_details_alt) ):?>
                <!-- start online changes isschmerzpumpe details -->
				<table class="medikation  datatable_sch ack_back">
				    <!-- <tr>
                        <td colspan="2" width="60%">
                            <?php //echo $ack_referance_txt; ?>
                        </td>
                    </tr> -->
				
					<tr class="single edit_acknowlege_row">
						<td><label><?php echo $this->translate("Kommentar")?></label></td>
						<td><?php echo $cocktail_details_alt['description']?></td>
					</tr>		  
					<tr class="single edit_acknowlege_row">
						<td width="15%"><label><?php echo $this->translate("medication_type")?></label></td>
						<td width="85%"><?php echo $cocktail_details_alt['pumpe_medication_type']?></td>
					</tr>	
					<tr class="single edit_acknowlege_row">
						<td><label><?php echo $this->translate("Flussrate")?></label></td>
						<td><?php echo $cocktail_details_alt['flussrate']?></td>
					</tr>
					<tr class="single edit_acknowlege_row">
						<td><label><?php echo $this->translate("medication_carrier_solution")?></label></td>
						<td><?php echo $cocktail_details_alt['carrier_solution']?></td>
					</tr>
					
					<?php if(1 || $cocktail_details_alt['pumpe_type'] == "pca"):?>
						<tr class="single edit_acknowlege_row">
							<td width="15%"><label><?php echo $this->translate("Bolus")?></label></td>
							<td width="85%"><?php echo $cocktail_details_alt['bolus']?></td>
						</tr>
						<tr class="single edit_acknowlege_row">
							<td width="15%"><label><?php echo $this->translate(" Max Bolus")?></label></td>
							<td width="85%"><?php echo $cocktail_details_alt['max_bolus']?></td>
						</tr>	
						<tr class="single edit_acknowlege_row">
							<td><label><?php echo $this->translate("Sperrzeit")?></label></td>
							<td><?php echo $cocktail_details_alt['sperrzeit']?></td>
						</tr>
					<?php endif; ?>
				</table>
                <!-- end online changes isschmerzpumpe details -->
	 			<?php endif;?>
				

<?php if($this->ModulePrivileges[155] == true && ! empty($cocktail_details_alt_offline) ) :?> 
<!-- start multiple offline changes isschmerzpumpe details -->
<?php foreach($cocktail_details_alt_offline as $on_hold_changes_offline) : ?>
<?php 
    $prefix_lang_ack = 'Offline ';
    $ack_referance_txt = "";
    $ack_referance_del = "";

    if($cocktail_details_alt['status'] == "delete")
    {
        $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>';
        $ack_referance_del = '<span class="red_text">'.$this->translate($prefix_lang_ack . "Delete medication: ").'</span>'; 
    } 
    else if($cocktail_details_alt['status'] == "new")
    {
        $ack_referance_txt = '<span class="green_text">'.$this->translate($prefix_lang_ack . "Unapproved newly added medication: ").'</span>'; 
        $ack_referance_del = ''; 
    } 
    else
    {
        $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>'; 
        $ack_referance_del = ''; 
    }

?>
<!-- ################################### -->
			<table class="medikation  datatable_sch ack_back">
    			 <tr>
                    <td class="single" colspan="2" width="60%">
                        <?php echo  $ack_referance_txt; ?>
                    </td>
                </tr>
				<tr class="single edit_acknowlege_row">
					<td><label><?php echo $this->translate("Kommentar")?></label></td>
					<td><?php echo $on_hold_changes_offline['description']?></td>
				</tr>		  
				<tr class="single edit_acknowlege_row">
					<td width="15%"><label><?php echo $this->translate("medication_type")?></label></td>
					<td width="85%"><?php echo $on_hold_changes_offline['pumpe_medication_type']?></td>
				</tr>	
				<tr class="single edit_acknowlege_row">
					<td><label><?php echo $this->translate("Flussrate")?></label></td>
					<td><?php echo $on_hold_changes_offline['flussrate']?></td>
				</tr>
				<tr class="single edit_acknowlege_row">
					<td><label><?php echo $this->translate("medication_carrier_solution")?></label></td>
					<td><?php echo $on_hold_changes_offline['carrier_solution']?></td>
				</tr>
				
				<?php if(1 || $cocktail_details_alt['pumpe_type'] == "pca"):?>
					<tr class="single edit_acknowlege_row">
						<td width="15%"><label><?php echo $this->translate("Bolus")?></label></td>
						<td width="85%"><?php echo $on_hold_changes_offline['bolus']?></td>
					</tr>	
					<tr class="single edit_acknowlege_row">
						<td><label><?php echo $this->translate("Sperrzeit")?></label></td>
						<td><?php echo $on_hold_changes_offline['sperrzeit']?></td>
					</tr>
				<?php endif; ?>
			</table>

<!-- ################################### -->
<?php endforeach; ?>
<!-- end multiple offline changes isschmerzpumpe details -->
<?php endif; ?> 
        </div>
			</div>
			<?php  $pumpe_cnt++; endforeach; ?>
		<?php endif;?>
	</div>
 
	<div class="create_new_pumpe">
		<a class="add_button_link medication_add_link schm_add_block_link" href="javascript:void(0)" ><?php echo $this->translate("create_new_pumpe")?></a>
	</div>

	<br style="clear:both;">
	
                                            	
                                            	
                                            <!-- ISPC-2833 Ancuta 26.02.2021 START-->
                                            	<?php elseif($medication_type == "ispumpe"):?>
                                            	<?php if(1==1){?>
                                            	
                                            	<div class="medication_block  mk-container mk-edit" id="blocks_ispumpe" style="margin-bottom: 0px!important;">
                                            		<?php if (empty($medication_array[$medication_type]) && in_array($medication_type,$allowed_medication_types)):?>
                                            			<div class="ispumpe_ispumpeblock" id="empty_ispumpe_block">
                                            				<div class="med_block_header mk-top  mk-edit-title empty_header">
                                            					<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title ")?></h1>
                                            				</div>
                                            			</div>
                                            			
                                            		<?php else: ?>
                                            			<?php $ispumpe_pumpe_cnt = 1; foreach($medication_array[$medication_type] as $pumpe_id =>$med_pumpe):?>
                                            			<?php 
                                            			$ispumpe_pumpe_details=""; 
                                            			$ispumpe_pumpe_details_alt=""; 
                                            		$schmerz[$pumpe_id] = end($medication_array[$medication_type][$pumpe_id]);
                                            		$ispumpe_pumpe_details = $schmerz[$pumpe_id]['smpdescription'];
                                            		$ispumpe_pumpe_details_alt = $schmerz[$pumpe_id]['smpdescription_alt'];
                                                    $ispumpe_pumpe_details_alt_offline = $schmerz[$pumpe_id]['smpdescription_alt_offline']; // this is multi
                                            		?>
                                            			<div class="ispumpe_ispumpeblock_div" id="ispumpe_ispumpeblock_div<?php echo $ispumpe_pumpe_cnt;?>">
                                            				<div class="med_block_header mk-top  mk-edit-title <?php if(strlen($ispumpe_pumpe_details['pumpe_type'])> 0 && $ispumpe_pumpe_cnt > 1):?> inner<?php endif;?>">
                                            					<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title ".$ispumpe_pumpe_details['pumpe_type'])?></h1>
                                            				</div>
                                            		
                                            		
                                                			<table id="<?php echo $medication_type; ?>_ispumpeblock_header<?php echo $ispumpe_pumpe_cnt; ?>" class="medikation medication_edit_table">
                                                				<tr>
                                                					<th style="width:15% "><?php echo $this->translate('ispumpe_overall_volume')?></th>
                                                					<td>												<!-- //ISPC-2833 Lore 29.03.2021 -->
	                                                				    <input type="text" class="small_input ispumpe_calculation integerInput"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][overall_volume]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"       data-medication_type="<?php echo $medication_type;?>" data-ec_field="overall_volume" id="overall_volume_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['overall_volume']?>" />
                                                					</td>
                                                					<th style="width:30% "></th>
                                                					<th><?php echo $this->translate('ispumpe_pat_weight')?></th>
                                                					<td>
                                                						<?php if(!empty($ispumpe_pumpe_details['pat_weight'])):?>
		                                                					<input type="text" class="small_input ispumpe_calculation" style="width: 150px;" readonly="readonly"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][pat_weight]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"       data-medication_type="<?php echo $medication_type;?>" data-ec_field="pat_weight" id="pat_weight_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['pat_weight']?>" />
	                                                					<?php else:?>
		                                                					<input type="text" class="small_input ispumpe_calculation" style="width: 150px;" readonly="readonly" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][pat_weight]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"       data-medication_type="<?php echo $medication_type;?>" data-ec_field="pat_weight" id="pat_weight_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $this->patientweight; ?> " />
	                                                					<?php endif;?>
	                                                					
                                                					</td>
                                                				</tr>
                                                				<tr>
                                                					<th><?php echo $this->translate('ispumpe_run_rate')?></th>
                                                					<td>														<!-- //ISPC-2833 Lore 29.03.2021 -->
	                                                					<input type="text" class="small_input ispumpe_calculation integerInput"    name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][run_rate]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"       data-medication_type="<?php echo $medication_type;?>" data-ec_field="run_rate" id="run_rate_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['run_rate']?>" />
                                                					</td>
                                                					<th colspan="3"></th>
                                                				</tr>
                                                				<tr>
                                                					<th><?php echo $this->translate('ispumpe_used_liquid')?></th>
                                                					<td>
                                               					        <select class="xxl_input" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][used_liquid]">
                                            								<option <?php if($ispumpe_pumpe_details['used_liquid'] == "s.c.") {echo " selected ";} ?> value="aqua">Aqua</option>
                                            								<option <?php if($ispumpe_pumpe_details['used_liquid'] == "nacl") {echo " selected ";} ?> value="nacl">NaCl</option>
                                            							</select>
                                                					</td>
                                                					<th colspan="3"></th>
                                                				</tr>
                                                			</table>
                                                				
                                            			
                                            				<table id="<?php echo $medication_type; ?>_ispumpeblock<?php echo $ispumpe_pumpe_cnt; ?>" class="medikation medication_edit_table" data-medication_type="<?php echo $medication_type; ?>">
                                            					<thead>
                                            				 		<tr>
                                            				 		    <th class="name sort"><?php echo $this->translate('medication_importance'); ?></th>
                                            				 			<th class="name"><?php echo $this->translate('medication_name');?> /  <span><?php echo $this->translate('medication_drug'); ?></span></th>
                                            			 				<th class="doseirung"><?php echo $this->translate('medication_ispumpe_dosage'); ?></th>
                                            			 				<th><?php echo $this->translate('medication_unit'); ?></th>
                                            			 				<th></th>
                                             			 				<th><?php echo $this->translate('ispumpe_overall_dosage_h'); ?></th>
                                             			 				<th><?php echo $this->translate('ispumpe_overall_dosage_24h'); ?></th>
                                             			 				<th><?php echo $this->translate('ispumpe_overall_dosage_pump'); ?></th>
                                             			 				<th><?php echo $this->translate('ispumpe_overall_drug_volume'); ?></th>
                                             			 				<th><?php echo $this->translate('ispumpe_unit2ml'); ?></th>
                                             			 				<th><?php echo $this->translate('medication_indication'); ?></th>
                                            				 			<th></th>
                                            				 		</tr>
                                            				 	</thead>
                                            				 	
                                            				 	
                                            				 	<tbody>
                                            				 		<?php $cnt = 1; foreach($med_pumpe as $k =>$med):?>
                                            							<tr id="tr<?php echo $medication_type;?><?php echo $ispumpe_pumpe_cnt;?><?php echo $cnt;?>"   
                                            							class=" single
                                                                        <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) :?>  has_ack <?php endif;?>"
                                                                        >
	                                                                       <!-- ############################## -->
                                            								<!-- TD  MEDICATION :: SORT[Reihenfolge]  -->
                                                                            <td class="sortnum">
                                            									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][importance][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_importance ispumpe_referral"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['importance'];?>"  rel="<?php echo $medication_type; ?>" />
                                            									<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][replace_with][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input replace_with ispumpe_referral" value="<?php echo $med['replace_with'];?>"  rel="<?php echo $medication_type; ?>" />
                                                                            </td>
                                                                        
                                                                        
                                            								<!-- ############################## -->
                                            								<!-- TD  MEDICATION :: NAME  / DRUG  -->
                                            								<td class="name" style="width:30% !important;">
                                                                                <div class="cn">
                                            									<!-- MEDICATION NAME -->						
                                            									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> ispumpe_referral  livesearchmedinp_fixedwidth onchange_reset_pzn name"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>							
                                            					    			<input name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][hidd_medication][<?php echo $cnt; ?>]" value="<?php echo $med['medication_master_id'];?>" id="hidd_medication_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt; ?>" type="hidden">
                                            									
                                            									<?php if($this->show_mmi == "1"):?>
                                            										<input type="button" class="mmi_search_button  btnBlue btnMMI" value="<?php echo $this->translate('mmi_button');?>" id="mmi_search_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo $ispumpe_pumpe_details['pumpe_type']?>_<?php echo $ispumpe_pumpe_cnt; ?>" name="mmi_search">
                                            									<?php endif;?>
                                            									
                                            				    				<input type="hidden" id="drid_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][drid][<?php echo $cnt; ?>]" value="<?php echo $med['id'];?>" />
                                            								    <input type="hidden" id="edited_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][edited][<?php echo $cnt; ?>]" value="0" />
                                            		
                                            									<!-- MEDICATION DRUG -->
                                            									<input type="text" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][drug][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt; ?>"  value="<?php echo $med['drug'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug ispumpe_referral onchange_reset_pzn"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
                                            									</div>
                                                        <?php           
                                            				$field_name = "medication_block[{$medication_type}][{$ispumpe_pumpe_cnt}][{$cnt}][pzn]";
                                            				$field_value = $med['MedicationMaster']['pzn'];
                                            				$attr = array("id" => "{$medication_type}_medication_pzn-{$ispumpe_pumpe_cnt}_{$cnt}", "class" => "medication_pzn");
                                            				echo $this->formHidden($field_name, $field_value, $attr); 
                                            			?>
                                            			<?php
                                            				$field_name = "medication_block[{$medication_type}][{$ispumpe_pumpe_cnt}][{$cnt}][source]";
                                            				$field_value = $med['MedicationMaster']['source'];
                                            				$attr = array("id" => "{$medication_type}_medication_source-{$ispumpe_pumpe_cnt}_{$cnt}", "class" => "medication_source");
                                            				echo $this->formHidden($field_name, $field_value, $attr); 
                                            			?>
                                            			<?php
                                            				$field_name = "medication_block[{$medication_type}][{$ispumpe_pumpe_cnt}][{$cnt}][dbf_id]";
                                            				$field_value = $med['MedicationMaster']['dbf_id'];
                                            				$attr = array("id" => "{$medication_type}_medication_dbf_id-{$ispumpe_pumpe_cnt}_{$cnt}", "class" => "medication_dbf_id");
                                            				echo $this->formHidden($field_name, $field_value, $attr); 
                                            			?>
                                            			<?php
                                            				//ISPC-2554 pct.3 Carmen 27.03.2020
                                            				$field_name = "medication_block[{$medication_type}][{$ispumpe_pumpe_cnt}][{$cnt}][atc]";
                                            				$field_value = $med['MedicationMaster']['atc'];
                                            				$attr = array("id" => "{$medication_type}_medication_atc-{$ispumpe_pumpe_cnt}_{$cnt}", "class" => "medication_atc");
                                            				echo $this->formHidden($field_name, $field_value, $attr); 
                                            			?>
                                            								</td>
                                            								
                                            								
                                            								<!-- ############################## -->
                                           									<!--  MEDICATION  DOSAGE [Wirkstoffmenge]   -->
                                            								<td class="doseirung">																																																																			
                                            								        <!-- //ISPC-2833 Lore 29.03.2021 -->
                                                    						  	    <input type="text"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][dosage][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only ispumpe_dosage ispumpe_referral ispumpe_calculation integerInput" data-ec_field="dosage"  id="dosage_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['dosage'];?>"  rel="<?php echo $medication_type; ?>" />
                                                    						  	    <input type="hidden"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][bolus_per_med][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only ispumpe_referral  ispumpe_calculation" data-ec_field="bolus_per_med"  id="bolus_per_med_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['bolus_per_med'];?>"  rel="<?php echo $medication_type; ?>" />
                                                    						  	    
                                            								</td>
                                            								
                                            								<!-- ############################## -->
                                            								<!-- TD  MEDICATION :: UNIT [Einheit] -->
                                            								<td class="border_bottom_solid" style="width:5% !important;">
                                            									<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][unit][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_unit ispumpe_referral  change_status sh_selector_medication_unit"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
                                            									<?php $selected_unit="i.E.";?>
                                            										<option value="0" >i.E.</option>										
                                            										<?php foreach($client_medication_extra['unit'] as $unit_id => $unit) :?>
                                            											<option value="<?php echo $unit_id; ?>" <?php if($med['unit_id'] == $unit_id):?> selected="selected" <?php endif; ?> ><?php echo $unit;?></option>
                                            											<?php if($med['unit_id'] == $unit_id):?>
                                            											<?php $selected_unit = $unit;?>
                                            											<?php endif;?>
                                            										<?php endforeach; ?>
                                            									</select>
                                            								</td>
                                            								<td>
                                            									/kg/h
                                            								</td>
	                                                                        <!-- ############################## -->
                                           									<!--  MEDICATION  overall_dosage_h [Gesamtdosis pro Stunde]   -->
                                            								<td class="overall_dosage_h">	
                                                    						  	    <input type="text"  readonly="readonly"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][overall_dosage_h][<?php echo $cnt;?>]"   
                                                    						  	    data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only   overall_dosage_h<?php echo $ispumpe_pumpe_cnt;?> ispumpe_referral   ispumpe_calculation" data-ec_field="overall_dosage_h"  id="overall_dosage_h_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['overall_dosage_h'];?>"  rel="<?php echo $medication_type; ?>" />
                                            								</td>
                                            								
	                                                                        <!-- ############################## -->
                                           									<!--  MEDICATION  overall_dosage_24h [Gesamtdosis in 24h]   -->
                                            								<td class="overall_dosage_24h">	
                                                    						  	    <input type="text"  readonly="readonly"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][overall_dosage_24h][<?php echo $cnt;?>]"   
                                                    						  	    data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only   ispumpe_referral   ispumpe_calculation" data-ec_field="overall_dosage_24h"  id="overall_dosage_24h_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['overall_dosage_24h'];?>"  rel="<?php echo $medication_type; ?>" />
                                            								</td>
	                                                                        <!-- ############################## -->
                                           									<!--  MEDICATION  overall_dosage_pump [Gesamtdosis pro Pumpe]   -->
                                            								<td class="overall_dosage_pump">	
                                                    						  	    <input type="text"   readonly="readonly" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][overall_dosage_pump][<?php echo $cnt;?>]"   
                                                    						  	    data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only   ispumpe_referral    overall_dosage_pump<?php echo $ispumpe_pumpe_cnt;?> ispumpe_calculation" data-ec_field="overall_dosage_pump"  id="overall_dosage_pump_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['overall_dosage_pump'];?>"  rel="<?php echo $medication_type; ?>" />
                                            								</td>
	                                                                        <!-- ############################## -->
                                           									<!--  MEDICATION  drug_volume [Volumen des Wirkstoff]   -->
                                            								<td class="drug_volume">	
                                            								        <!-- //ISPC-2833 Lore 29.03.2021 -->
                                                    						  	    <input type="text"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][drug_volume][<?php echo $cnt;?>]"   						
                                                    						  	    data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only ispumpe_referral drug_volume<?php echo $ispumpe_pumpe_cnt;?> ispumpe_calculation integerInput" data-ec_field="drug_volume"  id="drug_volume_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['drug_volume'];?>"  rel="<?php echo $medication_type; ?>" />
                                            								</td>
	                                                                        <!-- ############################## -->
                                           									<!--  MEDICATION  unit2ml [entsprecht Einheit / ml]   -->
                                            								<td class="ispumpe_unit2ml">	
                                                    						  	    <input type="text"   readonly="readonly" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][unit2ml][<?php echo $cnt;?>]"   
                                                    						  	    data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only   ispumpe_referral  ispumpe_calculation" data-ec_field="unit2ml"  id="unit2ml_ispumpe_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-pumpe_med="<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>"  value="<?php echo $med['unit2ml'];?>"  rel="<?php echo $medication_type; ?>" />
                                            								</td>
                                            								
                                            								<!-- ##################################### -->
                                            								<!-- TD MEDICATION :: INDICATION -->
                                            								<td class="ind-comm">
                                            									<!--  MEDICATION INDICATION -->						
                                            									<select name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][indication][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="indication_color_select ispumpe_referral"  data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>_<?php echo $cnt;?>" <?php if(strlen($med['indication_id'])>0 && $med['indication_id'] != "0"):?> style="background: #<?php echo $client_medication_extra['indication'][$med['indication_id']]['color'];?>" <?php endif; ?> rel="<?php echo $medication_type; ?>">
                                            										<option id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#FFFFFF" value="0" style="background: #FFFFFF!important"  >Auswahl</option>
                                            										<?php foreach($client_medication_extra['indication'] as $indication_id => $indication) :?>
                                            											<option value="<?php echo $indication_id; ?>"  id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#<?php echo $indication['color'];?>" style="background: #<?php echo $indication['color'];?>"  <?php if($med['indication_id'] == $indication_id):?> selected="selected" <?php endif; ?> ><?php echo $indication['name'];?></option>
                                            										<?php endforeach; ?>
                                            									</select>
                                            								</td>
                                            		
                                            								<!-- ############################## -->
                                            								<!-- TD MEDICATION :: DELETE -->
                                            								<td   class="delete delete_medication"  rel="<?php echo $med['id'];?>" data-medication_type="<?php echo $medication_type; ?>" > </td>
                                            							</tr> 
                                            							
                                            							
                                            					 	<?php if($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) :?>
                                            						<?php 
                                            						$ack_referance_txt = array();
                                                                    $ack_referance_del = array();
                                            
                                            						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
                                            						{
                                            							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
                                            							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
                                            						} 
                                            						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
                                            						{
                                            							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
                                            							$ack_referance_del[$med['id']] = ''; 
                                            						} 
                                            						else
                                            						{
                                            							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
                                            							$ack_referance_del[$med['id']] = ''; 
                                            						}
                                            		 		 
                                            						if($this->approval_rights == "1")
                                            						{
                                            							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
                                            							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
                                            							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
                                            			 			} 
                                            						else
                                            						{
                                            							$app_rights = '';
                                            							$approve = '';
                                            							$deny = '';
                                            						}
                                            		 		?>
                                            							<tr class="ack_info_tr single edit_acknowlege_row acknowlege_row extedned_ack" id="ack_<?php echo $med['id'];?>" >
                                            							<!--  MEDICATION SORT / IMPORTANCE -->
                                            								<td class="sortnum">
                                            									<div class="mifo">
                                            										<span class="lb">&nbsp;</span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['importance'];?> </span>
                                            									</div>
                                            								</td>
                                            							
                                            							
                                            								<!--  MEDICATION NAME -->
                                            								<td>
                                            								    <div class="ackn_ref"><?php echo $ack_referance_txt[$med['id']]; ?></div>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $ack_referance_del[$med['id']]; ?><?php echo $this->translate('medication_name');?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['name'];?></span>
                                            										<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['drug'];?></span>
                                            										
                                            									</div>
                                            								</td>
                                            								
                                            								
                                            							 
                                            								<!--  MEDICATION  DOSAGE  -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('ispumpe_medication_dosage'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            							 
                                            								<!--  MEDICATION UNIT  -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['unit'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            								<td>
                                            									<div class="mifo">
                                            										/kg/h
                                            									</div>
                                            								</td>
                                            							   							 
                                            								<!--  MEDICATION overall_dosage_h Gesamtdosis pro Stunde -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('overall_dosage_h'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['overall_dosage_h'];?></span>
                                            									</div>
                                            								</td>
                                            								<!--  MEDICATION overall_dosage24h Gesamtdosis in 24h -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('overall_dosage24h'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['overall_dosage24h'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            								<!--  MEDICATION overall_dosage_pump Gesamtdosis pro Pumpe -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('overall_dosage_pump'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['overall_dosage_pump'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            								<!--  MEDICATION overall_dosage24h Volumen des Wirkstoff -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('drug_volume'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['drug_volume'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            								<!--  MEDICATION unit2ml entsprecht Einheit / ml -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('unit2ml'); ?></span>
                                            										<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['unit2ml'];?></span>
                                            									</div>
                                            								</td>
                                            							 
                                            							  
                                            								<!--  MEDICATION INDICATION / COMMENTS-->
                                            								<td >
                                            									<div class="mifo">
                                            						 				<?php if(strlen($med['on_hold_changes'][$med['id']]['indication_color']) > 0):?>
                                            						 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
                                            											<span class="vl indication_span" style="background: #<?php echo $med['on_hold_changes'][$med['id']]['indication_color'];?>"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span>
                                            										<?php else:?>
                                            											<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
                                            											<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span> 
                                            										<?php endif;?>
                                            									</div>
                                            								</td>
                                                                            <td></td>
                                            								
                                            							</tr>
                                            						<?php endif;?>
                                            <?php 
                                            if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) :
                                                foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes_offline) : 
                                            ?>
                                            <!-- start offline changes ispumpe-->
                                            <?php
                                            $ack_referance_txt = '';
                                            $ack_referance_del = '';
                                            
                                            switch ($on_hold_changes_offline['status']) {
                                            
                                                case 'delete':
                                                    $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
                                                    $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>'; 
                                                break;
                                                
                                                case 'new':
                                                    $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>'; 
                                                break;
                                                
                                                case 'edit':
                                                    $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
                                                break;
                                            
                                                default:
                                                    $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Renew changes: ").'</span>'; 
                                                    $ack_referance_del = ''; 
                                                break;
                                            
                                            
                                                
                                            }
                                            ?>          
                                            
                                            <!-- ############################### -->
                                                                        <tr class="ack_info_tr single edit_acknowlege_row offline_acknowlege_row extedned_ack" id="ack_<?php echo $med['id'];?>" >
                                            							<!--  MEDICATION SORT / IMPORTANCE -->
                                            								<td class="sortnum">
                                            									<div class="mifo">
                                            										<span class="lb">&nbsp;</span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['importance'];?> </span>
                                            									</div>
                                            								</td>
                                            							
                                            							
                                            								<!--  MEDICATION NAME -->
                                            								<td>
                                            								    <div class="ackn_ref"><?php echo $ack_referance_txt; ?></div>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $ack_referance_del; ?><?php echo $this->translate('medication_name');?></span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['name'];?></span>
                                            										<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['drug'];?></span>
                                            										
                                            										
                                            										<?php if ($medication_type == "isintubated"):?>
                                            											<span class="lb"><?php echo $this->translate('medication_packaging'); ?></span>
                                            											<span class="vl"><?php echo $on_hold_changes_offline['packaging_name'];?></span>
                                            										<?php endif;?>
                                            										
                                            									</div>
                                            								</td>
                                            								
                                            								
                                            								<?php if ($this->show_new_fileds == "1"):?>
                                            								
                                            								<!--  MEDICATION UNIT / DOSAGE FORM / CONCENTRATION -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['unit'];?></span>
                                            										<!-- 	
                                            										<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['dosage_form'];?></span>
                                            										-->
                                            										<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['concentration'];?></span>
                                            									</div>
                                            								</td>
                                            								<?php endif;?>
                                            								<!-- ISPC - 2329 - punctul o - 2 digits dosage view -->
                                            								<!-- TD  MEDICATION :: DOSAGE INPUTS-->
                                            								    <!-- ISPC-2684 Lore 02.10.2020 -->
                                                    						  <?php if($this->ModulePrivileges[240] == true) :?> 
                                                    							<td class="border_bottom_solid">
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_h_ml');?></span>
                                            											<span class="vl"><?php echo round($on_hold_changes_offline['dosage'], 2); ?></span>
                                            										</div>
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_h_unit');?></span>
                                            											<span class="vl"><?php echo round($on_hold_changes_offline['unit_dosage'], 2); ?></span>
                                            										</div>
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_24h');?></span>
                                            											<span class="vl"><?php echo $on_hold_changes_offline['dosage_24h']; ?></span>
                                            										</div>
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_24h_unit');?></span>
                                            											<span class="vl"><?php echo $on_hold_changes_offline['unit_dosage_24h']; ?></span>
                                            										</div>										
                                            									</td>
                                                    						  <?php else:?> 
                                            									<td class="border_bottom_solid">
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_h');?></span>
                                            											<span class="vl"><?php echo round($on_hold_changes_offline['dosage'], 2); ?></span>
                                            										</div>
                                            										<div class="mifo">
                                            											<span class="lb"><?php echo $this->translate('medication_dosage_24h');?></span>
                                            											<span class="vl"><?php echo $on_hold_changes_offline['dosage_24h']; ?></span>
                                            										</div>
                                            									</td>
                                                    						  <?php endif;?> 
                                            																
                                            
                                            								
                                            								<!--  MEDICATION INDICATION / COMMENTS-->
                                            								<td >
                                            									<div class="mifo">
                                            						 				<?php if(strlen($on_hold_changes_offline['indication_color']) > 0):?>
                                            						 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
                                            											<span class="vl indication_span" style="background: #<?php echo $on_hold_changes_offline['indication_color'];?>"><?php echo $on_hold_changes_offline['indication'];?></span>
                                            										<?php else:?>
                                            											<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
                                            											<span class="vl"><?php echo $on_hold_changes_offline['indication'];?></span> 
                                            										<?php endif;?>
                                            									</div>
                                            								</td>
                                            								<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
                                            								<td>
                                            									<div class="mifo">
                                            										<span class="lb">&nbsp;</span>
                                            										<span class="vl"><?php echo $on_hold_changes_offline['medication_change_date'];?></span>
                                            									</div>
                                            								</td>
                                                                            <td></td>
                                            								
                                            							</tr>
                                            
                                            <!-- ############################### -->
                                                          
                                            <?php endforeach;?>
                                            <!-- end offline changes ispumpe-->
                                            <?php endif;?>              
                                                                    
                                                        <tr class="separator">
                                            				<td colspan="7"> </td>
                                            			</tr>
                                                <?php $cnt++; endforeach;?>
                                                </table>
                                            	 			
                                            	 			<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][id]"  value="<?php echo $ispumpe_pumpe_details['id']?>"/>
                                            	 			<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][pumpe_type]"  value="<?php echo $ispumpe_pumpe_details['pumpe_type']?>"/>
                                            	 			<input type="hidden" value="<?php echo $cnt;?>" id="new_ispumpe_line_<?php echo $medication_type;?>_<?php echo $ispumpe_pumpe_details['pumpe_type'];?>_<?php echo $ispumpe_pumpe_cnt;?>">
                                            	 			
                                            					<a  href="javascript:void(0)" data-ispumpe_pumpe_type="<?php echo $ispumpe_pumpe_details['pumpe_type'];?>" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>" rel="<?php echo $medication_type?>" class="add_button_link medication_ispumpe_add_link">
                                            				 	<?php echo $this->translate($medication_type." medication add")?>
                                            					</a>
                                                            
                                                            
                                                         <div class="medication_block mk-container mk-edit"">
                                            				<table style="width: 40%!important; float: right;" class="medikation datatable_sch 
                                                            <?php if(($this->acknowledge  == "1" && !empty($ispumpe_pumpe_details_alt))  || ($this->ModulePrivileges[155] == true && !empty($ispumpe_pumpe_details_alt_offline)) ) :?> ack_back <?php endif;?>       
                                                            " >
                                            					<tr class="single">
                                            						<td style="width: 20%"><label><?php echo $this->translate("ispumpe_pumpe_overall_drug_volume")?></label></td>
                                            						<td><input type="text" class="small_input ispumpe_calculation" readonly="readonly"  style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][overall_drug_volume]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="overall_drug_volume" id="overall_drug_volume_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['overall_drug_volume']?>" /></td>
                                            					</tr>
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_liquid_amount")?></label></td>
                                            						<td><input type="text" class="small_input ispumpe_calculation" readonly="readonly"  style="width:150px;"  name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][liquid_amount]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"       data-medication_type="<?php echo $medication_type;?>" data-ec_field="liquid_amount" id="liquid_amount_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['liquid_amount']?>" /></td>
                                            					</tr>		
                                            				</table>
                                            				
                                            				
                                            				<table class="medikation datatable_sch 
                                                            <?php if(($this->acknowledge  == "1" && !empty($ispumpe_pumpe_details_alt))  || ($this->ModulePrivileges[155] == true && !empty($ispumpe_pumpe_details_alt_offline)) ) :?> ack_back <?php endif;?>       
                                                            " >
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_overall_running_time")?></label></td>
                                            						<td><input type="text" class="small_input ispumpe_calculation" readonly="readonly"  style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][overall_running_time]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="overall_running_time" id="overall_running_time_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['overall_running_time']?>" /></td>
                                            					</tr>
                                            					
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_min_running_time")?></label></td>
                                            						<td><input type="text" class="small_input ispumpe_calculation" readonly="readonly"  style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][min_running_time]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="min_running_time" id="min_running_time_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['min_running_time']?>" /></td>
                                            					</tr>
                                            					
                                            					<tr class="single">
                                            						<td width="16%"><label><?php echo $this->translate("medication_type")?></label></td>
                                            						
                                            						<td width="">
                                            							<select class="xxl_input"style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][pumpe_medication_type]">
                                            								<option value="">--</option>
                                            								<option <?php if($ispumpe_pumpe_details['pumpe_medication_type'] == "i.v.") {echo " selected ";} ?> value="i.v.">i.v.</option>
                                            								<option <?php if($ispumpe_pumpe_details['pumpe_medication_type'] == "s.c.") {echo " selected ";} ?> value="s.c.">s.c.</option>
                                            								<option <?php if($ispumpe_pumpe_details['pumpe_medication_type'] == "über Port") {echo " selected ";} ?> value="über Port">über Port</option>
                                            							</select>
                                            						</td>
                                            					</tr>	
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_bolus")?></label></td>	
                                            						<!-- //ISPC-2833 Lore 29.03.2021 -->
                                            						<td><input type="text" class="small_input ispumpe_calculation integerInput" style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][bolus]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="bolus" id="bolus_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['bolus']?>" /></td>
                                            					</tr>
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_max_bolus_day")?></label></td>	
                                            						<!-- //ISPC-2833 Lore 29.03.2021 -->
                                            						<td><input type="text" class="small_input ispumpe_calculation integerInput" style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][max_bolus_day]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="max_bolus_day" id="max_bolus_day_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['max_bolus_day']?>" /></td>
                                            					</tr>
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_max_bolus_after")?></label></td>
                                            						<!-- //ISPC-2833 Lore 29.03.2021 -->
                                            						<td><input type="text" class="small_input ispumpe_calculation integerInput" style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][max_bolus_after]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="max_bolus_after" id="max_bolus_after_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['max_bolus_after']?>" /></td>
                                            					</tr>
                                            					<tr class="single">
                                            						<td><label><?php echo $this->translate("ispumpe_next_bolus")?></label></td>
                                            						<!-- //ISPC-2833 Lore 29.03.2021 -->
                                            						<td><input type="text" class="small_input ispumpe_calculation integerInput" style="width:150px;" name="medication_block[<?php echo $medication_type; ?>][<?php echo $ispumpe_pumpe_cnt;?>][ispumpe_pumpe][next_bolus]" data-ispumpe_pumpe_number="<?php echo $ispumpe_pumpe_cnt;?>"  data-medication_type="<?php echo $medication_type;?>" data-ec_field="next_bolus" id="next_bolus_<?php echo $medication_type; ?>_<?php echo $ispumpe_pumpe_cnt;?>" value="<?php echo $ispumpe_pumpe_details['next_bolus']?>" /></td>
                                            					</tr>
                                            				</table>
                                            
                                            
                                            
                                            				<?php if($this->acknowledge  == "1" && !empty($ispumpe_pumpe_details_alt) ):?>
                                                            <!-- start online changes ispumpe details -->
                                                           <table class="medikation datatable_sch ack_back">
                                                                 <tr>
                                                    		 		<td colspan="2" >
                                                    		 			<?php echo  $ack_referance_txt[$ispumpe_pumpe_details_alt['id']]; ?>
                                                  						<div style="text-align: right;"><?php echo  $approve; ?> <?php echo  $deny; ?></div>
                                                    		 		</td>
                                                		 		</tr>
                                                		 		
                                                                <tr class="single">
                                                                    <td width="20%"><label><?php echo $this->translate("ispumpe_overall_running_time")?>:</label></td>
                                                                    <td width="80%"><?php echo $ispumpe_pumpe_details_alt['overall_running_time']?></td>
                                                                </tr>
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("ispumpe_min_running_time")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['min_running_time']?></td>
                                                                </tr>        
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("medication_type")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['pumpe_medication_type']?></td>
                                                                </tr>
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("ispumpe_bolus")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['bolus']?></td>
                                                                </tr>        
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("ispumpe_max_bolus_day")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['max_bolus_day']?></td>
                                                                </tr>        
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("ispumpe_max_bolus_after")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['max_bolus_after']?></td>
                                                                </tr>        
                                                                <tr class="single ">
                                                                    <td><label><?php echo $this->translate("ispumpe_next_bolus")?>:</label></td>
                                                                    <td><?php echo $ispumpe_pumpe_details_alt['next_bolus']?></td>
                                                                </tr>        
                                                            </table>
                                                            <!-- end online changes ispumpe details -->
                                            	 			<?php endif;?>
                                            				
                                            
                                            <?php if($this->ModulePrivileges[155] == true && ! empty($ispumpe_pumpe_details_alt_offline) ) :?> 
                                            <!-- start multiple offline changes ispumpe details -->
                                            <?php foreach($ispumpe_pumpe_details_alt_offline as $on_hold_changes_offline) : ?>
                                            <?php 
                                                $prefix_lang_ack = 'Offline ';
                                                $ack_referance_txt = "";
                                                $ack_referance_del = "";
                                            
                                                if($ispumpe_pumpe_details_alt['status'] == "delete")
                                                {
                                                    $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>';
                                                    $ack_referance_del = '<span class="red_text">'.$this->translate($prefix_lang_ack . "Delete medication: ").'</span>'; 
                                                } 
                                                else if($ispumpe_pumpe_details_alt['status'] == "new")
                                                {
                                                    $ack_referance_txt = '<span class="green_text">'.$this->translate($prefix_lang_ack . "Unapproved newly added medication: ").'</span>'; 
                                                    $ack_referance_del = ''; 
                                                } 
                                                else
                                                {
                                                    $ack_referance_txt = '<span class="blue_text">'.$this->translate($prefix_lang_ack . "Unapproved changes: ").'</span>'; 
                                                    $ack_referance_del = ''; 
                                                }
                                            
                                            ?>
                                            <!-- ################################### -->
                     							  <table class="medikation datatable_sch ack_back">
                                                     <tr>
                                        		 		<td colspan="2" >
                                        		 			<?php echo $ack_referance_txt; ?>
                                      						<div style="text-align: right;"><?php echo  $approve; ?> <?php echo  $deny; ?></div>
                                        		 		</td>
                                    		 		</tr>
                                    		 		
                                                    <tr class="single">
                                                        <td width="20%"><label><?php echo $this->translate("ispumpe_overall_running_time")?>:</label></td>
                                                        <td width="80%"><?php echo $on_hold_changes_offline['overall_running_time']?></td>
                                                    </tr>
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("ispumpe_min_running_time")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['min_running_time']?></td>
                                                    </tr>        
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("medication_type")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['pumpe_medication_type']?></td>
                                                    </tr>
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("ispumpe_bolus")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['bolus']?></td>
                                                    </tr>        
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("ispumpe_max_bolus_day")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['max_bolus_day']?></td>
                                                    </tr>        
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("ispumpe_max_bolus_after")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['max_bolus_after']?></td>
                                                    </tr>        
                                                    <tr class="single ">
                                                        <td><label><?php echo $this->translate("ispumpe_next_bolus")?>:</label></td>
                                                        <td><?php echo $on_hold_changes_offline['next_bolus']?></td>
                                                    </tr>        
                                                </table>   
                                            
                                            <!-- ################################### -->
                                            <?php endforeach; ?>
                                            <!-- end multiple offline changes ispumpe details -->
                                            <?php endif; ?> 
                                                    </div>
                                            			</div>
                                            			<?php  $ispumpe_pumpe_cnt++; endforeach; ?>
                                            		<?php endif;?>
                                            	</div>
                                             
                                            	<div class="create_new_ispumpe_pumpe">
                                            		<a class="add_button_link medication_add_link ispumpe_add_block_link" href="javascript:void(0)" ><?php echo $this->translate("create_new_ispumpe")?></a>
                                            	</div>
                                            	<br style="clear:both;">
                                            	
                                            	
                                            <?php } ?>
                                            <!-- ISPC-2833 Ancuta 26.02.2021 END-->
                                            	
	
	
	
	<?php elseif($medication_type == "scheduled"):?>
	<div class="medication_block mk-container mk-edit">
	
		<div class="med_block_header mk-top mk-edit-title"">
			<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title")?></h1>
		</div>
	
		<table id="<?php echo $medication_type; ?>_med_table" class="medikation medication_edit_table" data-medication_type="<?php echo $medication_type; ?>">
			<thead>
		 		<tr>
		 			<th class="name sort"><?php echo $this->translate('medication_importance');?></th>
		 			<th class="name"><?php echo $this->translate('medication_name');?> / <span><?php echo $this->translate('medication_drug'); ?></span></th>
		 			
		 			<?php if ($this->show_new_fileds == "1" && $schedule_extra == 1 ):?>
		 				<th class="name doseirung"><?php echo $this->translate('medication_unit'); ?> / <span><?php echo $this->translate('medication_type'); ?></span></th>
		 				<th class="name doseirung"><?php echo $this->translate('medication_dosageform'); ?> / <span><?php echo $this->translate('medication_concentration'); ?></span></th>
		 			<?php endif;?>
		 			
		 			<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>
		 				<th colspan="<?php echo count($this->dosage_intervals[$medication_type]);?>"><?php echo $this->translate('medication_dosage'); ?></th>
		 			<?php else: ?>
		 				<th class="doseirung"><?php echo $this->translate('medication_dosage'); ?></th>
		 			<?php endif; ?>
		 			
		 			<th  ><?php echo $this->translate('medication_indication'); ?> /<br/><span><?php echo $this->translate('medication_comments'); ?></span></th>
		 				
		 			<th><?php echo $this->translate('medication_days_interval'); ?></th>
		 			<th><?php echo $this->translate('medication_administration_date'); ?></th>
		 				
		 			<th colspan="2" class="name"><?php echo $this->translate('medication_prescribed_by'); ?> /<br/><span><?php echo $this->translate('medication_change_date'); ?></span></th>
		 			
		 		</tr>
		 	</thead>
		 	
		 	<tbody>
		 		<?php $cnt = 1; foreach($medication_array[$medication_type] as $k =>$med):?>
					<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>"
					class="single   
                    <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) :?> has_ack <?php endif;?>"
                    >
                    
                    
						<!-- ############################################# -->
						<!-- TD    SORT -->
						<td class="sortnum">
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][importance][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_importance referral change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['importance'];?>"  rel="<?php echo $medication_type; ?>" />
							<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][replace_with][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input replace_with referral" value="<?php echo $med['replace_with'];?>"  rel="<?php echo $medication_type; ?>" />
						</td>
                    
                    
						<!-- ############################## -->
						<!-- TD  MEDICATION :: NAME  / DRUG  -->
						<td class="border_bottom_solid name">
                            <div class="cn">
    							<!-- MEDICATION NAME -->						
    							<? if($medication_type == "isnutrition"):?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp_nutrition med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> referral change_status livesearchmedinp_fixedwidth name" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    							<?php else:?>
    								<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> referral change_status livesearchmedinp_fixedwidth name" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
    							<?php endif;?>
    			    			<input name="medication_block[<?php echo $medication_type; ?>][hidd_medication][<?php echo $cnt; ?>]" value="<?php echo $med['medication_master_id'];?>" id="hidd_medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" type="hidden">
    
    							<?php if($this->show_mmi == "1" && $medication_type != "isnutrition"):?>
    								<input type="button" class="mmi_search_button  btnBlue btnMMI" value="<?php echo $this->translate('mmi_button');?>" id="mmi_search_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" name="mmi_search">
    							<?php endif;?>
    
    		    				<input type="hidden" id="drid_<?php echo $medication_type; ?>_[<?php echo $cnt; ?>]" name="medication_block[<?php echo $medication_type; ?>][drid][<?php echo $cnt; ?>]" value="<?php echo $med['id'];?>" />
    						    <input type="hidden" id="edited_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][edited][<?php echo $cnt; ?>]" value="0" />
    							<!-- MEDICATION DRUG -->
    							<input type="text" name="medication_block[<?php echo $medication_type; ?>][drug][<?php echo $cnt; ?>]" id="drug_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  value="<?php echo $med['drug'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_drug referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
							</div>
							
						</td>
						
						<?php if ($this->show_new_fileds == "1" && $schedule_extra == 1 ):?>
						<!-- ############################## -->
						<!-- TD  MEDICATION :: UNIT / TYPE  -->
						<td class="border_bottom_solid">
							<!--  MEDICATION  UNIT -->
							<select name="medication_block[<?php echo $medication_type; ?>][unit][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_unit referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
								<option value="0" >  </option>
								<?php foreach($client_medication_extra['unit'] as $unit_id => $unit) :?>
									<option value="<?php echo $unit_id; ?>" <?php if($med['unit_id'] == $unit_id):?> selected="selected" <?php endif; ?> ><?php echo $unit;?></option>
								<?php endforeach; ?>
							</select>
							
							<!--  MEDICATION  TYPE  -->
							<select name="medication_block[<?php echo $medication_type; ?>][type][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="medication_type referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
								<option value="0" >  </option>
								<?php foreach($client_medication_extra['type'] as $type_id => $type) :?>
									<option value="<?php echo $type_id; ?>" <?php if($med['type_id'] == $type_id):?> selected="selected" <?php endif; ?> ><?php echo $type;?></option>
								<?php endforeach; ?>
							</select>
						</td>
						
						<!-- ############################## -->
						<!-- TD  MEDICATION :: DOSAGE FORM / CONCENTRATION  -->
						<td class="border_bottom_solid">
							<!--  MEDICATION  DOSAGE FORM -->
							<select name="medication_block[<?php echo $medication_type; ?>][dosage_form][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>" class="medication_dosage_form referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>">
								<option value="0" >  </option>
								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
								<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
								<optgroup label="<?php echo $this->translate('client dosageform list'); ?>">
								<?php endif; ?>
								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
									<?php foreach($client_medication_extra['dosage_form'] as $dosage_form_id => $dosage_form) :?>
										<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
									<?php endforeach; ?>
								<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->
								<?php if($this->show_mmi == "1" && !empty($client_medication_extra['dosageform_mmi'])):?>
            					</optgroup>
            					<optgroup label="<?php echo $this->translate('mmi dosageform list'); ?>">
            						<?php foreach($client_medication_extra['dosageform_mmi'] as $dosage_form_id => $dosage_form) :?>
            							<option value="<?php echo $dosage_form_id; ?>" <?php if($med['dosage_form_id'] == $dosage_form_id):?> selected="selected" <?php endif; ?> ><?php echo $dosage_form;?></option>
            						<?php endforeach; ?>
            					</optgroup>
            					<?php endif;?>
            					<!-- ISPC-2554 pct.1 Carmen 03.04.2020 -->									
							</select>
							
							
							<!--  MEDICATION  CONCENTRATION  -->
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][concentration][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input numeric_only medication_concentration referral change_status concentration_calculation" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['concentration'];?>"  rel="<?php echo $medication_type; ?>"   id="concentration_<?php echo $medication_type; ?>_<?php echo $cnt;?>"   />
						</td>
						<?php endif;?>

						<!-- ############################## -->
						<!-- TD  MEDICATION :: DOSAGE INPUTS-->
						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
								<td class="border_bottom_solid">
									<label class="dosage_label"><?php echo $dosage_time;?></label>
									<input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage][<?php echo $cnt;?>][<?php echo $dosage_time;?>]"  value="<?php echo $med['dosage'][$dosage_time];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="small_dosage_inptuts dosage_input referral  change_status calculate_dosage_concentration cdc_<?php echo $medication_type; ?>_<?php echo $cnt;?>" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-dosage_column_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>"  id="dosage_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>"/>
									<?php if ($this->show_new_fileds == "1" && $schedule_extra == 1 ):?>
										<input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage_concentration][<?php echo $cnt;?>][<?php echo $dosage_time;?>]"  value="<?php echo $med['dosage_concentration'][$dosage_time];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="secondDosajeDiv small_dosage_inptuts dosage_input referral  change_status calculate_dosage" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  data-dosage_column_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>" data-dosage_row_info="<?php echo $medication_type; ?>_<?php echo $cnt;?>"   rel="<?php echo $medication_type; ?>" id="dosage_concentration_<?php echo $medication_type; ?>_<?php echo $cnt;?>_<?php echo str_replace(':','',$k);?>"/>
									<?php endif;?>
									
								</td>
			 				<?php endforeach;?>
						<? else:?>
							<td class="doseirung">
								<input type="text" name="medication_block[<?php echo $medication_type; ?>][dosage][<?php echo $cnt;?>]"   value="<?php echo $med['dosage'];?>"  data-medication_type="<?php echo $medication_type; ?>"  class="dosage_inptuts dosage_input referral  change_status doseirung" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>"/>						
                                
                                <?php if ($this->ModulePrivileges[182]): ?>
                                    <br/>
                                    <label>
                                        <?= $this->translate("Dosage according to the product information"); ?>
                                       <br/> <?= $this->formRadio("medication_block[" .$medication_type ."][dosage_product][" . $cnt ."]", $med['dosage_product'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?>
                                    </label>
                                <?php endif; ?>
                            </td>
						<?php endif; ?>


						<!-- ##################################### -->
						<!-- TD MEDICATION :: INDICATION / COMMENTS-->
						<td class="ind-comm">
							<!--  MEDICATION INDICATION -->						
							<select name="medication_block[<?php echo $medication_type; ?>][indication][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="indication_color_select referral" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" <?php if(strlen($med['indication_id'])>0 && $med['indication_id'] != "0"):?> style="background: #<?php echo $client_medication_extra['indication'][$med['indication_id']]['color'];?>" <?php endif; ?>   rel="<?php echo $medication_type; ?>">
								<option id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#FFFFFF" value="0" style="background: #FFFFFF!important"  >Auswahl</option>
								<?php foreach($client_medication_extra['indication'] as $indication_id => $indication) :?>
									<option value="<?php echo $indication_id; ?>"  id="<?php echo $medication_type; ?>_<?php echo $cnt; ?>_<?php echo $indication_id; ?>#<?php echo $indication['color'];?>" style="background: #<?php echo $indication['color'];?>"  <?php if($med['indication_id'] == $indication_id):?> selected="selected" <?php endif; ?> ><?php echo $indication['name'];?></option>
								<?php endforeach; ?>
							</select>
							
							
							<!--  MEDICATION COMMENTS-->
							<textarea name="medication_block[<?php echo $medication_type; ?>][comments][<?php echo $cnt;?>]"  id="comments_<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-medication_type="<?php echo $medication_type; ?>"  class="med_com_textarea referral  change_status editcomment" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rows="" cols=""  rel="<?php echo $medication_type; ?>" ><?php echo $med['comments'];?></textarea>
						</td>

						<!-- ############################################# -->
						<!-- TD  MEDICATION  INTERVAL DAYS -->
						<td class="border_bottom_solid">
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][days_interval][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_days_interval referral change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['days_interval'];?>"  rel="<?php echo $medication_type; ?>" />
                            
                            <?php if ($this->ModulePrivileges[182]): ?>
                                <br/>
                                <label>
                                    <?= $this->translate("Interval according to technical information"); ?>
                                    <br/><?= $this->formRadio("medication_block[" .$medication_type ."][days_interval_technical][" . $cnt ."]", $med['days_interval_technical'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?>
                                </label>
                            <?php endif; ?>
						</td>
						
						
						<!-- ############################################# -->
						<!-- TD  MEDICATION  ADMINISTRATION_DATE -->
						<td class="border_bottom_solid">
							<?php if($med['administration_date'] != "0000-00-00 00:00:00"):?>
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['administration_date']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
							<? else:?>
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][administration_date][<?php echo $cnt;?>]"  value=""  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
							<?php endif;?>
						</td>
						

						<!-- ############################################# -->
						<!-- TD  MEDICATION  VERORDNET VON  / DATUM / SORT -->
						<td class="border_bottom_solid">
							<!--  MEDICATION  VERORDNET VON -->
							<select name="medication_block[<?php echo $medication_type; ?>][verordnetvon][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="verordnetvon_select referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
								<?php foreach($this->users as $user_id => $unsername) :?>
									<option value="<?php echo $user_id; ?>" <?php if($med['verordnetvon'] == $user_id):?> selected="selected" <?php endif; ?> ><?php echo $unsername;?></option>
								<?php endforeach; ?>
							</select>
							<!--  MEDICATION DATUM  -->
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication_change][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['medication_change']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
						</td>

						
						<!-- ############################## -->
						<!-- TD MEDICATION :: DELETE -->
						<td   class="delete delete_medication"  rel="<?php echo $med['id'];?>" data-medication_type="<?php echo $medication_type; ?>"  > </td>
						
					</tr> 
					
					
					
			 	<?php if($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) :?>
                <!-- online ack start -->
				<?php 
						$ack_referance_txt = array();
                        $ack_referance_del = array();

						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						} 
						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						{
							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
					
					<tr class="ack_info_tr single edit_acknowlege_row acknowlege_row extedned_ack" data-ack_id="tr<?php echo $medication_type;?><?php echo $cnt;?>"   id="ack_<?php echo $med['id'];?>" rel="<?php echo $medication_type;?><?php echo $cnt;?>" >
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['importance'];?> </span>
							</div>
						</td>
						<!--  MEDICATION NAME -->
						<td>
						      <div class="ackn_ref"><?php echo $ack_referance_txt[$med['id']]; ?></div>
							<div class="mifo">
								<span class="lb"><?php echo $ack_referance_del[$med['id']]; ?><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['name'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['drug'];?></span>
							</div>
						</td>
						
						
						<?php if ($this->show_new_fileds == "1" && $schedule_extra == 1 ):?>
						
						<!--  MEDICATION UNIT / TYPE -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['unit'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_type'); ?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['type'];?></span>
							</div>
						</td>
						
												
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage_form'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['concentration'];?></span>
							</div>
						</td>
						<?php endif;?>
						
						
						<!--  MEDICATION DOSAGE INPUTS-->
						
												<!-- ############################## -->
						<!-- TD  MEDICATION :: DOSAGE INPUTS-->
						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $dosage_time; ?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && $schedule_extra == 1  && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?> <?php echo $med['on_hold_changes'][$med['id']]['unit'];?><?php endif;?></span>
									<span class="vl"><?php if ($this->show_new_fileds == "1" && $schedule_extra == 1  && strlen($med['on_hold_changes'][$med['id']]['dosage'][$dosage_time]) > 0):?><?php echo $med['on_hold_changes'][$med['id']]['dosage_concentration'][$dosage_time];?><?php endif;?></span>
								</div>
							</td>
		 				     <?php endforeach;?>
		 				
						<? else:?>
							<td class="border_bottom_solid">
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage');?></span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['dosage']; ?></span>
								</div>
								
                            <?php if ($this->ModulePrivileges[182]): ?>
                                    <br/>
                                    <span class="lbx"><?= $this->translate("Dosage according to the product information"); ?></span>
                                    <span class="vlx"><?= $this->formRadio("medication_block[" .$medication_type ."][dosage_product][" . $cnt ."]", $med['dosage_product'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?></span>
                                    
                                <?php endif; ?>
								
							</td>
						<?php endif; ?>
						
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($med['on_hold_changes'][$med['id']]['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $med['on_hold_changes'][$med['id']]['indication_color'];?>"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['indication'];?></span> 
								<?php endif;?>
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['comments'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION DAYS INTERVAL -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['days_interval'];?></span>
							</div>
                                <?php if ($this->ModulePrivileges[182]): ?>
                                <br/>
                                <label>
                                    <?= $this->translate("Interval according to technical information"); ?>
                                    <br/><?= $this->formRadio("medication_block[" .$medication_type ."][days_interval_technical][" . $cnt ."]", $med['days_interval_technical'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?>
                                </label>
                            <?php endif; ?>							
							
							
						</td>
						
						 
						<!--  MEDICATION ADMINISTRATION DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<?php if(!empty($med['on_hold_changes'][$med['id']]['administration_date']) && $med['on_hold_changes'][$med['id']]['administration_date'] != "0000-00-00 00:00:00" ): ?>
								<span class="vl"><?php echo date("d.m.Y",strtotime($med['on_hold_changes'][$med['id']]['administration_date']));?></span>
								<?php else: ?>
								<span class="vl"></span>
								<?php endif;; ?>
								
								
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?></span>
							</div>
						</td>
						<td></td>
	 
					</tr>
                <!-- online ack end -->
				<?php endif;?>
              
                             
<?php 
if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) :
    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes_offline) :
?>
<!-- start offline changes scheduled-->
<?php
$ack_referance_txt = '';
$ack_referance_del = '';

switch ($on_hold_changes_offline['status']) {

    case 'delete':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
        $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>'; 
    break;
    
    case 'new':
        $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>'; 
    break;
    
    case 'edit':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
    break;

    default:
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Renew changes: ").'</span>'; 
        $ack_referance_del = ''; 
    break;


    
}
//approve buttons are not displayed in the edit page
/*
if($this->approval_rights == "1") {
    $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
    $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button>';
    $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
} else {
    $app_rights =
    $approve =
    $deny = '';
}
*/
?>
<!-- ###################################### -->
<tr class="ack_info_tr single edit_acknowlege_row acknowlege_row extedned_ack" data-ack_id="tr<?php echo $medication_type;?><?php echo $cnt;?>"   id="ack_<?php echo $med['id'];?>" rel="<?php echo $medication_type;?><?php echo $cnt;?>" >
						<!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['importance'];?> </span>
							</div>
						</td>
						<!--  MEDICATION NAME -->
						<td>
						      <div class="ackn_ref"><?php echo $ack_referance_txt; ?></div>
							<div class="mifo">
								<span class="lb"><?php echo $ack_referance_del[$med['id']]; ?><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['name'];?></span>
								<span class="lb"><?php echo $this->translate('medication_drug'); ?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['drug'];?></span>
							</div>
						</td>
						
						
						<?php if ($this->show_new_fileds == "1" && $schedule_extra == 1 ):?>
						
						<!--  MEDICATION UNIT / TYPE -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_unit'); ?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['unit'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_type'); ?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['type'];?></span>
							</div>
						</td>
						
												
						<!--  MEDICATION DOSAGE FORM / CONCENTRATION -->
						<td>
							<div class="mifo">
								<span class="lb"><?php echo $this->translate('medication_dosageform'); ?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['dosage_form'];?></span>
								
								<span class="lb"><?php echo $this->translate('medication_concentration'); ?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['concentration'];?></span>
							</div>
						</td>
						<?php endif;?>
						
						
						<!--  MEDICATION DOSAGE INPUTS-->
						
												<!-- ############################## -->
						<!-- TD  MEDICATION :: DOSAGE INPUTS-->
						<?php if(in_array($medication_type,$this->timed_scheduled_medications)):?>					
							<?php foreach($this->dosage_intervals[$medication_type] as $k => $dosage_time):?>
							<td>
								<div class="mifo">
									<span class="lb"><?php echo $dosage_time; ?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['dosage'][$dosage_time];?><?php if ($this->show_new_fileds == "1" && $schedule_extra == 1  && strlen($on_hold_changes_offline['dosage'][$dosage_time]) > 0):?> <?php echo $on_hold_changes_offline['unit'];?><?php endif;?></span>
									<span class="vl"><?php if ($this->show_new_fileds == "1" && $schedule_extra == 1  && strlen($on_hold_changes_offline['dosage'][$dosage_time]) > 0):?><?php echo $on_hold_changes_offline['dosage_concentration'][$dosage_time];?><?php endif;?></span>
								</div>
							</td>
		 				     <?php endforeach;?>
		 				
						<? else:?>
							<td class="border_bottom_solid">
								<div class="mifo">
									<span class="lb"><?php echo $this->translate('medication_dosage');?></span>
									<span class="vl"><?php echo $on_hold_changes_offline['dosage']; ?></span>
								</div>
								
                            <?php if ($this->ModulePrivileges[182]): ?>
                                    <br/>
                                    <span class="lbx"><?= $this->translate("Dosage according to the product information"); ?></span>
                                    <span class="vlx"><?= $this->formRadio("medication_block[" .$medication_type ."][dosage_product][" . $cnt ."]", $med['dosage_product'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?></span>
                                    
                                <?php endif; ?>
								
							</td>
						<?php endif; ?>
						
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<?php if(strlen($on_hold_changes_offline['indication_color']) > 0):?>
				 					<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl indication_span" style="background: #<?php echo $on_hold_changes_offline['indication_color'];?>"><?php echo $on_hold_changes_offline['indication'];?></span>
								<?php else:?>
									<span class="lb"><?php echo $this->translate('medication_indication'); ?>:</span>
									<span class="vl"><?php echo $on_hold_changes_offline['indication'];?></span> 
								<?php endif;?>
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $on_hold_changes_offline['comments'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION DAYS INTERVAL -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['days_interval'];?></span>
							</div>
                                <?php if ($this->ModulePrivileges[182]): ?>
                                <br/>
                                <label>
                                    <?= $this->translate("Interval according to technical information"); ?>
                                    <br/><?= $this->formRadio("medication_block[" .$medication_type ."][days_interval_technical][" . $cnt ."]", $med['days_interval_technical'], ['class'=>'dosage_input referral change_status', 'rel'=> $medication_type, 'title' => "{$medication_type}_{$cnt}"], ['yes' => 'Ja', 'no'=>'Nein'], PHP_EOL);?>
                                </label>
                            <?php endif; ?>							
							
							
						</td>
						
						 
						<!--  MEDICATION ADMINISTRATION DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<?php if(!empty($on_hold_changes_offline['administration_date']) && $on_hold_changes_offline['administration_date'] != "0000-00-00 00:00:00" ): ?>
								<span class="vl"><?php echo date("d.m.Y",strtotime($on_hold_changes_offline['administration_date']));?></span>
								<?php else: ?>
								<span class="vl"></span>
								<?php endif;; ?>
								
								
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['medication_change_date'];?></span>
							</div>
						</td>
						<td></td>
	 
					</tr>

<!-- ###################################### -->
                    
<?php endforeach;?>
<!-- end offline changes scheduled-->
<?php endif;?>
		<tr class="separator">
				<td colspan="8"> </td>
			</tr>
<?php 
$cnt++; 
endforeach;
?>
		 </table>
		 
	 
		
		<input type="hidden" value="<?php echo $cnt;?>" id="new_line_<?php echo $medication_type;?>"> 
		<a  href="javascript:void(0)"  rel="<?php echo $medication_type?>" class="add_button_link medication_add_link"><?php echo $this->translate($medication_type." medication add")?></a>
	</div>
	
	<?php else:?>
	<div class="medication_block mk-container mk-edit">
	
		<div class="med_block_header mk-top mk-edit-title">
			<h1 id="section_<?php echo $medication_type;?>"><?php echo $this->translate($medication_type." medication title")?></h1>
		</div>
	
		<table id="<?php echo $medication_type; ?>_med_table" class="medication_row_<?php echo $med['id']?> medication_edit_table medikation" data-medication_type="<?php echo $medication_type; ?>">
			<thead>
		 		<tr>
		 			<th class="name sort"><?php echo $this->translate('medication_importance'); ?></th>
		 			<th class="name"><?php echo $this->translate('medication_treatment_care_name');?></th>
		 			<th ><?php echo $this->translate('medication_comments'); ?></th>
		 			<th><?php echo $this->translate('medication_prescribed_by'); ?></th>
		 			<th colspan="2"><?php echo $this->translate('medication_change_date'); ?></th>
		 		</tr>
		 	</thead>
		 	
		 	<tbody>
		 		<?php $cnt = 1; foreach($medication_array[$medication_type] as $k =>$med):?>
					<tr id="tr<?php echo $medication_type;?><?php echo $cnt;?>"
					class="single
                    <?php if(($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']]))  || ($this->ModulePrivileges[155] == true && !empty($med['on_hold_changes_offline'][$med['id']])) ) :?> has_ack <?php endif;?>"
                    >
					
						<!-- TD  MEDICATION SORT -->
						<td class="sortnum">
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][importance][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input medication_importance referral  change_status"  title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  value="<?php echo $med['importance'];?>"  rel="<?php echo $medication_type; ?>" />
							<input type="hidden" name="medication_block[<?php echo $medication_type; ?>][replace_with][<?php echo $cnt;?>]"   data-medication_type="<?php echo $medication_type; ?>"  class="small_input replace_with referral " value="<?php echo $med['replace_with'];?>"  rel="<?php echo $medication_type; ?>" />
						</td>
						<!-- ############################## -->
						<!-- TD  MEDICATION :: NAME   -->
						<td class="name">
							<!-- MEDICATION NAME -->						
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication][<?php echo $cnt;?>]" value="<?php echo $med['medication'];?>" id="medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>"  autocomplete="off"  data-medication_type="<?php echo $medication_type; ?>"  class="livesearchmedinp_treatment_care med meds_<?php echo $medication_type; ?>_line_<?php echo $cnt; ?> referral change_status xxl_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" rel="<?php echo $medication_type; ?>"/>
			    			<input name="medication_block[<?php echo $medication_type; ?>][hidd_medication][<?php echo $cnt; ?>]" value="<?php echo $med['medication_master_id'];?>" id="hidd_medication_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" type="hidden">
		    				<input type="hidden" id="drid_<?php echo $medication_type; ?>_[<?php echo $cnt; ?>]" name="medication_block[<?php echo $medication_type; ?>][drid][<?php echo $cnt; ?>]" value="<?php echo $med['id'];?>" />
						    <input type="hidden" id="edited_<?php echo $medication_type; ?>_<?php echo $cnt; ?>" name="medication_block[<?php echo $medication_type; ?>][edited][<?php echo $cnt; ?>]" value="0" />
						</td>
						
						<!-- ##################################### -->
						<!-- TD MEDICATION :: COMMENTS-->
						<td class="ind-comm">
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][comments][<?php echo $cnt;?>]"  id="comments_<?php echo $medication_type; ?>_<?php echo $cnt;?>" data-medication_type="<?php echo $medication_type; ?>"  class="referral  change_status  xxl_input" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>" value="<?php echo $med['comments'];?>"  rel="<?php echo $medication_type; ?>" >
						</td>

						<!-- ############################################# -->
						<!-- TD  MEDICATION  VERORDNET VON  -->
						<td>
							<select name="medication_block[<?php echo $medication_type; ?>][verordnetvon][<?php echo $cnt;?>]"  data-medication_type="<?php echo $medication_type; ?>"  class="verordnetvon_select referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>">
								<?php foreach($this->users as $user_id => $unsername) :?>
									<option value="<?php echo $user_id  ?>" <?php if($med['verordnetvon'] == $user_id):?> selected="selected" <?php endif; ?> ><?php echo $unsername;?></option>
								<?php endforeach; ?>
							</select>
						</td>
						
						<!-- TD  MEDICATION DATUM  -->
						<td>
							<input type="text" name="medication_block[<?php echo $medication_type; ?>][medication_change][<?php echo $cnt;?>]"  value="<?php echo date('d.m.Y',strtotime($med['medication_change']));?>"  data-medication_type="<?php echo $medication_type; ?>"  class="date_input referral  change_status" title="<?php echo $medication_type; ?>_<?php echo $cnt;?>"  rel="<?php echo $medication_type; ?>" />
						</td>


						
						<!-- ############################## -->
						<!-- TD MEDICATION :: DELETE -->
					 
                        <td   class="delete delete_medication"  rel="<?php echo $med['id'];?>" data-medication_type="<?php echo $medication_type; ?>"  > </td>
						
						
					</tr> 			
					
										
					
			 	<?php if($this->acknowledge  == "1" && !empty($med['on_hold_changes'][$med['id']])) :?>
				<?php 
                        $ack_referance_txt = array();
                        $ack_referance_del = array();
						$ack_referance_txt[$med['id']] = "";
						$ack_referance_del[$med['id']] = "";

						if($med['on_hold_changes'][$med['id']]['status'] == "delete")
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>';
							$ack_referance_del[$med['id']] = '<span class="red_text">'.$this->translate("Delete medication: ").'</span>'; 
						} 
						else if($med['on_hold_changes'][$med['id']]['status'] == "new")
						{
							$ack_referance_txt[$med['id']] = '<span class="green_text">'.$this->translate("Unapproved newly added medication: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						} 
						else
						{
							$ack_referance_txt[$med['id']] = '<span class="blue_text">'.$this->translate("Unapproved changes: ").'</span>'; 
							$ack_referance_del[$med['id']] = ''; 
						}
		 		 
						if($this->approval_rights == "1")
						{
							$app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
							$approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Approve").'</button>';
							$deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$med['on_hold_changes'][$med['id']]['alt_id'].'">'.$this->translate("Decline").'</button>';
			 			} 
						else
						{
							$app_rights = '';
							$approve = '';
							$deny = '';
						}
		 		?>
					
					<tr class="ack_info_tr single edit_acknowlege_row tr_ack_back" id="ack_<?php echo $med['id'];?>" >
				        <!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['importance'];?> </span>
							</div>
						</td>					
					
						<!--  MEDICATION NAME -->
						<td>
						    <?php echo $ack_referance_txt[$med['id']]; ?>
							<div class="mifo">
								<span class="lb"><?php echo $ack_referance_del[$med['id']]; ?><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['name'];?></span>
							</div>
						</td>
  
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['comments'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<span class="lb"><?php echo $this->translate('medication_prescribed_by'); ?>:</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['prescribed_by'];?></span>
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $med['on_hold_changes'][$med['id']]['medication_change_date'];?></span>
							</div>
						</td>
		
						<td>
						</td>
					</tr>
				<?php endif;?>
                
<?php 
if($this->ModulePrivileges[155] == true && ! empty($med['on_hold_changes_offline'][$med['id']])) :
    foreach ($med['on_hold_changes_offline'][$med['id']] as $on_hold_changes_offline) :
?>
<!-- start offline changes treatment_care-->
<?php
$ack_referance_txt = '';
$ack_referance_del = '';

switch ($on_hold_changes_offline['status']) {

    case 'delete':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
        $ack_referance_del = '<span class="red_text">'.$this->translate("Offline Delete medication: ").'</span>'; 
    break;
    
    case 'new':
        $ack_referance_txt = '<span class="green_text">'.$this->translate("Offline Unapproved newly added medication: ").'</span>'; 
    break;
    
    case 'edit':
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Unapproved changes: ").'</span>'; 
    break;

    default:
        $ack_referance_txt = '<span class="blue_text">'.$this->translate("Offline Renew changes: ").'</span>'; 
        $ack_referance_del = ''; 
    break;


    
}
//approve buttons are not displayed in the edit page
/*
if($this->approval_rights == "1") {
    $app_rights = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button><button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
    $approve = '<button class="med_approve_rights approvem" data-action="approve" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Approve").'</button>';
    $deny = '<button class="med_approve_rights denym"   data-action="decline" data-recordid="'.$med['id'].'" data-alt_id="'.$on_hold_changes_offline['alt_id'].'">'.$this->translate("Decline").'</button>';
} else {
    $app_rights =
    $approve =
    $deny = '';
}
*/
?>         

<!-- ################################### -->
	<tr class="ack_info_tr single edit_acknowlege_row tr_ack_back" id="ack_<?php echo $med['id'];?>" >
				        <!--  MEDICATION SORT / IMPORTANCE -->
						<td class="sortnum">
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['importance'];?> </span>
							</div>
						</td>					
					
						<!--  MEDICATION NAME -->
						<td>
						    <?php echo $ack_referance_txt; ?>
							<div class="mifo">
								<span class="lb"><?php echo $ack_referance_del; ?><?php echo $this->translate('medication_name');?></span>
								<span class="vl"><?php echo $on_hold_changes_offline['name'];?></span>
							</div>
						</td>
  
						
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<span class="lb"><?php echo $this->translate('medication_comments'); ?>:</span>
								<span class="vl"><?php echo $on_hold_changes_offline['comments'];?></span>
							</div>
						</td>
						
						<!--  MEDICATION INDICATION / COMMENTS-->
						<td >
							<div class="mifo">
				 				<span class="lb"><?php echo $this->translate('medication_prescribed_by'); ?>:</span>
								<span class="vl"><?php echo $on_hold_changes_offline['prescribed_by'];?></span>
							</div>
						</td>
						
						 
						<!--  MEDICATION CHANGE DATE d.m.Y FORMAT -->
						<td>
							<div class="mifo">
								<span class="lb">&nbsp;</span>
								<span class="vl"><?php echo $on_hold_changes_offline['medication_change_date'];?></span>
							</div>
						</td>
		
						<td>
						</td>
					</tr>
<!-- ################################### -->
                
<?php endforeach;?>
<!-- end offline changes treatment_care-->
<?php endif;?>                
                
						<tr class="separator">
				<td colspan="6"> </td>
			</tr>
		 		<?php $cnt++; endforeach;?>
		 </table>
		<input type="hidden" value="<?php echo $cnt;?>" id="new_line_<?php echo $medication_type;?>"> 
		<a  href="javascript:void(0)"  rel="<?php echo $medication_type?>" class="add_button_link medication_add_link"><?php echo $this->translate($medication_type." medication add")?></a>
	</div>
	<?php endif;?>
<?php  endforeach;?>




<!-- ISPC-2507 START -->
<?php if($this->allow_medication_comunication_ii == '1' ):?>

<input type="hidden" name="pending_request_id"  id ="pending_request_id" value="<?php echo $this->current_request_id; ?>" />
<?php if($this->is_pharma_user == '1'):?>
	<input type="hidden" name="post_user_type"  id = "post_user_type" value="is_pharma_user" />
<?php elseif($this->is_assigned_doctor_user == '1'):?>
	<input type="hidden" name="post_user_type"  id = "post_user_type" value="is_assigned_doctor_user" />
<?php endif;?>	
<div style="display: none";>
<?php 
echo $this->formSelect(
	"custom_request[{$cnt}][request_reason]", 
	null, 
	array(
		"id" => "reason_select",
		"class" => "todo_selectbox reasonarr",
	    "style"=>'width:300px;',
		"multiple" => true,
		"size" => 1,
		"disable" => array("0")
	),
	$this->reasons_arr
);
?>	
</div>		
	<div class="medication_block mk-container mk-edit"  <?php if(empty($this->custom_request_data) && $this->is_pharma_user != '1'): ?> style="display: none;" <?php endif;?>>
 
	
		<div class="mk-top mk-edit-title">
			<h1><?php echo $this->translate("Custom requests")?> </h1>
		</div>
		<table id="custom_request_table" class="medikation medication_edit_table">
		<thead>
		<?php if( $this->is_pharma_user == '1'):?>
    		 <th class="name" style="width: 50%"><?php echo $this->translate('Grund der Empfehlung'); ?></th>
    		 <th class="name" style="width: 30%"><?php echo $this->translate('Kommentar der Apotheke'); ?></th>
    		 <th class="name"  style="width: 5%"></th>
		<?php elseif($this->is_assigned_doctor_user == '1'):?>
    		 <th class="name" style="width: 40%"><?php echo $this->translate('Grund der Empfehlung'); ?></th>
    		 <th class="name" style="width: 30%"><?php echo $this->translate('Kommentar der Apotheke'); ?></th>
		<?php endif;?>		 
		 </thead>
		 <?php $req_cnt =1;?>
		 <?php foreach($this->custom_request_data as $custom_req_id=>$c_REq_data):?>
			<?php if( $this->is_pharma_user == '1'):?>
			
				<tr id="trcustom_request<?php echo $req_cnt?>" class="selector_medication_tr_<?php echo $req_cnt?> has_request single">
    		 		<td  style="vertical-align: top!important;">
    					<?php 
    						echo $this->formSelect(
    						    "custom_request[{$req_cnt}][request_reason][]",
    							$c_REq_data['request_data']['request_reason_arr'], 
    							array(
    								"class" => "todo_selectbox reasonarr",
    							    "style"=>'width:100%;',
    								"multiple" => true,
    								"size" => 1,
    								"disable" => array("0")
    							),
    							$this->reasons_arr
    						);
                        ?>	
    		 		</td>
    		 		
    		 		<td  style="vertical-align: top!important;">
    					<textarea name="custom_request[<?php echo $req_cnt; ?>][comments]"  class="med_com_textarea  editcomment request_comment" placeholder="Kommentar" ><?php echo $c_REq_data['request_data']['request_comment']; ?></textarea>
                       	<input name="custom_request[<?php echo $req_cnt; ?>][custom_id]"  type="hidden" value="<?php echo $custom_req_id; ?>" />
    				</td>

<!-- 
    		 		<td style="vertical-align: top!important;">
                       	<input name="custom_request[<?php echo $req_cnt; ?>][minutes]"  type="text" value="<?php echo $c_REq_data['request_data']['request_minutes']; ?>" class="small_input minutes_input numeric_only" />
    		 		</td>
    		 		 -->
    		 		
    		 		<td></td>
<!--     		 		
   		 			<td class="delete delete_custom_request" onclick="remove_new_line('#trcustom_request<?php echo $req_cnt; ?>')" data-medication_type="custom_request"  data-custom_id="<?php echo $custom_req_id; ?>" rel="<?php echo $req_cnt; ?>"></td>
 -->
    		 		
		 		</tr>
			<?php else:?>
            	<tr class="has_request">
                	<td>
						<span class="assigned_doctor_req_info"><?php echo !empty($c_REq_data['request_data']['request_reason_text']) ? $c_REq_data['request_data']['request_reason_text'] : ""; ?></span>
                    </td>	
                    
                    <td>
                    	<span class="assigned_doctor_req_info"><?php echo nl2br($c_REq_data['request_data']['request_comment']); ?></span>
                    </td>
                    
                    <td style="vertical-align: top!important;"  >
<!--                     
                    	<textarea disabled="disabled"><?php echo $c_REq_data['request_data']['request_minutes']; ?></textarea>
 -->
                    
                       	<input name="custom_request[<?php echo $req_cnt; ?>][custom_id]"  type="hidden" value="<?php echo $custom_req_id; ?>" />
                       	
                        <!-- show only for assigned foctor -->
                       	<?php if($this->is_assigned_doctor_user == '1'):?>
                           	<div class="pharme_request_line">
            					<input type="radio"  name="custom_request[<?php echo $req_cnt; ?>][status]"    value="fully_agree" class="req_status_radio"  data-show_comment="deny_comment_request<?php echo $req_cnt; ?>" />
                                <label><b><?php echo   $page_lang['agree_with_change']?></b></label>
    						</div>
            								    
            				<div class="pharme_request_line">
    							<input type="radio" name="custom_request[<?php echo $req_cnt; ?>][status]" value="partially_agree" class="req_status_radio"  data-show_comment="deny_comment_request<?php echo $req_cnt; ?>"/>
    							<label><b><?php echo   $page_lang['partly agree_with_change']?></b></label>    						    		
    						</div>
    						
    						<div class="pharme_request_line">
    							<input type="radio" name="custom_request[<?php echo $req_cnt; ?>][status]" value="dont_agree"  class="req_status_radio"  data-show_comment="deny_comment_request<?php echo $req_cnt; ?>">
    							<label><b><?php echo   $page_lang['dont agree_with_change']?></b>
    							
    							<textarea class="editcomment deny_textarea_comment deny_comment_request<?php echo $req_cnt; ?>" placeholder="Kommentar"   style="display: none" name="custom_request[<?php echo $req_cnt; ?>][status_comment]" ></textarea>
    						</div>
						<?php endif;?>
						
    		 		</td>
                    
		 		</tr>
                    <?php endif;?>
		 
		 <?php $req_cnt++; ?>
		 <?php endforeach;?>
		</table>
		
		<input type="hidden" id="deleted_custom_requests" name="delete_custom_requests" value="0" > 
		<input type="hidden" value="<?php echo $req_cnt;?>" id="new_line_custom_request"> 
		<?php if($this->is_pharma_user == '1'):?>
		<a  href="javascript:void(0)"  rel="custom_request" class="add_button_link custom_request_add_link"><?php echo $this->translate("add custom request")?></a>
		<?php endif;?>

	</div>
	
<!-- 	Show only for pharma user -->
	<div class="medication_block mk-container mk-edit"  <?php if($this->is_pharma_user != '1'): ?> style="display: none;" <?php endif;?>>
		<div class="mk-top mk-edit-title">
		<h1>
			<label><?php echo $this->translate("Req_time_needed")?></label>
			<input type="text" class="minutes_input overall_req_minutes" name="request_duration" value="<?php echo $this->current_request_duration;?>"  >
		</h1>
		</div>
	</div>
	
<?php endif; ?>	
<!-- ISPC-2507 END-->






<div id="deleted_medication_list">

</div>

<div id="MedicSet">
	<div class="sets_content" >
	
	</div>

</div>

<div class="medication_sets">
	
	<div class="medication_sets_content" >
	
	</div>
</div>


<!--  ISPC-2507 Lore 31.01.2020  MEDICATION COMMUNICATION   --> 
<div class="medication_requestchanges">
	<div class="medication_requestchanges_content" >
	
	</div>

</div>

<!--  ISPC-2507 Lore 31.01.2020  MEDICATION COMMUNICATION   --> 
<div id="requestchanges-modal">
	<div class="requestchanges_content"></div>
</div>

